/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={924:(t,e,i)=>{"use strict";var s=i(210),r=i(559),n=r(s("String.prototype.indexOf"));t.exports=function(t,e){var i=s(t,!!e);return"function"==typeof i&&n(t,".prototype.")>-1?r(i):i}},559:(t,e,i)=>{"use strict";var s=i(612),r=i(210),n=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||s.call(o,n),h=r("%Object.getOwnPropertyDescriptor%",!0),l=r("%Object.defineProperty%",!0),c=r("%Math.max%");if(l)try{l({},"a",{value:1})}catch(t){l=null}t.exports=function(t){var e=a(s,o,arguments);if(h&&l){var i=h(e,"length");i.configurable&&l(e,"length",{value:1+c(0,t.length-(arguments.length-1))})}return e};var u=function(){return a(s,n,arguments)};l?l(t.exports,"apply",{value:u}):t.exports.apply=u},187:t=>{"use strict";function e(t,e,s){s=s||2;var n,o,a,h,u,d,f,m=e&&e.length,_=m?e[0]*s:t.length,g=i(t,0,_,s,!0),y=[];if(!g||g.next===g.prev)return y;if(m&&(g=function(t,e,s,r){var n,o,a,h=[];for(n=0,o=e.length;n<o;n++)(a=i(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),h.push(p(a));for(h.sort(l),n=0;n<h.length;n++)s=c(h[n],s);return s}(t,e,g,s)),t.length>80*s){n=a=t[0],o=h=t[1];for(var v=s;v<_;v+=s)(u=t[v])<n&&(n=u),(d=t[v+1])<o&&(o=d),u>a&&(a=u),d>h&&(h=d);f=0!==(f=Math.max(a-n,h-o))?32767/f:0}return r(g,y,s,n,o,f,0),y}function i(t,e,i,s,r){var n,o;if(r===C(t,e,i,s)>0)for(n=e;n<i;n+=s)o=w(n,t[n],t[n+1],o);else for(n=i-s;n>=e;n-=s)o=w(n,t[n],t[n+1],o);return o&&g(o,o.next)&&(T(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!g(s,s.next)&&0!==_(s.prev,s,s.next))s=s.next;else{if(T(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function r(t,e,i,l,c,u,p){if(t){!p&&u&&function(t,e,i,s){var r=t;do{0===r.z&&(r.z=d(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,s,r,n,o,a,h,l=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,s=i,a=0,e=0;e<l&&(a++,s=s.nextZ);e++);for(h=l;a>0||h>0&&s;)0!==a&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(o>1)}(r)}(t,l,c,u);for(var f,m,_=t;t.prev!==t.next;)if(f=t.prev,m=t.next,u?o(t,l,c,u):n(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),T(t),t=m.next,_=m.next;else if((t=m)===_){p?1===p?r(t=a(s(t),e,i),e,i,l,c,u,2):2===p&&h(t,e,i,l,c,u):r(s(t),e,i,l,c,u,1);break}}}function n(t){var e=t.prev,i=t,s=t.next;if(_(e,i,s)>=0)return!1;for(var r=e.x,n=i.x,o=s.x,a=e.y,h=i.y,l=s.y,c=r<n?r<o?r:o:n<o?n:o,u=a<h?a<l?a:l:h<l?h:l,d=r>n?r>o?r:o:n>o?n:o,p=a>h?a>l?a:l:h>l?h:l,m=s.next;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=p&&f(r,a,n,h,o,l,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,i,s){var r=t.prev,n=t,o=t.next;if(_(r,n,o)>=0)return!1;for(var a=r.x,h=n.x,l=o.x,c=r.y,u=n.y,p=o.y,m=a<h?a<l?a:l:h<l?h:l,g=c<u?c<p?c:p:u<p?u:p,y=a>h?a>l?a:l:h>l?h:l,v=c>u?c>p?c:p:u>p?u:p,x=d(m,g,e,i,s),b=d(y,v,e,i,s),E=t.prevZ,w=t.nextZ;E&&E.z>=x&&w&&w.z<=b;){if(E.x>=m&&E.x<=y&&E.y>=g&&E.y<=v&&E!==r&&E!==o&&f(a,c,h,u,l,p,E.x,E.y)&&_(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,w.x>=m&&w.x<=y&&w.y>=g&&w.y<=v&&w!==r&&w!==o&&f(a,c,h,u,l,p,w.x,w.y)&&_(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;E&&E.z>=x;){if(E.x>=m&&E.x<=y&&E.y>=g&&E.y<=v&&E!==r&&E!==o&&f(a,c,h,u,l,p,E.x,E.y)&&_(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;w&&w.z<=b;){if(w.x>=m&&w.x<=y&&w.y>=g&&w.y<=v&&w!==r&&w!==o&&f(a,c,h,u,l,p,w.x,w.y)&&_(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function a(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!g(n,o)&&y(n,r,r.next,o)&&b(n,o)&&b(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),T(r),T(r.next),r=t=o),r=r.next}while(r!==t);return s(r)}function h(t,e,i,n,o,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&m(h,l)){var c=E(h,l);return h=s(h,h.next),c=s(c,c.next),r(h,e,i,n,o,a,0),void r(c,e,i,n,o,a,0)}l=l.next}h=h.next}while(h!==t)}function l(t,e){return t.x-e.x}function c(t,e){var i=function(t,e){var i,s=e,r=t.x,n=t.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=r&&a>o&&(o=a,i=s.x<s.next.x?s:s.next,a===r))return i}s=s.next}while(s!==e);if(!i)return null;var h,l=i,c=i.x,d=i.y,p=1/0;s=i;do{r>=s.x&&s.x>=c&&r!==s.x&&f(n<d?r:o,n,c,d,n<d?o:r,n,s.x,s.y)&&(h=Math.abs(n-s.y)/(r-s.x),b(s,t)&&(h<p||h===p&&(s.x>i.x||s.x===i.x&&u(i,s)))&&(i=s,p=h)),s=s.next}while(s!==l);return i}(t,e);if(!i)return e;var r=E(i,t);return s(r,r.next),s(i,i.next)}function u(t,e){return _(t.prev,t,e.prev)<0&&_(e.next,t,t.next)<0}function d(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,s,r,n,o,a){return(r-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(s-a)>=(i-o)*(e-a)&&(i-o)*(n-a)>=(r-o)*(s-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&y(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var i=t,s=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)&&(_(t.prev,t,e.prev)||_(t,e.prev,e))||g(t,e)&&_(t.prev,t,t.next)>0&&_(e.prev,e,e.next)>0)}function _(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,i,s){var r=x(_(t,e,i)),n=x(_(t,e,s)),o=x(_(i,s,t)),a=x(_(i,s,e));return r!==n&&o!==a||(!(0!==r||!v(t,i,e))||(!(0!==n||!v(t,s,e))||(!(0!==o||!v(i,t,s))||!(0!==a||!v(i,e,s)))))}function v(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function E(t,e){var i=new S(t.i,t.x,t.y),s=new S(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function w(t,e,i,s){var r=new S(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,i,s){for(var r=0,n=e,o=i-s;n<i;n+=s)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,s){var r=e&&e.length,n=r?e[0]*i:t.length,o=Math.abs(C(t,0,n,i));if(r)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,c=a<h-1?e[a+1]*i:t.length;o-=Math.abs(C(t,l,c,i))}var u=0;for(a=0;a<s.length;a+=3){var d=s[a]*i,p=s[a+1]*i,f=s[a+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[r][n][o]);r>0&&(s+=t[r-1].length,i.holes.push(s))}return i}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function s(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,s,n,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new r(s,n||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,r=[];if(0===this._eventsCount)return r;for(s in t=this._events)e.call(t,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,o=new Array(n);r<n;r++)o[r]=s[r].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,r,n,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,r),!0;case 5:return c.fn.call(c.context,e,s,r,n),!0;case 6:return c.fn.call(c.context,e,s,r,n,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,s);break;case 4:c[l].fn.call(c[l].context,e,s,r);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,r){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||r&&!a.once||s&&a.context!==s||o(this,n);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||r&&!a[h].once||s&&a[h].context!==s)&&l.push(a[h]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,s=Object.prototype.toString,r="[object Function]";t.exports=function(t){var n=this;if("function"!=typeof n||s.call(n)!==r)throw new TypeError(e+n);for(var o,a=i.call(arguments,1),h=function(){if(this instanceof o){var e=n.apply(this,a.concat(i.call(arguments)));return Object(e)===e?e:this}return n.apply(t,a.concat(i.call(arguments)))},l=Math.max(0,n.length-a.length),c=[],u=0;u<l;u++)c.push("$"+u);if(o=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(h),n.prototype){var d=function(){};d.prototype=n.prototype,o.prototype=new d,d.prototype=null}return o}},612:(t,e,i)=>{"use strict";var s=i(648);t.exports=Function.prototype.bind||s},210:(t,e,i)=>{"use strict";var s,r=SyntaxError,n=Function,o=TypeError,a=function(t){try{return n('"use strict"; return ('+t+").constructor;")()}catch(t){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(t){h=null}var l=function(){throw new o},c=h?function(){try{return l}catch(t){try{return h(arguments,"callee").get}catch(t){return l}}}():l,u=i(405)(),d=Object.getPrototypeOf||function(t){return t.__proto__},p={},f="undefined"==typeof Uint8Array?s:d(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?s:ArrayBuffer,"%ArrayIteratorPrototype%":u?d([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?s:Atomics,"%BigInt%":"undefined"==typeof BigInt?s:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?s:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?s:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?s:FinalizationRegistry,"%Function%":n,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?s:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?s:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u?d(d([][Symbol.iterator]())):s,"%JSON%":"object"==typeof JSON?JSON:s,"%Map%":"undefined"==typeof Map?s:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u?d((new Map)[Symbol.iterator]()):s,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?s:Promise,"%Proxy%":"undefined"==typeof Proxy?s:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?s:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?s:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u?d((new Set)[Symbol.iterator]()):s,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u?d(""[Symbol.iterator]()):s,"%Symbol%":u?Symbol:s,"%SyntaxError%":r,"%ThrowTypeError%":c,"%TypedArray%":f,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?s:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?s:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?s:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?s:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?s:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?s:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?s:WeakSet},_=function t(e){var i;if("%AsyncFunction%"===e)i=a("async function () {}");else if("%GeneratorFunction%"===e)i=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=a("async function* () {}");else if("%AsyncGenerator%"===e){var s=t("%AsyncGeneratorFunction%");s&&(i=s.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&(i=d(r.prototype))}return m[e]=i,i},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=i(612),v=i(642),x=y.call(Function.call,Array.prototype.concat),b=y.call(Function.apply,Array.prototype.splice),E=y.call(Function.call,String.prototype.replace),w=y.call(Function.call,String.prototype.slice),T=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,S=/\\(\\)?/g,C=function(t){var e=w(t,0,1),i=w(t,-1);if("%"===e&&"%"!==i)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new r("invalid intrinsic syntax, expected opening `%`");var s=[];return E(t,T,(function(t,e,i,r){s[s.length]=i?E(r,S,"$1"):e||t})),s},A=function(t,e){var i,s=t;if(v(g,s)&&(s="%"+(i=g[s])[0]+"%"),v(m,s)){var n=m[s];if(n===p&&(n=_(s)),void 0===n&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:s,value:n}}throw new r("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');var i=C(t),s=i.length>0?i[0]:"",n=A("%"+s+"%",e),a=n.name,l=n.value,c=!1,u=n.alias;u&&(s=u[0],b(i,x([0,1],u)));for(var d=1,p=!0;d<i.length;d+=1){var f=i[d],_=w(f,0,1),g=w(f,-1);if(('"'===_||"'"===_||"`"===_||'"'===g||"'"===g||"`"===g)&&_!==g)throw new r("property names with quotes must have matching quotes");if("constructor"!==f&&p||(c=!0),v(m,a="%"+(s+="."+f)+"%"))l=m[a];else if(null!=l){if(!(f in l)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(h&&d+1>=i.length){var y=h(l,f);l=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[f]}else p=v(l,f),l=l[f];p&&!c&&(m[a]=l)}}return l}},405:(t,e,i)=>{"use strict";var s="undefined"!=typeof Symbol&&Symbol,r=i(419);t.exports=function(){return"function"==typeof s&&("function"==typeof Symbol&&("symbol"==typeof s("foo")&&("symbol"==typeof Symbol("bar")&&r())))}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var s=Object.getOwnPropertySymbols(t);if(1!==s.length||s[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},642:(t,e,i)=>{"use strict";var s=i(612);t.exports=s.call(Function.call,Object.prototype.hasOwnProperty)},631:(t,e,i)=>{var s="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=s&&r&&"function"==typeof r.get?r.get:null,o=s&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,h=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&h&&"function"==typeof h.get?h.get:null,c=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,_=Function.prototype.toString,g=String.prototype.match,y="function"==typeof BigInt?BigInt.prototype.valueOf:null,v=Object.getOwnPropertySymbols,x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,b="function"==typeof Symbol&&"object"==typeof Symbol.iterator,E=Object.prototype.propertyIsEnumerable,w=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null),T=i(654).custom,S=T&&R(T)?T:null,C="function"==typeof Symbol&&void 0!==Symbol.toStringTag?Symbol.toStringTag:null;function A(t,e,i){var s="double"===(i.quoteStyle||e)?'"':"'";return s+t+s}function I(t){return String(t).replace(/"/g,"&quot;")}function P(t){return!("[object Array]"!==k(t)||C&&"object"==typeof t&&C in t)}function R(t){if(b)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!x)return!1;try{return x.call(t),!0}catch(t){}return!1}t.exports=function t(e,i,s,r){var a=i||{};if(D(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(D(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=!D(a,"customInspect")||a.customInspect;if("boolean"!=typeof h&&"symbol"!==h)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(D(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return O(e,a);if("number"==typeof e)return 0===e?1/0/e>0?"0":"-0":String(e);if("bigint"==typeof e)return String(e)+"n";var m=void 0===a.depth?5:a.depth;if(void 0===s&&(s=0),s>=m&&m>0&&"object"==typeof e)return P(e)?"[Array]":"[Object]";var v=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=Array(t.indent+1).join(" ")}return{base:i,prev:Array(e+1).join(i)}}(a,s);if(void 0===r)r=[];else if(N(r,e)>=0)return"[Circular]";function E(e,i,n){if(i&&(r=r.slice()).push(i),n){var o={depth:a.depth};return D(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),t(e,o,s+1,r)}return t(e,a,s+1,r)}if("function"==typeof e){var T=function(t){if(t.name)return t.name;var e=g.call(_.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),M=H(e,E);return"[Function"+(T?": "+T:" (anonymous)")+"]"+(M.length>0?" { "+M.join(", ")+" }":"")}if(R(e)){var F=b?String(e).replace(/^(Symbol\(.*\))_[^)]*$/,"$1"):x.call(e);return"object"!=typeof e||b?F:L(F)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var j="<"+String(e.nodeName).toLowerCase(),W=e.attributes||[],z=0;z<W.length;z++)j+=" "+W[z].name+"="+A(I(W[z].value),"double",a);return j+=">",e.childNodes&&e.childNodes.length&&(j+="..."),j+="</"+String(e.nodeName).toLowerCase()+">"}if(P(e)){if(0===e.length)return"[]";var V=H(e,E);return v&&!function(t){for(var e=0;e<t.length;e++)if(N(t[e],"\n")>=0)return!1;return!0}(V)?"["+G(V,v)+"]":"[ "+V.join(", ")+" ]"}if(function(t){return!("[object Error]"!==k(t)||C&&"object"==typeof t&&C in t)}(e)){var X=H(e,E);return 0===X.length?"["+String(e)+"]":"{ ["+String(e)+"] "+X.join(", ")+" }"}if("object"==typeof e&&h){if(S&&"function"==typeof e[S])return e[S]();if("symbol"!==h&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!n||!t||"object"!=typeof t)return!1;try{n.call(t);try{l.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var $=[];return o.call(e,(function(t,i){$.push(E(i,e,!0)+" => "+E(t,e))})),U("Map",n.call(e),$,v)}if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{l.call(t);try{n.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var Y=[];return c.call(e,(function(t){Y.push(E(t,e))})),U("Set",l.call(e),Y,v)}if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t,u);try{d.call(t,d)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return B("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{u.call(t,u)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return B("WeakSet");if(function(t){if(!p||!t||"object"!=typeof t)return!1;try{return p.call(t),!0}catch(t){}return!1}(e))return B("WeakRef");if(function(t){return!("[object Number]"!==k(t)||C&&"object"==typeof t&&C in t)}(e))return L(E(Number(e)));if(function(t){if(!t||"object"!=typeof t||!y)return!1;try{return y.call(t),!0}catch(t){}return!1}(e))return L(E(y.call(e)));if(function(t){return!("[object Boolean]"!==k(t)||C&&"object"==typeof t&&C in t)}(e))return L(f.call(e));if(function(t){return!("[object String]"!==k(t)||C&&"object"==typeof t&&C in t)}(e))return L(E(String(e)));if(!function(t){return!("[object Date]"!==k(t)||C&&"object"==typeof t&&C in t)}(e)&&!function(t){return!("[object RegExp]"!==k(t)||C&&"object"==typeof t&&C in t)}(e)){var q=H(e,E),K=w?w(e)===Object.prototype:e instanceof Object||e.constructor===Object,Q=e instanceof Object?"":"null prototype",Z=!K&&C&&Object(e)===e&&C in e?k(e).slice(8,-1):Q?"Object":"",J=(K||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(Z||Q?"["+[].concat(Z||[],Q||[]).join(": ")+"] ":"");return 0===q.length?J+"{}":v?J+"{"+G(q,v)+"}":J+"{ "+q.join(", ")+" }"}return String(e)};var M=Object.prototype.hasOwnProperty||function(t){return t in this};function D(t,e){return M.call(t,e)}function k(t){return m.call(t)}function N(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return i;return-1}function O(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,s="... "+i+" more character"+(i>1?"s":"");return O(t.slice(0,e.maxStringLength),e)+s}return A(t.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,F),"single",e)}function F(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+e.toString(16).toUpperCase()}function L(t){return"Object("+t+")"}function B(t){return t+" { ? }"}function U(t,e,i,s){return t+" ("+e+") {"+(s?G(i,s):i.join(", "))+"}"}function G(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+t.join(","+i)+"\n"+e.prev}function H(t,e){var i=P(t),s=[];if(i){s.length=t.length;for(var r=0;r<t.length;r++)s[r]=D(t,r)?e(t[r],t):""}var n,o="function"==typeof v?v(t):[];if(b){n={};for(var a=0;a<o.length;a++)n["$"+o[a]]=o[a]}for(var h in t)D(t,h)&&(i&&String(Number(h))===h&&h<t.length||b&&n["$"+h]instanceof Symbol||(/[^\w$]/.test(h)?s.push(e(h,t)+": "+e(t[h],t)):s.push(h+": "+e(t[h],t))));if("function"==typeof v)for(var l=0;l<o.length;l++)E.call(t,o[l])&&s.push("["+e(o[l])+"]: "+e(t[o[l]],t));return s}},478:(t,e,i)=>{"use strict";var s=i(210),r=i(924),n=i(631),o=s("%TypeError%"),a=s("%WeakMap%",!0),h=s("%Map%",!0),l=r("WeakMap.prototype.get",!0),c=r("WeakMap.prototype.set",!0),u=r("WeakMap.prototype.has",!0),d=r("Map.prototype.get",!0),p=r("Map.prototype.set",!0),f=r("Map.prototype.has",!0),m=function(t,e){for(var i,s=t;null!==(i=s.next);s=i)if(i.key===e)return s.next=i.next,i.next=t.next,t.next=i,i};t.exports=function(){var t,e,i,s={assert:function(t){if(!s.has(t))throw new o("Side channel does not contain "+n(t))},get:function(s){if(a&&s&&("object"==typeof s||"function"==typeof s)){if(t)return l(t,s)}else if(h){if(e)return d(e,s)}else if(i)return function(t,e){var i=m(t,e);return i&&i.value}(i,s)},has:function(s){if(a&&s&&("object"==typeof s||"function"==typeof s)){if(t)return u(t,s)}else if(h){if(e)return f(e,s)}else if(i)return function(t,e){return!!m(t,e)}(i,s);return!1},set:function(s,r){a&&s&&("object"==typeof s||"function"==typeof s)?(t||(t=new a),c(t,s,r)):h?(e||(e=new h),p(e,s,r)):(i||(i={key:{},next:null}),function(t,e,i){var s=m(t,e);s?s.value=i:t.next={key:e,next:t.next,value:i}}(i,s,r))}};return s}},100:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Collector=void 0;e.Collector=class{constructor(t){this.emit=(...e)=>{t.emitCollecting(this,e)}}}},32:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollectorArray=void 0;const s=i(100);class r extends s.Collector{constructor(){super(...arguments),this.result=[]}handleResult(t){return this.result.push(t),!0}getResult(){return this.result}reset(){this.result.length=0}}e.CollectorArray=r},484:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollectorLast=void 0;const s=i(100);class r extends s.Collector{handleResult(t){return this.result=t,!0}getResult(){return this.result}reset(){delete this.result}}e.CollectorLast=r},688:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollectorUntil0=void 0;const s=i(100);class r extends s.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,this.result}getResult(){return this.result}reset(){this.result=!1}}e.CollectorUntil0=r},764:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollectorWhile0=void 0;const s=i(100);class r extends s.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,!this.result}getResult(){return this.result}reset(){this.result=!1}}e.CollectorWhile0=r},919:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Signal=void 0;const s=i(513),r=i(470);e.Signal=class{constructor(){this.head=new r.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(t,e=0){this.connectionsCount++;const i=this.head.insert(t,e);return this.emitDepth>0&&(this.hasNewLinks=!0,i.newLink=!0),new s.SignalConnectionImpl(i,(()=>this.decrementConnectionCount()))}decrementConnectionCount(){this.connectionsCount--}disconnect(t){for(let e=this.head.next;e!==this.head;e=e.next)if(e.callback===t)return this.decrementConnectionCount(),e.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...t){this.emitDepth++;for(let e=this.head.next;e!==this.head;e=e.next)e.isEnabled()&&e.callback&&e.callback.apply(null,t);this.emitDepth--,this.unsetNewLink()}emitCollecting(t,e){this.emitDepth++;for(let i=this.head.next;i!==this.head;i=i.next)if(i.isEnabled()&&i.callback){const s=i.callback.apply(null,e);if(!t.handleResult(s))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&0===this.emitDepth){for(let t=this.head.next;t!==this.head;t=t.next)t.newLink=!1;this.hasNewLinks=!1}}}},513:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignalConnectionImpl=void 0;e.SignalConnectionImpl=class{constructor(t,e){this.link=t,this.parentCleanup=e}disconnect(){return null!==this.link&&(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0)}set enabled(t){this.link&&this.link.setEnabled(t)}get enabled(){return null!==this.link&&this.link.isEnabled()}}},669:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignalConnections=void 0;e.SignalConnections=class{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(const t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return 0===this.list.length}}},470:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignalLink=void 0;class i{constructor(t=null,e=null,i=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=null!=t?t:this,this.next=null!=e?e:this,this.order=i}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(t,e){let s=this.prev;for(;s!==this&&!(s.order<=e);)s=s.prev;const r=new i(s,s.next,e);return r.callback=t,s.next=r,r.next.prev=r,r}}e.SignalLink=i},242:(t,e,i)=>{"use strict";e.MZ=void 0;var s=i(100);var r=i(32);var n=i(484);var o=i(688);var a=i(764);var h=i(919);Object.defineProperty(e,"MZ",{enumerable:!0,get:function(){return h.Signal}});var l=i(669)},511:function(t,e,i){var s;t=i.nmd(t),function(r){e&&e.nodeType,t&&t.nodeType;var n="object"==typeof i.g&&i.g;n.global!==n&&n.window!==n&&n.self;var o,a=2147483647,h=36,l=/^xn--/,c=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function m(t){throw new RangeError(d[t])}function _(t,e){for(var i=t.length,s=[];i--;)s[i]=e(t[i]);return s}function g(t,e){var i=t.split("@"),s="";return i.length>1&&(s=i[0]+"@",t=i[1]),s+_((t=t.replace(u,".")).split("."),e).join(".")}function y(t){for(var e,i,s=[],r=0,n=t.length;r<n;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<n?56320==(64512&(i=t.charCodeAt(r++)))?s.push(((1023&e)<<10)+(1023&i)+65536):(s.push(e),r--):s.push(e);return s}function v(t){return _(t,(function(t){var e="";return t>65535&&(e+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=f(t)})).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function b(t,e,i){var s=0;for(t=i?p(t/700):t>>1,t+=p(t/e);t>455;s+=h)t=p(t/35);return p(s+36*t/(t+38))}function E(t){var e,i,s,r,n,o,l,c,u,d,f,_=[],g=t.length,y=0,x=128,E=72;for((i=t.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)t.charCodeAt(s)>=128&&m("not-basic"),_.push(t.charCodeAt(s));for(r=i>0?i+1:0;r<g;){for(n=y,o=1,l=h;r>=g&&m("invalid-input"),((c=(f=t.charCodeAt(r++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:h)>=h||c>p((a-y)/o))&&m("overflow"),y+=c*o,!(c<(u=l<=E?1:l>=E+26?26:l-E));l+=h)o>p(a/(d=h-u))&&m("overflow"),o*=d;E=b(y-n,e=_.length+1,0==n),p(y/e)>a-x&&m("overflow"),x+=p(y/e),y%=e,_.splice(y++,0,x)}return v(_)}function w(t){var e,i,s,r,n,o,l,c,u,d,_,g,v,E,w,T=[];for(g=(t=y(t)).length,e=128,i=0,n=72,o=0;o<g;++o)(_=t[o])<128&&T.push(f(_));for(s=r=T.length,r&&T.push("-");s<g;){for(l=a,o=0;o<g;++o)(_=t[o])>=e&&_<l&&(l=_);for(l-e>p((a-i)/(v=s+1))&&m("overflow"),i+=(l-e)*v,e=l,o=0;o<g;++o)if((_=t[o])<e&&++i>a&&m("overflow"),_==e){for(c=i,u=h;!(c<(d=u<=n?1:u>=n+26?26:u-n));u+=h)w=c-d,E=h-d,T.push(f(x(d+w%E,0))),c=p(w/E);T.push(f(x(c,0))),n=b(i,v,s==r),i=0,++s}++i,++e}return T.join("")}o={version:"1.4.1",ucs2:{decode:y,encode:v},decode:E,encode:w,toASCII:function(t){return g(t,(function(t){return c.test(t)?"xn--"+w(t):t}))},toUnicode:function(t){return g(t,(function(t){return l.test(t)?E(t.slice(4).toLowerCase()):t}))}},void 0===(s=function(){return o}.call(e,i,e,t))||(t.exports=s)}()},532:t=>{"use strict";var e=String.prototype.replace,i=/%20/g,s="RFC1738",r="RFC3986";t.exports={default:r,formatters:{RFC1738:function(t){return e.call(t,i,"+")},RFC3986:function(t){return String(t)}},RFC1738:s,RFC3986:r}},984:(t,e,i)=>{"use strict";var s=i(730),r=i(325),n=i(532);t.exports={formats:n,parse:r,stringify:s}},325:(t,e,i)=>{"use strict";var s=i(368),r=Object.prototype.hasOwnProperty,n=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:s.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},h=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},l=function(t,e,i,s){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(n),l=a?n.slice(0,a.index):n,c=[];if(l){if(!i.plainObjects&&r.call(Object.prototype,l)&&!i.allowPrototypes)return;c.push(l)}for(var u=0;i.depth>0&&null!==(a=o.exec(n))&&u<i.depth;){if(u+=1,!i.plainObjects&&r.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(t,e,i,s){for(var r=s?e:h(e,i),n=t.length-1;n>=0;--n){var o,a=t[n];if("[]"===a&&i.parseArrays)o=[].concat(r);else{o=i.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(l,10);i.parseArrays||""!==l?!isNaN(c)&&a!==l&&String(c)===l&&c>=0&&i.parseArrays&&c<=i.arrayLimit?(o=[])[c]=r:"__proto__"!==l&&(o[l]=r):o={0:r}}r=o}return r}(c,e,i,s)}};t.exports=function(t,e){var i=function(t){if(!t)return o;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?o.charset:t.charset;return{allowDots:void 0===t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||s.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var c="string"==typeof t?function(t,e){var i,l={__proto__:null},c=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,u=e.parameterLimit===1/0?void 0:e.parameterLimit,d=c.split(e.delimiter,u),p=-1,f=e.charset;if(e.charsetSentinel)for(i=0;i<d.length;++i)0===d[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[i]?f="utf-8":"utf8=%26%2310003%3B"===d[i]&&(f="iso-8859-1"),p=i,i=d.length);for(i=0;i<d.length;++i)if(i!==p){var m,_,g=d[i],y=g.indexOf("]="),v=-1===y?g.indexOf("="):y+1;-1===v?(m=e.decoder(g,o.decoder,f,"key"),_=e.strictNullHandling?null:""):(m=e.decoder(g.slice(0,v),o.decoder,f,"key"),_=s.maybeMap(h(g.slice(v+1),e),(function(t){return e.decoder(t,o.decoder,f,"value")}))),_&&e.interpretNumericEntities&&"iso-8859-1"===f&&(_=a(_)),g.indexOf("[]=")>-1&&(_=n(_)?[_]:_),r.call(l,m)?l[m]=s.combine(l[m],_):l[m]=_}return l}(t,i):t,u=i.plainObjects?Object.create(null):{},d=Object.keys(c),p=0;p<d.length;++p){var f=d[p],m=l(f,c[f],i,"string"==typeof t);u=s.merge(u,m,i)}return!0===i.allowSparse?u:s.compact(u)}},730:(t,e,i)=>{"use strict";var s=i(478),r=i(368),n=i(532),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},h=Array.isArray,l=Array.prototype.push,c=function(t,e){l.apply(t,h(e)?e:[e])},u=Date.prototype.toISOString,d=n.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:n.formatters[d],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},f={},m=function t(e,i,n,o,a,l,u,d,m,_,g,y,v,x,b,E){for(var w,T=e,S=E,C=0,A=!1;void 0!==(S=S.get(f))&&!A;){var I=S.get(e);if(C+=1,void 0!==I){if(I===C)throw new RangeError("Cyclic object value");A=!0}void 0===S.get(f)&&(C=0)}if("function"==typeof d?T=d(i,T):T instanceof Date?T=g(T):"comma"===n&&h(T)&&(T=r.maybeMap(T,(function(t){return t instanceof Date?g(t):t}))),null===T){if(a)return u&&!x?u(i,p.encoder,b,"key",y):i;T=""}if("string"==typeof(w=T)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||r.isBuffer(T))return u?[v(x?i:u(i,p.encoder,b,"key",y))+"="+v(u(T,p.encoder,b,"value",y))]:[v(i)+"="+v(String(T))];var P,R=[];if(void 0===T)return R;if("comma"===n&&h(T))x&&u&&(T=r.maybeMap(T,u)),P=[{value:T.length>0?T.join(",")||null:void 0}];else if(h(d))P=d;else{var M=Object.keys(T);P=m?M.sort(m):M}for(var D=o&&h(T)&&1===T.length?i+"[]":i,k=0;k<P.length;++k){var N=P[k],O="object"==typeof N&&void 0!==N.value?N.value:T[N];if(!l||null!==O){var F=h(T)?"function"==typeof n?n(D,N):D:D+(_?"."+N:"["+N+"]");E.set(e,C);var L=s();L.set(f,E),c(R,t(O,F,n,o,a,l,"comma"===n&&x&&h(T)?null:u,d,m,_,g,y,v,x,b,L))}}return R};t.exports=function(t,e){var i,r=t,l=function(t){if(!t)return p;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||p.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=n.default;if(void 0!==t.format){if(!o.call(n.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var s=n.formatters[i],r=p.filter;return("function"==typeof t.filter||h(t.filter))&&(r=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===t.allowDots?p.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:p.charsetSentinel,delimiter:void 0===t.delimiter?p.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:p.encode,encoder:"function"==typeof t.encoder?t.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:p.encodeValuesOnly,filter:r,format:i,formatter:s,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:p.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:p.strictNullHandling}}(e);"function"==typeof l.filter?r=(0,l.filter)("",r):h(l.filter)&&(i=l.filter);var u,d=[];if("object"!=typeof r||null===r)return"";u=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var f=a[u];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var _="comma"===f&&e&&e.commaRoundTrip;i||(i=Object.keys(r)),l.sort&&i.sort(l.sort);for(var g=s(),y=0;y<i.length;++y){var v=i[y];l.skipNulls&&null===r[v]||c(d,m(r[v],v,f,_,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,g))}var x=d.join(l.delimiter),b=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),x.length>0?b+x:""}},368:(t,e,i)=>{"use strict";var s=i(532),r=Object.prototype.hasOwnProperty,n=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)void 0!==t[s]&&(i[s]=t[s]);return i};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var r=e[s],o=r.obj[r.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],c=o[l];"object"==typeof c&&null!==c&&-1===i.indexOf(c)&&(e.push({obj:o,prop:l}),i.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(n(i)){for(var s=[],r=0;r<i.length;++r)void 0!==i[r]&&s.push(i[r]);e.obj[e.prop]=s}}}(e),t},decode:function(t,e,i){var s=t.replace(/\+/g," ");if("iso-8859-1"===i)return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch(t){return s}},encode:function(t,e,i,r,n){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var h="",l=0;l<a.length;++l){var c=a.charCodeAt(l);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||n===s.RFC1738&&(40===c||41===c)?h+=a.charAt(l):c<128?h+=o[c]:c<2048?h+=o[192|c>>6]+o[128|63&c]:c<55296||c>=57344?h+=o[224|c>>12]+o[128|c>>6&63]+o[128|63&c]:(l+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(l)),h+=o[240|c>>18]+o[128|c>>12&63]+o[128|c>>6&63]+o[128|63&c])}return h},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(n(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)},merge:function t(e,i,s){if(!i)return e;if("object"!=typeof i){if(n(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(s&&(s.plainObjects||s.allowPrototypes)||!r.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var o=e;return n(e)&&!n(i)&&(o=a(e,s)),n(e)&&n(i)?(i.forEach((function(i,n){if(r.call(e,n)){var o=e[n];o&&"object"==typeof o&&i&&"object"==typeof i?e[n]=t(o,i,s):e.push(i)}else e[n]=i})),e):Object.keys(i).reduce((function(e,n){var o=i[n];return r.call(e,n)?e[n]=t(e[n],o,s):e[n]=o,e}),o)}}},575:(t,e,i)=>{"use strict";var s=i(511);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var n=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(h),c=["%","/","?",";","#"].concat(l),u=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=i(984);function y(t,e,i){if(t&&"object"==typeof t&&t instanceof r)return t;var s=new r;return s.parse(t,e,i),s}r.prototype.parse=function(t,e,i){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),o=-1!==r&&r<t.indexOf("#")?"?":"#",h=t.split(o);h[0]=h[0].replace(/\\/g,"/");var y=t=h.join(o);if(y=y.trim(),!i&&1===t.split("#").length){var v=a.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=n.exec(y);if(x){var b=(x=x[0]).toLowerCase();this.protocol=b,y=y.substr(x.length)}if(i||x||y.match(/^\/\/[^@/]+@[^@/]+/)){var E="//"===y.substr(0,2);!E||x&&m[x]||(y=y.substr(2),this.slashes=!0)}if(!m[x]&&(E||x&&!_[x])){for(var w,T,S=-1,C=0;C<u.length;C++){-1!==(A=y.indexOf(u[C]))&&(-1===S||A<S)&&(S=A)}-1!==(T=-1===S?y.lastIndexOf("@"):y.lastIndexOf("@",S))&&(w=y.slice(0,T),y=y.slice(T+1),this.auth=decodeURIComponent(w)),S=-1;for(C=0;C<c.length;C++){var A;-1!==(A=y.indexOf(c[C]))&&(-1===S||A<S)&&(S=A)}-1===S&&(S=y.length),this.host=y.slice(0,S),y=y.slice(S),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var P=this.hostname.split(/\./),R=(C=0,P.length);C<R;C++){var M=P[C];if(M&&!M.match(d)){for(var D="",k=0,N=M.length;k<N;k++)M.charCodeAt(k)>127?D+="x":D+=M[k];if(!D.match(d)){var O=P.slice(0,C),F=P.slice(C+1),L=M.match(p);L&&(O.push(L[1]),F.unshift(L[2])),F.length&&(y="/"+F.join(".")+y),this.hostname=O.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=s.toASCII(this.hostname));var B=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+B,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!f[b])for(C=0,R=l.length;C<R;C++){var G=l[C];if(-1!==y.indexOf(G)){var H=encodeURIComponent(G);H===G&&(H=escape(G)),y=y.split(G).join(H)}}var j=y.indexOf("#");-1!==j&&(this.hash=y.substr(j),y=y.slice(0,j));var W=y.indexOf("?");if(-1!==W?(this.search=y.substr(W),this.query=y.substr(W+1),e&&(this.query=g.parse(this.query)),y=y.slice(0,W)):e&&(this.search="",this.query={}),y&&(this.pathname=y),_[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var z=this.search||"";this.path=B+z}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",s=this.hash||"",r=!1,n="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(n=g.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||_[e])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),s&&"#"!==s.charAt(0)&&(s="#"+s),o&&"?"!==o.charAt(0)&&(o="?"+o),e+r+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+s},r.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if("string"==typeof t){var e=new r;e.parse(t,!1,!0),t=e}for(var i=new r,s=Object.keys(this),n=0;n<s.length;n++){var o=s[n];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(i[l]=t[l])}return _[i.protocol]&&i.hostname&&!i.pathname&&(i.pathname="/",i.path=i.pathname),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!_[t.protocol]){for(var c=Object.keys(t),u=0;u<c.length;u++){var d=c[u];i[d]=t[d]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||m[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var f=i.pathname||"",g=i.search||"";i.path=f+g}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=v||y||i.host&&t.pathname,b=x,E=i.pathname&&i.pathname.split("/")||[],w=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!_[i.protocol]);if(w&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),x=x&&(""===p[0]||""===E[0])),v)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),i.search=t.search,i.query=t.query;else if(null!=t.search){if(w)i.host=E.shift(),i.hostname=i.host,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname);return i.search=t.search,i.query=t.query,null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var T=E.slice(-1)[0],S=(i.host||t.host||E.length>1)&&("."===T||".."===T)||""===T,C=0,A=E.length;A>=0;A--)"."===(T=E[A])?E.splice(A,1):".."===T?(E.splice(A,1),C++):C&&(E.splice(A,1),C--);if(!x&&!b)for(;C--;C)E.unshift("..");!x||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),S&&"/"!==E.join("/").substr(-1)&&E.push("");var I,P=""===E[0]||E[0]&&"/"===E[0].charAt(0);w&&(i.hostname=P?"":E.length?E.shift():"",i.host=i.hostname,(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.hostname=I.shift(),i.host=i.hostname));return(x=x||i.host&&E.length)&&!P&&E.unshift(""),E.length>0?i.pathname=E.join("/"):(i.pathname=null,i.path=null),null===i.pathname&&null===i.search||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=y,e.DB=function(t,e){return y(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=y(t)),t instanceof r?t.format():r.prototype.format.call(t)}},654:()=>{}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(t||{}),e=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(e||{}),s=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(s||{}),r=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(r||{}),n=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(n||{}),o=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(o||{}),a=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(a||{}),h=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(h||{}),l=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(l||{}),c=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(c||{}),u=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(u||{}),d=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(d||{}),p=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(p||{}),f=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(f||{}),m=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(m||{}),_=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(_||{}),g=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(g||{}),y=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(y||{}),v=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(v||{});const x={createCanvas:(t,e)=>{const i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},b={ADAPTER:x,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var E=/iPhone/i,w=/iPod/i,T=/iPad/i,S=/\biOS-universal(?:.+)Mac\b/i,C=/\bAndroid(?:.+)Mobile\b/i,A=/Android/i,I=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,P=/Silk/i,R=/Windows Phone/i,M=/\bWindows(?:.+)ARM\b/i,D=/BlackBerry/i,k=/BB10/i,N=/Opera Mini/i,O=/\b(CriOS|Chrome)(?:.+)Mobile/i,F=/Mobile(?:.+)Firefox\b/i,L=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function B(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,s=i.split("[FBAN");void 0!==s[1]&&(i=s[0]),void 0!==(s=i.split("Twitter"))[1]&&(i=s[0]);var r=function(t){return function(e){return e.test(t)}}(i),n={apple:{phone:r(E)&&!r(R),ipod:r(w),tablet:!r(E)&&(r(T)||L(e))&&!r(R),universal:r(S),device:(r(E)||r(w)||r(T)||r(S)||L(e))&&!r(R)},amazon:{phone:r(I),tablet:!r(I)&&r(P),device:r(I)||r(P)},android:{phone:!r(R)&&r(I)||!r(R)&&r(C),tablet:!r(R)&&!r(I)&&!r(C)&&(r(P)||r(A)),device:!r(R)&&(r(I)||r(P)||r(C)||r(A))||r(/\bokhttp\b/i)},windows:{phone:r(R),tablet:r(M),device:r(R)||r(M)},other:{blackberry:r(D),blackberry10:r(k),opera:r(N),firefox:r(F),chrome:r(O),device:r(D)||r(k)||r(N)||r(F)||r(O)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const U=(B.default??B)(globalThis.navigator);b.RETINA_PREFIX=/@([0-9\.]+)x/,b.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var G=i(729),H=i(187),j=i(575);const W={parse:j.Qc,format:j.WU,resolve:j.DB};function z(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function V(t){return t.split("?")[0].split("#")[0]}const X={toPosix(t){return e="\\",i="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),i);var e,i},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){z(t),t=this.toPosix(t);let e="";const i=/^file:\/\/\//.exec(t),s=/^[^/:]+:\/\//.exec(t),r=/^[^/:]+:\//.exec(t);if(i||s||r){const n=i?.[0]||s?.[0]||r?.[0];e=n,t=t.slice(n.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;const s=V(this.toPosix(e??b.ADAPTER.getBaseUrl())),r=V(this.toPosix(i??this.rootname(s)));if(z(t),(t=this.toPosix(t)).startsWith("/"))return X.join(r,t.slice(1));return this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(z(t=this.toPosix(t)),0===t.length)return".";let e="";const i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return t=function(t,e){let i="",s=0,r=-1,n=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(r===a-1||1===n);else if(r!==a-1&&2===n){if(i.length<2||2!==s||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){const t=i.lastIndexOf("/");if(t!==i.length-1){-1===t?(i="",s=0):(i=i.slice(0,t),s=i.length-1-i.lastIndexOf("/")),r=a,n=0;continue}}else if(2===i.length||1===i.length){i="",s=0,r=a,n=0;continue}e&&(i.length>0?i+="/..":i="..",s=2)}else i.length>0?i+=`/${t.slice(r+1,a)}`:i=t.slice(r+1,a),s=a-r-1;r=a,n=0}else 46===o&&-1!==n?++n:n=-1}return i}(t,!1),t.length>0&&s&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return z(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let i=0;i<t.length;++i){const s=t[i];if(z(s),s.length>0)if(void 0===e)e=s;else{const r=t[i-1]??"";this.extname(r)?e+=`/../${s}`:e+=`/${s}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(z(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const i=47===e;let s=-1,r=!0;const n=this.getProtocol(t),o=t;for(let i=(t=t.slice(n.length)).length-1;i>=1;--i)if(e=t.charCodeAt(i),47===e){if(!r){s=i;break}}else r=!1;return-1===s?i?"/":this.isUrl(o)?n+t:n:i&&1===s?"//":n+t.slice(0,s)},rootname(t){z(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const i=t.indexOf("/",e.length);e=-1!==i?t.slice(0,i):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){z(t),e&&z(e),t=V(this.toPosix(t));let i,s=0,r=-1,n=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const h=t.charCodeAt(i);if(47===h){if(!n){s=i+1;break}}else-1===a&&(n=!1,a=i+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(r=i):(o=-1,r=a))}return s===r?r=a:-1===r&&(r=t.length),t.slice(s,r)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!n){s=i+1;break}}else-1===r&&(n=!1,r=i+1);return-1===r?"":t.slice(s,r)},extname(t){z(t);let e=-1,i=0,s=-1,r=!0,n=0;for(let o=(t=V(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===s&&(r=!1,s=o+1),46===a?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!r){i=o+1;break}}return-1===e||-1===s||0===n||1===n&&e===s-1&&e===i+1?"":t.slice(e,s)},parse(t){z(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let i=(t=V(this.toPosix(t))).charCodeAt(0);const s=this.isAbsolute(t);let r;e.root=this.rootname(t),r=s||this.hasProtocol(t)?1:0;let n=-1,o=0,a=-1,h=!0,l=t.length-1,c=0;for(;l>=r;--l)if(i=t.charCodeAt(l),47!==i)-1===a&&(h=!1,a=l+1),46===i?-1===n?n=l:1!==c&&(c=1):-1!==n&&(c=-1);else if(!h){o=l+1;break}return-1===n||-1===a||0===c||1===c&&n===a-1&&n===o+1?-1!==a&&(e.base=e.name=0===o&&s?t.slice(1,a):t.slice(o,a)):(0===o&&s?(e.name=t.slice(1,n),e.base=t.slice(1,a)):(e.name=t.slice(o,n),e.base=t.slice(o,a)),e.ext=t.slice(n,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},$={};function Y(t,e,i=3){if($[e])return;let s=(new Error).stack;void 0===s||(s=s.split("\n").splice(i).join("\n"),console.groupCollapsed),$[e]=!0}let q;var K={grad:.9,turn:360,rad:360/(2*Math.PI)},Q=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Z=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},J=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t>i?i:t>e?t:e},tt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},et=function(t){return{r:J(t.r,0,255),g:J(t.g,0,255),b:J(t.b,0,255),a:J(t.a)}},it=function(t){return{r:Z(t.r),g:Z(t.g),b:Z(t.b),a:Z(t.a,3)}},st=/^#([0-9a-f]{3,8})$/i,rt=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},nt=function(t){var e=t.r,i=t.g,s=t.b,r=t.a,n=Math.max(e,i,s),o=n-Math.min(e,i,s),a=o?n===e?(i-s)/o:n===i?2+(s-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},ot=function(t){var e=t.h,i=t.s,s=t.v,r=t.a;e=e/360*6,i/=100,s/=100;var n=Math.floor(e),o=s*(1-i),a=s*(1-(e-n)*i),h=s*(1-(1-e+n)*i),l=n%6;return{r:255*[s,a,o,o,h,s][l],g:255*[h,s,s,a,o,o][l],b:255*[o,o,h,s,s,a][l],a:r}},at=function(t){return{h:tt(t.h),s:J(t.s,0,100),l:J(t.l,0,100),a:J(t.a)}},ht=function(t){return{h:Z(t.h),s:Z(t.s),l:Z(t.l),a:Z(t.a,3)}},lt=function(t){return ot((i=(e=t).s,{h:e.h,s:(i*=((s=e.l)<50?s:100-s)/100)>0?2*i/(s+i)*100:0,v:s+i,a:e.a}));var e,i,s},ct=function(t){return{h:(e=nt(t)).h,s:(r=(200-(i=e.s))*(s=e.v)/100)>0&&r<200?i*s/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,i,s,r},ut=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,dt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ft=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mt={string:[[function(t){var e=st.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Z(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Z(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=pt.exec(t)||ft.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:et({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=ut.exec(t)||dt.exec(t);if(!e)return null;var i,s,r=at({h:(i=e[1],s=e[2],void 0===s&&(s="deg"),Number(i)*(K[s]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return lt(r)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,s=t.b,r=t.a,n=void 0===r?1:r;return Q(e)&&Q(i)&&Q(s)?et({r:Number(e),g:Number(i),b:Number(s),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,i=t.s,s=t.l,r=t.a,n=void 0===r?1:r;if(!Q(e)||!Q(i)||!Q(s))return null;var o=at({h:Number(e),s:Number(i),l:Number(s),a:Number(n)});return lt(o)},"hsl"],[function(t){var e=t.h,i=t.s,s=t.v,r=t.a,n=void 0===r?1:r;if(!Q(e)||!Q(i)||!Q(s))return null;var o=function(t){return{h:tt(t.h),s:J(t.s,0,100),v:J(t.v,0,100),a:J(t.a)}}({h:Number(e),s:Number(i),v:Number(s),a:Number(n)});return ot(o)},"hsv"]]},_t=function(t,e){for(var i=0;i<e.length;i++){var s=e[i][0](t);if(s)return[s,e[i][1]]}return[null,void 0]},gt=function(t){return"string"==typeof t?_t(t.trim(),mt.string):"object"==typeof t&&null!==t?_t(t,mt.object):[null,void 0]},yt=function(t,e){var i=ct(t);return{h:i.h,s:J(i.s+100*e,0,100),l:i.l,a:i.a}},vt=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},xt=function(t,e){var i=ct(t);return{h:i.h,s:i.s,l:J(i.l+100*e,0,100),a:i.a}},bt=function(){function t(t){this.parsed=gt(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Z(vt(this.rgba),2)},t.prototype.isDark=function(){return vt(this.rgba)<.5},t.prototype.isLight=function(){return vt(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=it(this.rgba)).r,i=t.g,s=t.b,n=(r=t.a)<1?rt(Z(255*r)):"","#"+rt(e)+rt(i)+rt(s)+n;var t,e,i,s,r,n},t.prototype.toRgb=function(){return it(this.rgba)},t.prototype.toRgbString=function(){return e=(t=it(this.rgba)).r,i=t.g,s=t.b,(r=t.a)<1?"rgba("+e+", "+i+", "+s+", "+r+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,r},t.prototype.toHsl=function(){return ht(ct(this.rgba))},t.prototype.toHslString=function(){return e=(t=ht(ct(this.rgba))).h,i=t.s,s=t.l,(r=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+r+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,r},t.prototype.toHsv=function(){return t=nt(this.rgba),{h:Z(t.h),s:Z(t.s),v:Z(t.v),a:Z(t.a,3)};var t},t.prototype.invert=function(){return Et({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Et(yt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Et(yt(this.rgba,-t))},t.prototype.grayscale=function(){return Et(yt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Et(xt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Et(xt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Et({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Z(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=ct(this.rgba);return"number"==typeof t?Et({h:t,s:e.s,l:e.l,a:e.a}):Z(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Et(t).toHex()},t}(),Et=function(t){return t instanceof bt?t:new bt(t)},wt=[];!function(t){t.forEach((function(t){wt.indexOf(t)<0&&(t(bt,mt),wt.push(t))}))}([function(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var r in i)s[i[r]]=r;var n={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,o,a=s[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!n.length)for(var u in i)n[u]=new t(i[u]).toRgb();for(var d in i){var p=(r=h,o=n[d],Math.pow(r.r-o.r,2)+Math.pow(r.g-o.g,2)+Math.pow(r.b-o.b,2));p<l&&(l=p,c=d)}return c}},e.string.push([function(e){var s=e.toLowerCase(),r="transparent"===s?"#0000":i[s];return r?new t(r).toRgb():null},"name"])}]);const Tt=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Tt)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if("number"===i||"string"===i||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,i)=>t===e[i]));if(null!==t&&null!==e){const i=Object.keys(t),s=Object.keys(e);return i.length===s.length&&i.every((i=>t[i]===e[i]))}return t===e}toRgba(){const[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,s]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*i),t[2]=Math.round(255*s),t}toRgbArray(t){t=t??[];const[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,i,s,r]=Tt.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,r=255&this._int;return e&&(i=i*t+.5|0,s=s*t+.5|0,r=r*t+.5|0),(255*t<<24)+(i<<16)+(s<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,s,r]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=r,t}normalize(t){let e,i,s,r;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,i=(t>>8&255)/255,s=(255&t)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,r=255]=t,e/=255,i/=255,s/=255,r/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=Tt.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const n=Et(t);n.isValid()&&(({r:e,g:i,b:s,a:r}=n.rgba),e/=255,i/=255,s/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=r,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*i|0)}_clamp(t,e=0,i=1){return"number"==typeof t?Math.min(Math.max(t,e),i):(t.forEach(((s,r)=>{t[r]=Math.min(Math.max(s,e),i)})),t)}};let St=Tt;St.shared=new Tt,St.temp=new Tt,St.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Ct=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[r.NORMAL_NPM]=r.NORMAL,t[r.ADD_NPM]=r.ADD,t[r.SCREEN_NPM]=r.SCREEN,e[r.NORMAL]=r.NORMAL_NPM,e[r.ADD]=r.ADD_NPM,e[r.SCREEN]=r.SCREEN_NPM;const i=[];return i.push(e),i.push(t),i}();function At(t,e){return Ct[e?1:0][t]}function It(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Float32Array,Uint32Array,Int32Array,Uint8Array;function Pt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Rt(t){return!(t&t-1||!t)}function Mt(t){let e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,i=((t>>>=i)>15?1:0)<<2,e|=i,i=((t>>>=i)>3?1:0)<<1,e|=i,e|(t>>>=i)>>1}function Dt(t,e,i){const s=t.length;let r;if(e>=s||0===i)return;const n=s-(i=e+i>s?s-e:i);for(r=e;r<n;++r)t[r]=t[r+i];t.length=n}function kt(t){return 0===t?0:t<0?-1:1}let Nt=0;function Ot(){return++Nt}const Ft=class{constructor(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Lt=Ft;Lt.EMPTY=new Ft(0,0,0,0);const Bt={},Ut=Object.create(null),Gt=Object.create(null);class Ht{constructor(t,e,i){this._canvas=b.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||b.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function jt(t,e,i){for(let s=0,r=4*i*e;s<e;++s,r+=4)if(0!==t[r+3])return!1;return!0}function Wt(t,e,i,s,r){const n=4*e;for(let e=s,o=s*n+4*i;e<=r;++e,o+=n)if(0!==t[o+3])return!1;return!0}function zt(t){const e=function(t){const{width:e,height:i}=t,s=t.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");const r=s.getImageData(0,0,e,i).data;let n=0,o=0,a=e-1,h=i-1;for(;o<i&&jt(r,e,o);)++o;if(o===i)return Lt.EMPTY;for(;jt(r,e,h);)--h;for(;Wt(r,e,n,o,h);)++n;for(;Wt(r,e,a,o,h);)--a;return++a,++h,new Lt(n,o,a,h)}(t),{width:i,height:s}=e;let r=null;if(!e.isEmpty()){const n=t.getContext("2d");if(null===n)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(e.left,e.top,i,s)}return{width:i,height:s,data:r}}let Vt;function Xt(t,e=1){const i=b.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var $t=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))($t||{});const Yt=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},qt=(t,e)=>Yt(t).priority??e,Kt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Yt).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(Yt).forEach((t=>{t.type.forEach((e=>{const i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))}))})),this},handle(t,e,i){const s=this._addHandlers,r=this._removeHandlers;if(s[t]||r[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=e,r[t]=i;const n=this._queue;return n[t]&&(n[t].forEach((t=>e(t))),delete n[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,i=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>qt(e,i)-qt(t,i))))}),(t=>{const i=e.indexOf(t.ref);-1!==i&&e.splice(i,1)}))}};class Qt{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Zt=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Jt(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class te{constructor(){this.data=0,this.blendMode=r.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==r.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new te;return t.depthTest=!1,t.blend=!0,t}}const ee=[];function ie(t,e){if(!t)return null;let i="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(i=e[1].toLowerCase())}for(let s=ee.length-1;s>=0;--s){const r=ee[s];if(r.test&&r.test(t,i))return new r(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class se{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,r,n,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,i,s,r,n,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(se.prototype,{dispatch:{value:se.prototype.emit},run:{value:se.prototype.emit}});class re{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new se("setRealSize"),this.onUpdate=new se("update"),this.onError=new se("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class ne extends re{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK);const r=e.realWidth,n=e.realHeight;return i.width===r&&i.height===n?s.texSubImage2D(e.target,0,0,0,r,n,e.format,i.type,this.data):(i.width=r,i.height=n,s.texImage2D(e.target,0,i.internalFormat,r,n,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const oe={scaleMode:c.NEAREST,format:o.RGBA,alphaMode:p.NPM},ae=class extends G{constructor(t=null,e=null){super(),e=Object.assign({},ae.defaultOptions,e);const{alphaMode:i,mipmap:s,anisotropicLevel:r,scaleMode:n,width:o,height:a,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:p}=e;!t||t instanceof re||((t=ie(t,p)).internal=!0),this.resolution=d||b.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=n,this.format=l,this.type=c,this.target=u,this.alphaMode=i,this.uid=Ot(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Rt(this.realWidth)&&Rt(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Gt[this.cacheId],delete Ut[this.cacheId],this.cacheId=null),this.dispose(),ae.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=b.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;if(s)r=t;else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Ot()}`}r=t._pixiId}let n=Gt[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new ae(t,e),n.cacheId=r,ae.addToCache(n,r)),n}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);const r=new ne(t,{width:e,height:i}),n=t instanceof Float32Array?h.FLOAT:h.UNSIGNED_BYTE;return new ae(r,Object.assign({},oe,{type:n},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Gt[e]&&Gt[e],Gt[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Gt[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Gt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Gt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let he=ae;he.defaultOptions={mipmap:d.POW2,anisotropicLevel:0,scaleMode:c.LINEAR,wrapMode:u.CLAMP,alphaMode:p.UNPACK,target:a.TEXTURE_2D,format:o.RGBA,type:h.UNSIGNED_BYTE},he._globalBatch=0;class le{constructor(){this.texArray=null,this.blend=0,this.type=n.TRIANGLES,this.start=0,this.size=0,this.data=null}}let ce=0;class ue{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=ce++,this.disposeRunner=new se("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER}get index(){return this.type===v.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ue(t)}}class de{constructor(t,e=0,i=!1,s=h.FLOAT,r,n,o,a=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=r,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,i,s,r){return new de(t,e,i,s,r)}}const pe={Float32Array,Uint32Array,Int32Array,Uint8Array};const fe={5126:4,5123:2,5121:1};let me=0;const _e={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ge{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=me++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new se("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,r,n,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ue||(e instanceof Array&&(e=new Float32Array(e)),e=new ue(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,i,s,r);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new de(l,i,s,r,n,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ue||(t instanceof Array&&(t=new Uint16Array(t)),t=new ue(t)),t.type=v.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new ue;let s;for(s in this.attributes){const i=this.attributes[s],r=this.buffers[i.buffer];t.push(r.data),e.push(i.size*fe[i.type]/4),i.buffer=0}for(i.data=function(t,e){let i=0,s=0;const r={};for(let r=0;r<t.length;r++)s+=e[r],i+=t[r].length;const n=new ArrayBuffer(4*i);let o=null,a=0;for(let i=0;i<t.length;i++){const h=e[i],l=t[i],c=It(l);r[c]||(r[c]=new pe[c](n)),o=r[c];for(let t=0;t<l.length;t++)o[(t/h|0)*s+a+t%h]=l[t];a+=h}return new Float32Array(n)}(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ge;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new ue(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new de(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=v.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ge,i=[],s=[],r=[];let n;for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)s[t]=s[t]||0,s[t]+=n.buffers[t].data.length,r[t]=0}for(let t=0;t<n.buffers.length;t++)i[t]=new(_e[It(n.buffers[t].data)])(s[t]),e.buffers[t]=new ue(i[t]);for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)i[t].set(n.buffers[t].data,r[t]),r[t]+=n.buffers[t].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=v.ELEMENT_ARRAY_BUFFER;let i=0,s=0,r=0,o=0;for(let t=0;t<n.buffers.length;t++)if(n.buffers[t]!==n.indexBuffer){o=t;break}for(const t in n.attributes){const e=n.attributes[t];(0|e.buffer)===o&&(s+=e.size*fe[e.type]/4)}for(let n=0;n<t.length;n++){const a=t[n].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+r]+=i;i+=t[n].buffers[o].data.length/s,r+=a.length}}return e}}class ye extends ge{constructor(t=!1){super(),this._buffer=new ue(null,t,!1),this._indexBuffer=new ue(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,h.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,h.FLOAT).addAttribute("aColor",this._buffer,4,!0,h.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,h.FLOAT).addIndex(this._indexBuffer)}}const ve=2*Math.PI,xe=180/Math.PI,be=Math.PI/180;var Ee=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Ee||{});class we{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new we(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Te=[new we,new we,new we,new we];class Se{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=Ee.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Se(0,0,0,0)}clone(){return new Se(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const i=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>i}const i=this.left,s=this.right,r=this.top,n=this.bottom;if(s<=i||n<=r)return!1;const o=Te[0].set(t.left,t.top),a=Te[1].set(t.left,t.bottom),h=Te[2].set(t.right,t.top),l=Te[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=i||Math.min(o.x,a.x,h.x,l.x)>=s||Math.max(o.y,a.y,h.y,l.y)<=r||Math.min(o.y,a.y,h.y,l.y)>=n)return!1;const u=c*(a.y-o.y),d=c*(o.x-a.x),p=u*i+d*r,f=u*s+d*r,m=u*i+d*n,_=u*s+d*n;if(Math.max(p,f,m,_)<=u*o.x+d*o.y||Math.min(p,f,m,_)>=u*l.x+d*l.y)return!1;const g=c*(o.y-h.y),y=c*(h.x-o.x),v=g*i+y*r,x=g*s+y*r,b=g*i+y*n,E=g*s+y*n;return!(Math.max(v,x,b,E)<=g*o.x+y*o.y||Math.min(v,x,b,E)>=g*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=r-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ce{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Ee.CIRC}clone(){return new Ce(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-t,r=this.y-e;return s*=s,r*=r,s+r<=i}getBounds(){return new Se(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ae{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=Ee.ELIP}clone(){return new Ae(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Se(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ie{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,s=e.length;i<s;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.type=Ee.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Ie(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let r=0,n=s-1;r<s;n=r++){const s=this.points[2*r],o=this.points[2*r+1],a=this.points[2*n],h=this.points[2*n+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-s)+s&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class Pe{constructor(t=0,e=0,i=0,s=0,r=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=r,this.type=Ee.RREC}clone(){return new Pe(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),r=e-(this.y+i);const n=i*i;if(s*s+r*r<=n)return!0;if(s=t-(this.x+this.width-i),s*s+r*r<=n)return!0;if(r=e-(this.y+this.height-i),s*s+r*r<=n)return!0;if(s=t-(this.x+i),s*s+r*r<=n)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Re{constructor(t=1,e=0,i=0,s=1,r=0,n=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,r,n){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new we;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new we;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,n=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}setTransform(t,e,i,s,r,n,o,a,h){return this.a=Math.cos(o+h)*r,this.b=Math.sin(o+h)*r,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,i=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,r=this.d,n=t.pivot,o=-Math.atan2(-s,r),a=Math.atan2(i,e),h=Math.abs(o+a);return h<1e-5||Math.abs(ve-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+r*r),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*i+n.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,n=t*s-e*i;return this.a=s/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-s*r)/n,this.ty=-(t*this.ty-e*r)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Re;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Re}static get TEMP_MATRIX(){return new Re}}const Me=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],De=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ke=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ne=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Oe=[],Fe=[],Le=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Oe.push(e);for(let i=0;i<16;i++){const s=Le(Me[t]*Me[i]+ke[t]*De[i]),r=Le(De[t]*Me[i]+Ne[t]*De[i]),n=Le(Me[t]*ke[i]+ke[t]*Ne[i]),o=Le(De[t]*ke[i]+Ne[t]*Ne[i]);for(let t=0;t<16;t++)if(Me[t]===s&&De[t]===r&&ke[t]===n&&Ne[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Re;e.set(Me[t],De[t],ke[t],Ne[t],0,0),Fe.push(e)}}();const Be={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Me[t],uY:t=>De[t],vX:t=>ke[t],vY:t=>Ne[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Oe[t][e],sub:(t,e)=>Oe[t][Be.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Be.S:Be.N:2*Math.abs(e)<=Math.abs(t)?t>0?Be.E:Be.W:e>0?t>0?Be.SE:Be.SW:t>0?Be.NE:Be.NW,matrixAppendRotationInv:(t,e,i=0,s=0)=>{const r=Fe[Be.inv(e)];r.tx=i,r.ty=s,t.append(r)}};class Ue{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ue(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Ge=class{constructor(){this.worldTransform=new Re,this.localTransform=new Re,this.position=new Ue(this.onChange,this,0,0),this.scale=new Ue(this.onChange,this,1,1),this.pivot=new Ue(this.onChange,this,0,0),this.skew=new Ue(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const i=t.worldTransform,s=this.worldTransform;s.a=e.a*i.a+e.b*i.c,s.b=e.a*i.b+e.b*i.d,s.c=e.c*i.a+e.d*i.c,s.d=e.c*i.b+e.d*i.d,s.tx=e.tx*i.a+e.ty*i.c+i.tx,s.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let He=Ge;He.IDENTITY=new Ge;const je=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],We={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},ze={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const Ve={};let Xe,$e=Ve;function Ye(){if(!Xe){Xe=_.MEDIUM;const e=function(){if($e===Ve||$e?.isContextLost()){const e=b.ADAPTER.createCanvas();let i;b.PREFER_ENV>=t.WEBGL2&&(i=e.getContext("webgl2",{})),i||(i=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),i?i.getExtension("WEBGL_draw_buffers"):i=null),$e=i}return $e}();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Xe=t.precision?_.HIGH:_.MEDIUM}}return Xe}const qe={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ke(t){return qe[t]}let Qe=null;const Ze={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Je(t,e){if(!Qe){const e=Object.keys(Ze);Qe={};for(let i=0;i<e.length;++i){const s=e[i];Qe[t[s]]=Ze[s]}}return Qe[e]}function ti(t,e,i){if("precision"!==t.substring(0,9)){let s=e;return e===_.HIGH&&i!==_.HIGH&&(s=_.MEDIUM),`precision ${s} float;\n${t}`}return i!==_.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let ei=0;const ii={},si=class{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=ei++,this.vertexSrc=t||si.defaultVertexSrc,this.fragmentSrc=e||si.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),ii[i]?(ii[i]++,i+=`-${ii[i]}`):ii[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=ti(this.vertexSrc,si.defaultVertexPrecision,_.HIGH),this.fragmentSrc=ti(this.fragmentSrc,si.defaultFragmentPrecision,Ye())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,i){const s=t+e;let r=Bt[s];return r||(Bt[s]=r=new si(t,e,i)),r}};let ri=si;ri.defaultVertexPrecision=_.HIGH,ri.defaultFragmentPrecision=U.apple.device?_.HIGH:_.MEDIUM;let ni=0;class oi{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ni++,this.static=!!e,this.ubo=!!i,t instanceof ue?(this.buffer=t,this.buffer.type=v.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ue(new Float32Array(1)),this.buffer.type=v.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new oi(e,i)}static from(t,e,i){return new oi(t,e,i)}static uboFrom(t,e){return new oi(t,e??!0,!0)}}class ai{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof oi?e:new oi(e):new oi({}),this.disposeRunner=new se("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=ri.from(t,e);return new ai(s,i)}}class hi{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=oi.from({uSamplers:e},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ri(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Re,default:this.defaultGroupCache[t]};return new ai(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class li{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class ci{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const ui=class extends ci{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=ye,this.vertexSize=6,this.state=te.for2d(),this.size=4*ui.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const i=b.ADAPTER.getNavigator();if(U.tablet||U.phone){if(U.apple.device){const t=i.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(U.android.device){const t=i.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!U.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Y(0,"BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=ui.defaultVertexSrc,fragment:e=ui.defaultFragmentTemplate}={}){this.shaderGenerator=new hi(t,e)}contextChange(){const e=this.renderer.gl;b.PREFER_ENV===t.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ui.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const s=Zt.replace(/%forloop%/gi,Jt(t));if(e.shaderSource(i,s),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=ui,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new le);for(;e.length<s;)e.push(new li);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=ui._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let o=++he._globalBatch,a=0,h=i[0],l=0;s.copyBoundTextures(r,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==o&&(h.count>=e&&(s.boundArray(h,r,o,e),this.buildDrawCalls(h,l,c),l=c,h=i[++a],++o),u._batchEnabled=o,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(s.boundArray(h,r,o,e),this.buildDrawCalls(h,l,this._bufferSize),++a,++o);for(let t=0;t<r.length;t++)r[t]=null;he._globalBatch=o}buildDrawCalls(t,e,i){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:n,vertexSize:o}=this,a=ui._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=a[h];u.start=this._iIndex,u.texArray=t;for(let d=e;d<i;++d){const i=s[d],p=i._texture.baseTexture,f=Ct[p.alphaMode?1:0][i.blendMode];s[d]=null,e<d&&u.blend!==f&&(u.size=c-u.start,e=d,u=a[++h],u.texArray=t,u.start=c),this.packInterleavedGeometry(i,r,n,l,c),l+=i.vertexData.length/2*o,c+=i.indices.length,u.blend=f}e<i&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;ui.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,s=ui._drawCallPool;let r=null;for(let n=0;n<t;n++){const{texArray:t,type:o,size:a,start:h,blend:l}=s[n];r!==t&&(r=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,i.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ui.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Pt(Math.ceil(t/8)),i=Mt(e),s=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new Qt(s*this.vertexSize*4)),r}getIndexBuffer(t){const e=Pt(Math.ceil(t/12)),i=Mt(e),s=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(t,e,i,s,r){const{uint32View:n,float32View:o}=e,a=s/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=St.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let t=0;t<c.length;t+=2)o[s++]=c[t],o[s++]=c[t+1],o[s++]=h[t],o[s++]=h[t+1],n[s++]=p,o[s++]=u;for(let t=0;t<l.length;t++)i[r++]=a+l[t]}};let di=ui;di.defaultBatchSize=4096,di.extension={name:"batch",type:$t.RendererPlugin},di._drawCallPool=[],di._textureArrayPool=[],Kt.add(di);const pi=class extends ai{constructor(t,e,i){super(ri.from(t||pi.defaultVertexSrc,e||pi.defaultFragmentSrc),i),this.padding=0,this.resolution=pi.defaultResolution,this.multisample=pi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new te}apply(t,e,i,s,r){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let fi=pi;fi.defaultResolution=1,fi.defaultMultisample=y.NONE;class mi{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new St(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:s}=t,r=i??e;void 0!==r&&(this.color=r),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}mi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},mi.extension={type:[$t.RendererSystem,$t.CanvasRendererSystem],name:"background"},Kt.add(mi);class _i{constructor(t){this.renderer=t,this.emptyRenderer=new ci(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:r,ids:n,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=r[t],h=o._batchLocation;if(h>=0&&h<s&&e[h]===o)n[t]=h;else for(;a<s;){const s=e[a];if(!s||s._batchEnabled!==i||s._batchLocation!==a){n[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}_i.extension={type:$t.RendererSystem,name:"batch"},Kt.add(_i);let gi=0;class yi{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=gi++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=gi++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(e,i){let s;if(b.PREFER_ENV>=t.WEBGL2&&(s=e.getContext("webgl2",i)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&e.stencil;const s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s}}yi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},yi.extension={type:$t.RendererSystem,name:"context"},Kt.add(yi);class vi extends ne{upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK);const r=e.realWidth,n=e.realHeight;return i.width===r&&i.height===n?s.texSubImage2D(e.target,0,0,0,r,n,e.format,i.type,this.data):(i.width=r,i.height=n,s.texImage2D(e.target,0,i.internalFormat,r,n,0,e.format,i.type,this.data)),!0}}class xi{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new se("disposeFramebuffer"),this.multisample=y.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new he(null,{scaleMode:c.NEAREST,resolution:1,mipmap:d.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new he(new vi(null,{width:this.width,height:this.height}),{scaleMode:c.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:d.OFF,format:o.DEPTH_COMPONENT,type:h.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(t/r,e/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class bi extends he{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=y.NONE),super(null,t),this.mipmap=d.OFF,this.valid=!0,this._clear=new St([0,0,0,0]),this.framebuffer=new xi(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ei extends re{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,Vt||(Vt=document.createElement("a")),Vt.href=t;const i=W.parse(Vt.href),s=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&s&&i.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,i,s){const r=t.gl,n=e.realWidth,o=e.realHeight;if(s=s||this.source,"undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement){if(!s.complete||0===s.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&s instanceof HTMLVideoElement&&s.readyState<=1&&0===s.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==n||i.height!==o?(i.width=n,i.height=o,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,s),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class wi extends Ei{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Ei.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??b.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const i=this.source;this.url=i.src;const s=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?s():(i.onload=s,i.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then((t=>t.blob())).then((i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let t=!0;const s=e._glTextures;for(const r in s){const n=s[r];if(n!==i&&n.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class Ti{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,r=e.height;if(i){const e=t.width/2/s,n=t.height/2/r,o=t.x/s+e,a=t.y/r+n;i=Be.add(i,Be.NW),this.x0=o+e*Be.uX(i),this.y0=a+n*Be.uY(i),i=Be.add(i,2),this.x1=o+e*Be.uX(i),this.y1=a+n*Be.uY(i),i=Be.add(i,2),this.x2=o+e*Be.uX(i),this.y2=a+n*Be.uY(i),i=Be.add(i,2),this.x3=o+e*Be.uX(i),this.y3=a+n*Be.uY(i)}else this.x0=t.x/s,this.y0=t.y/r,this.x1=(t.x+t.width)/s,this.y1=t.y/r,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/r,this.x3=t.x/s,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Si=new Ti;function Ci(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Ai extends G{constructor(t,e,i,s,r,n,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Se(0,0,1,1)),t instanceof Ai&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this._uvs=Si,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new we(n.x,n.y):new we(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&Ut[t.url]&&Ai.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ai.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Ai(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Si&&(this._uvs=new Ti),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=b.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;if(s)r=t;else if(t instanceof he){if(!t.cacheId){const i=e?.pixiIdPrefix||"pixiid";t.cacheId=`${i}-${Ot()}`,he.addToCache(t,t.cacheId)}r=t.cacheId}else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Ot()}`}r=t._pixiId}let n=Ut[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return n||t instanceof he?!n&&t instanceof he&&(n=new Ai(t),Ai.addToCache(n,r)):(e.resolution||(e.resolution=Xt(t)),n=new Ai(new he(t,e)),n.baseTexture.cacheId=r,he.addToCache(n.baseTexture,r),Ai.addToCache(n,r)),n}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),s=Ai.from(t,Object.assign({resourceOptions:i},e),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then((()=>Promise.resolve(s)))}static fromBuffer(t,e,i,s){return new Ai(he.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const r=new he(t,Object.assign({scaleMode:he.defaultOptions.scaleMode,resolution:Xt(e)},s)),{resource:n}=r;n instanceof wi&&(n.url=e);const o=new Ai(r);return i||(i=e),he.addToCache(o.baseTexture,i),Ai.addToCache(o,i),i!==e&&(he.addToCache(o.baseTexture,e),Ai.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ut[e]&&Ut[e],Ut[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Ut[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ut[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ut[t.textureCacheIds[e]]===t&&delete Ut[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:r}=t,n=e+s>this.baseTexture.width,o=i+r>this.baseTexture.height;if(n||o){const t=n&&o?"and":"or",a=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,h=`Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=s&&r&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ai._EMPTY||(Ai._EMPTY=new Ai(new he),Ci(Ai._EMPTY),Ci(Ai._EMPTY.baseTexture)),Ai._EMPTY}static get WHITE(){if(!Ai._WHITE){const t=b.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ai._WHITE=new Ai(he.from(t)),Ci(Ai._WHITE),Ci(Ai._WHITE.baseTexture)}return Ai._WHITE}}class Ii extends Ai{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,r=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=r>0&&n>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(r,n),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ii(new bi(t))}}class Pi{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=y.NONE){const s=new bi(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ii(s)}getOptimalTexture(t,e,i=1,s=y.NONE){let r;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?r=s>1?-s:-1:(r=((65535&(t=Pt(t)))<<16|65535&(e=Pt(e)))>>>0,s>1&&(r+=4294967296*s)),this.texturePool[r]||(this.texturePool[r]=[]);let n=this.texturePool[r].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=r,n.setResolution(i),n}getFilterTexture(t,e,i){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||y.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Pi.SCREEN_KEY=-1;class Ri extends ge{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Mi extends ge{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ue(this.vertices),this.uvBuffer=new ue(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Di{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=y.NONE,this.sourceFrame=new Se,this.destinationFrame=new Se,this.bindingSourceFrame=new Se,this.bindingDestinationFrame=new Se,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ki=[new we,new we,new we,new we],Ni=new Re;class Oi{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Pi,this.statePool=[],this.quad=new Ri,this.quadUv=new Mi,this.tempRect=new Se,this.activeState={},this.globalUniforms=new oi({outputFrame:new Se,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new Di,n=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,h=e[0].padding,l=e[0].autoFit,c=e[0].legacy??!0;for(let t=1;t<e.length;t++){const i=e[t];o=Math.min(o,i.resolution),a=Math.min(a,i.multisample),h=this.useMaxPadding?Math.max(h,i.padding):h+i.padding,l=l&&i.autoFit,c=c||(i.legacy??!0)}1===s.length&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(r),r.resolution=o,r.multisample=a,r.legacy=c,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(h);const u=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(Ni.copyFrom(i.projection.transform).invert(),u),l?(r.sourceFrame.fit(u),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(u)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,o,a),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=r.sourceFrame.width,d.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(n.sourceFrame),r.bindingDestinationFrame.copyFrom(n.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,n.bind(r.renderTexture,r.sourceFrame,d),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const r=s.inputSize,n=s.inputPixel,o=s.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],n[0]=Math.round(r[0]*e.resolution),n[1]=Math.round(r[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=e.sourceFrame.width*r[2]-.5*n[2],o[3]=e.sourceFrame.height*r[3]-.5*n[3],e.legacy){const t=s.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,a.renderTexture,f.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,s=this.getOptimalFilterTexture(t.width,t.height,e.resolution);s.filterFrame=t.filterFrame;let r=0;for(r=0;r<i.length-1;++r){1===r&&e.multisample>1&&(s=this.getOptimalFilterTexture(t.width,t.height,e.resolution),s.filterFrame=t.filterFrame),i[r].apply(this,t,s,f.CLEAR,e);const n=t;t=s,s=n}i[r].apply(this,t,a.renderTexture,f.BLEND,e),r>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(s)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=f.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,i.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&s.stateId||this.forceClear;(e===f.CLEAR||e===f.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const r=this.renderer;r.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(n.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(n.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=e._texture,n=t.set(s.width,0,0,s.height,i.x,i.y),o=e.worldTransform.copyTo(Re.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/r.width,1/r.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=y.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if("number"==typeof t){const i=t;t=e,e=i}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||y.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=ki[0],s=ki[1],r=ki[2],n=ki[3];i.set(e.left,e.top),s.set(e.left,e.bottom),r.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(r,r),t.apply(n,n);const o=Math.min(i.x,s.x,r.x,n.x),a=Math.min(i.y,s.y,r.y,n.y),h=Math.max(i.x,s.x,r.x,n.x),l=Math.max(i.y,s.y,r.y,n.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,i,s,r){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(r){const{a:t,b:e,c:i,d:s}=r;if((Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4))return}(r=r?Ni.copyFrom(r):Ni.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}Oi.extension={type:$t.RendererSystem,name:"filter"},Kt.add(Oi);class Fi{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=y.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Li=new Se;class Bi{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new xi(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Se,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let i=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;b.PREFER_ENV===t.WEBGL_LEGACY&&(i=null,s=null),i?e.drawBuffers=t=>i.drawBuffersWEBGL(t):(this.hasMRT=!1,e.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const i=t.colorTextures[e];this.renderer.texture.unbind(i.parentTextureArray||i)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>i,s=e.height>>i,r=t/e.width;this.setViewport(e.x*r,e.y*r,t,s)}else{const e=t.width>>i,s=t.height>>i;this.setViewport(0,0,e,s)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),r.width===i&&r.height===s&&r.x===t&&r.y===e||(r.x=t,r.y=e,r.width=i,r.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,r,n=s.COLOR|s.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,r),o.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new Fi(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const s=t.colorTextures;let r=s.length;e.drawBuffers||(r=Math.min(r,1));for(let n=0;n<r;n++){const r=s[n],o=r.parentTextureArray||r;this.renderer.texture.bind(o,0),0===n&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let n=r.length;i.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let a=0;a<n;a++){const n=r[a],h=n.parentTextureArray||n;this.renderer.texture.bind(h,0),0===a&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,n.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(o.length>1&&i.drawBuffers(o),t.depthTexture){if(this.writeDepthTexture){const s=t.depthTexture;this.renderer.texture.bind(s,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null):(s.stencil=s.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=y.NONE;if(t<=1||null===e)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return 1===i&&(i=y.NONE),i}blit(t,e,i){const{current:s,renderer:r,gl:n,CONTEXT_UID:o}=this;if(2!==r.context.webGLVersion)return;if(!s)return;const a=s.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=s.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new xi(s.width,s.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===s.width&&t.height===s.height||(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||((e=Li).width=s.width,e.height=s.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,s=t.height,r=this.gl,n=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,n),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,s):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,s),e.stencil=n,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Se}destroy(){this.renderer=null}}Bi.extension={type:$t.RendererSystem,name:"framebuffer"},Kt.add(Bi);const Ui={5126:4,5123:2,5121:1};class Gi{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==i.webGLVersion){let i=this.renderer.context.extensions.vertexArrayObject;b.PREFER_ENV===t.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=t=>i.bindVertexArrayOES(t),e.deleteVertexArray=t=>i.deleteVertexArrayOES(t)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==i.webGLVersion){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,i)=>t.vertexAttribDivisorANGLE(e,i),e.drawElementsInstanced=(e,i,s,r,n)=>t.drawElementsInstancedANGLE(e,i,s,r,n),e.drawArraysInstanced=(e,i,s,r)=>t.drawArraysInstancedANGLE(e,i,s,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===i.webGLVersion||!!i.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const n=s[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const t in s)if(!i[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,r=["g",t.id];for(const t in i)s[t]&&r.push(t,s[t].location);return r.join("-")}initGeometryVao(t,e,i=!0){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=e.program;o.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const c=t.buffers,u=t.attributes,d={},p={};for(const t in c)d[t]=0,p[t]=0;for(const t in u)!u[t].size&&o.attributeData[t]?u[t].size=o.attributeData[t].size:u[t].size,d[u[t].buffer]+=u[t].size*Ui[u[t].type];for(const t in u){const e=u[t],i=e.size;void 0===e.stride&&(d[e.buffer]===i*Ui[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=i*Ui[e.type])}l=s.createVertexArray(),s.bindVertexArray(l);for(let t=0;t<c.length;t++){const e=c[t];n.bind(e),i&&e._glBuffers[r].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,s.bindVertexArray(null),n.unbind(v.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,r=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(n)for(let t=0;t<r.length;t++){const i=r[t]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0!==i.refCount||e||n.dispose(r[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),s.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,n=t.buffers,o=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let a=null;for(const t in o){const h=o[t],l=n[h.buffer],c=l._glBuffers[s];if(e.attributeData[t]){a!==c&&(r.bind(l),a=c);const s=e.attributeData[t].location;if(i.enableVertexAttribArray(s),i.vertexAttribPointer(s,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(s,h.divisor)}}}}draw(t,e,i,s){const{gl:r}=this,n=this._activeGeometry;if(n.indexBuffer){const o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;(2===o||4===o&&this.canUseUInt32ElementIndex)&&(n.instanced?r.drawElementsInstanced(t,e||n.indexBuffer.data.length,a,(i||0)*o,s||1):r.drawElements(t,e||n.indexBuffer.data.length,a,(i||0)*o))}else n.instanced?r.drawArraysInstanced(t,i,e||n.getSize(),s||1):r.drawArrays(t,i,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Gi.extension={type:$t.RendererSystem,name:"geometry"},Kt.add(Gi);const Hi=new Re;class ji{constructor(t,e){this._texture=t,this.mapCoord=new Re,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const r=t[s],n=t[s+1];e[s]=r*i.a+n*i.c+i.tx,e[s+1]=r*i.b+n*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,r=e.trim;r&&(Hi.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Hi));const n=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/n.width,o[1]=(e._frame.y+a+h)/n.height,o[2]=(e._frame.x+e._frame.width-a+h)/n.width,o[3]=(e._frame.y+e._frame.height-a+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&0===e.rotate,!0}}class Wi extends fi{constructor(t,e,i){let s=null;"string"!=typeof t&&void 0===e&&void 0===i&&(s=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=s,this.maskMatrix=new Re}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const r=this._maskSprite,n=r._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new ji(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class zi{constructor(t=null){this.type=g.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=fi.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=g.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Vi{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const t=this.maskDataPool.pop()||new zi;t.pooled=!0,t.maskObject=e,i=t}const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==g.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case g.SCISSOR:this.renderer.scissor.push(i);break;case g.STENCIL:this.renderer.stencil.push(i);break;case g.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case g.COLOR:this.pushColorMask(i)}i.type===g.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case g.SCISSOR:this.renderer.scissor.pop(e);break;case g.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case g.SPRITE:this.popSpriteMask(e);break;case g.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===g.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=g.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=g.SCISSOR:t.type=g.STENCIL:t.type=g.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Wi]));const r=this.renderer,n=r.renderTexture;let o,a;if(n.current){const e=n.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||r.resolution,a=t.multisample??r.multisample;s[0].resolution=o,s[0].multisample=a,s[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),r.filter.push(i,s),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Vi.extension={type:$t.RendererSystem,name:"mask"},Kt.add(Vi);class Xi{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(0===s?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const $i=new Re,Yi=[],qi=class extends Xi{constructor(t){super(t),this.glConst=b.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,r=s.renderTexture,n=i.getBounds(!0,Yi.pop()??new Se);this.roundFrameToPixels(n,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:s,d:r}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(qi.isMatrixRotated(e.worldTransform))return!1;if(qi.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,r){qi.isMatrixRotated(r)||((r=r?$i.copyFrom(r):$i.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Yi.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Ki=qi;Ki.extension={type:$t.RendererSystem,name:"scissor"},Kt.add(Ki);class Qi extends Xi{constructor(t){super(t),this.glConst=b.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;0===s&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,i.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;0!==s&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==s&&(i._colorMask=s,e.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Qi.extension={type:$t.RendererSystem,name:"stencil"},Kt.add(Qi);class Zi{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(Y(0,"renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(Y(0,"renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(Y(0,"renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Zi.extension={type:[$t.RendererSystem,$t.CanvasRendererSystem],name:"_plugin"},Kt.add(Zi);class Ji{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Re,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const r=this.projectionMatrix,n=s?-1:1;r.identity(),r.a=1/e.width*2,r.d=n*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-n-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}Ji.extension={type:$t.RendererSystem,name:"projection"},Kt.add(Ji);const ts=new He;class es{constructor(t){this.renderer=t,this._tempMatrix=new Re}generateTexture(t,e){const{region:i,...s}=e||{},r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const n=Ii.create({width:r.width,height:r.height,...s});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const o=t.transform;return t.transform=ts,this.renderer.render(t,{renderTexture:n,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,n}destroy(){}}es.extension={type:[$t.RendererSystem,$t.CanvasRendererSystem],name:"textureGenerator"},Kt.add(es);const is=new Se,ss=new Se;class rs{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Se,this.destinationFrame=new Se,this.viewportFrame=new Se}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const s=this.renderer;let r,n,o;this.current=t,t?(r=t.baseTexture,o=r.resolution,e||(is.width=t.frame.width,is.height=t.frame.height,e=is),i||(ss.x=t.frame.x,ss.y=t.frame.y,ss.width=e.width,ss.height=e.height,i=ss),n=r.framebuffer):(o=s.resolution,e||(is.width=s._view.screen.width,is.height=s._view.screen.height,e=is),i||((i=is).width=e.width,i.height=e.height));const a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,t||(a.y=s.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(i,e,o,!n),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=St.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=r.width!==n.width||r.height!==n.height;if(o){let{x:t,y:e,width:i,height:s}=this.viewportFrame;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,i,s)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}rs.extension={type:$t.RendererSystem,name:"renderTexture"},Kt.add(rs);class ns{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function os(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}function as(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function hs(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return as(2*e);case"bvec3":return as(3*e);case"bvec4":return as(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function ls(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),s=t.getShaderInfoLog(e).split("\n"),r={},n=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||r[t])&&(r[t]=!0,!0))),o=[""];n.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const a=i.join("\n");o[0]=a}function cs(t,e){const i=os(t,t.VERTEX_SHADER,e.vertexSrc),s=os(t,t.FRAGMENT_SHADER,e.fragmentSrc),r=t.createProgram();t.attachShader(r,i),t.attachShader(r,s);const n=e.extra?.transformFeedbackVaryings;if(n&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(r,n.names,"separate"===n.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||function(t,e,i,s){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||ls(t,i),t.getShaderParameter(s,t.COMPILE_STATUS)||ls(t,s),t.getProgramInfoLog(e))}(t,r,i,s),e.attributeData=function(t,e){const i={},s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const s=e.getActiveAttrib(t,r);if(s.name.startsWith("gl_"))continue;const n=Je(e,s.type),o={type:n,name:s.name,size:Ke(n),location:e.getAttribLocation(t,s.name)};i[s.name]=o}return i}(r,t),e.uniformData=function(t,e){const i={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const s=e.getActiveUniform(t,r),n=s.name.replace(/\[.*?\]$/,""),o=!!s.name.match(/\[.*?\]$/),a=Je(e,s.type);i[n]={name:n,index:r,type:a,size:s.size,isArray:o,value:hs(a,s.size)}}return i}(r,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const i=Object.keys(e.attributeData);i.sort(((t,e)=>t>e?1:-1));for(let s=0;s<i.length;s++)e.attributeData[i[s]].location=s,t.bindAttribLocation(r,s,i[s]);t.linkProgram(r)}t.deleteShader(i),t.deleteShader(s);const o={};for(const i in e.uniformData){const s=e.uniformData[i];o[i]={location:t.getUniformLocation(r,i),value:hs(s.type,s.size)}}return new ns(r,o)}function us(t,e,i,s,r){i.buffer.update(r)}const ds={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},ps={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function fs(t,e){if(!t.autoManage)return{size:0,syncFunc:us};const i=function(t,e){const i=[];for(const s in t)e[s]&&i.push(e[s]);return i.sort(((t,e)=>t.index-e.index)),i}(t.uniforms,e),{uboElements:s,size:r}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let i=0,s=0,r=0;for(let t=0;t<e.length;t++){const n=e[t];if(i=ps[n.data.type],n.data.size>1&&(i=Math.max(i,16)*n.data.size),n.dataLen=i,s%i!=0&&s<16){const t=s%i%16;s+=t,r+=t}s+i>16?(r=16*Math.ceil(r/16),n.offset=r,r+=i,s=i):(n.offset=r,s+=i,r+=i)}return r=16*Math.ceil(r/16),{uboElements:e,size:r}}(i),n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<s.length;e++){const i=s[e],r=t.uniforms[i.data.name],o=i.data.name;let a=!1;for(let t=0;t<je.length;t++){const e=je[t];if(e.codeUbo&&e.test(i.data,r)){n.push(`offset = ${i.offset/4};`,je[t].codeUbo(i.data.name,r)),a=!0;break}}if(!a)if(i.data.size>1){const t=Ke(i.data.type),e=Math.max(ps[i.data.type]/16,1),s=t/e,r=(4-s%4)%4;n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${s}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const t=ds[i.data.type];n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n                ${t};\n                `)}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}let ms;let _s=0;const gs={textureCount:0,uboCount:0};class ys{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=_s++}systemCheck(){if(!function(){if("boolean"==typeof ms)return ms;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");ms=!0===t({a:"b"},"a","b")}catch(t){ms=!1}return ms}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(gs.textureCount=0,gs.uboCount=0,this.syncUniformGroup(t.uniformGroup,gs)),s}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const s in t.uniforms){const r=e[s];if(!r){t.uniforms[s]?.group&&(t.uniforms[s].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${s}, syncData);\n                    `));continue}const n=t.uniforms[s];let o=!1;for(let t=0;t<je.length;t++)if(je[t].test(r,n)){i.push(je[t].code(s,n)),o=!0;break}if(!o){const t=(1!==r.size||r.isArray?ze:We)[r.type].replace("location",`ud["${s}"].location`);i.push(`\n            cu = ud["${s}"];\n            cv = cu.value;\n            v = uv["${s}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,gs,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[n];if(o||(o=this._uboCache[n]=fs(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,r=[`${i}-`];for(const t in s)r.push(t),e[t]&&r.push(e[t].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,s=cs(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ys.extension={type:$t.RendererSystem,name:"shader"},Kt.add(ys);class vs{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello,e.resize(e.screen.width,e.screen.height)}destroy(){}}vs.defaultOptions={hello:!1},vs.extension={type:[$t.RendererSystem,$t.CanvasRendererSystem],name:"startup"},Kt.add(vs);const xs=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=r.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new te,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[r.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.ADD]=[t.ONE,t.ONE],e[r.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.NONE]=[0,0],e[r.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[r.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[r.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[r.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[r.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[r.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[r.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[r.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[r.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[r.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(xs.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(xs.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let bs=xs;bs.extension={type:$t.RendererSystem,name:"state"},Kt.add(bs);class Es extends G{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),i=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new se(t)}))}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const t in this.runners)this.runners[t].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach((s=>{const r=i.find((t=>this._systemsHash[t]===s));s[t.name](e[r])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const ws=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ws.defaultMaxIdle,this.checkCountMax=ws.defaultCheckCountMax,this.mode=ws.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==m.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let s=0;s<e.length;s++){const r=e[s];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),e[s]=null,i=!0)}if(i){let t=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[t++]=e[i]);e.length=t}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};let Ts=ws;Ts.defaultMode=m.AUTO,Ts.defaultMaxIdle=3600,Ts.defaultCheckCountMax=600,Ts.extension={type:$t.RendererSystem,name:"textureGC"},Kt.add(Ts);class Ss{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=h.UNSIGNED_BYTE,this.internalFormat=o.RGBA,this.samplerType=0}}class Cs{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new he,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[h.UNSIGNED_BYTE]:{[o.RGBA]:t.RGBA8,[o.RGB]:t.RGB8,[o.RG]:t.RG8,[o.RED]:t.R8,[o.RGBA_INTEGER]:t.RGBA8UI,[o.RGB_INTEGER]:t.RGB8UI,[o.RG_INTEGER]:t.RG8UI,[o.RED_INTEGER]:t.R8UI,[o.ALPHA]:t.ALPHA,[o.LUMINANCE]:t.LUMINANCE,[o.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[h.BYTE]:{[o.RGBA]:t.RGBA8_SNORM,[o.RGB]:t.RGB8_SNORM,[o.RG]:t.RG8_SNORM,[o.RED]:t.R8_SNORM,[o.RGBA_INTEGER]:t.RGBA8I,[o.RGB_INTEGER]:t.RGB8I,[o.RG_INTEGER]:t.RG8I,[o.RED_INTEGER]:t.R8I},[h.UNSIGNED_SHORT]:{[o.RGBA_INTEGER]:t.RGBA16UI,[o.RGB_INTEGER]:t.RGB16UI,[o.RG_INTEGER]:t.RG16UI,[o.RED_INTEGER]:t.R16UI,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[h.SHORT]:{[o.RGBA_INTEGER]:t.RGBA16I,[o.RGB_INTEGER]:t.RGB16I,[o.RG_INTEGER]:t.RG16I,[o.RED_INTEGER]:t.R16I},[h.UNSIGNED_INT]:{[o.RGBA_INTEGER]:t.RGBA32UI,[o.RGB_INTEGER]:t.RGB32UI,[o.RG_INTEGER]:t.RG32UI,[o.RED_INTEGER]:t.R32UI,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[h.INT]:{[o.RGBA_INTEGER]:t.RGBA32I,[o.RGB_INTEGER]:t.RGB32I,[o.RG_INTEGER]:t.RG32I,[o.RED_INTEGER]:t.R32I},[h.FLOAT]:{[o.RGBA]:t.RGBA32F,[o.RGB]:t.RGB32F,[o.RG]:t.RG32F,[o.RED]:t.R32F,[o.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[h.HALF_FLOAT]:{[o.RGBA]:t.RGBA16F,[o.RGB]:t.RGB16F,[o.RG]:t.RG16F,[o.RED]:t.R16F},[h.UNSIGNED_SHORT_5_6_5]:{[o.RGB]:t.RGB565},[h.UNSIGNED_SHORT_4_4_4_4]:{[o.RGBA]:t.RGBA4},[h.UNSIGNED_SHORT_5_5_5_1]:{[o.RGBA]:t.RGB5_A1},[h.UNSIGNED_INT_2_10_10_10_REV]:{[o.RGBA]:t.RGB10_A2,[o.RGBA_INTEGER]:t.RGB10_A2UI},[h.UNSIGNED_INT_10F_11F_11F_REV]:{[o.RGB]:t.R11F_G11F_B10F},[h.UNSIGNED_INT_5_9_9_9_REV]:{[o.RGB]:t.RGB9_E5},[h.UNSIGNED_INT_24_8]:{[o.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[h.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[o.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[h.UNSIGNED_BYTE]:{[o.RGBA]:t.RGBA,[o.RGB]:t.RGB,[o.ALPHA]:t.ALPHA,[o.LUMINANCE]:t.LUMINANCE,[o.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[h.UNSIGNED_SHORT_5_6_5]:{[o.RGB]:t.RGB},[h.UNSIGNED_SHORT_4_4_4_4]:{[o.RGBA]:t.RGBA},[h.UNSIGNED_SHORT_5_5_5_1]:{[o.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const i=new Ss(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ss(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<i.length;t++)i[t]===this.unknownTexture&&this.bind(null,t)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[s].samplerType!==l.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new Ss(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===h.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==l.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,r=t.realHeight,n=i.gl;(e.width!==s||e.height!==r||e.dirtyId<0)&&(e.width=s,e.height=r,n.texImage2D(t.target,0,e.internalFormat,s,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Dt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==d.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=u.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==d.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===c.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===c.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Cs.extension={type:$t.RendererSystem,name:"texture"},Kt.add(Cs);class As{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[s]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];n&&(i.buffer.update(n),n._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,n._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];if(!s)continue;const n=s._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||r.dispose(s,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}As.extension={type:$t.RendererSystem,name:"transformFeedback"},Kt.add(As);class Is{constructor(t){this.renderer=t}init(t){this.screen=new Se(0,0,t.width,t.height),this.element=t.view||b.ADAPTER.createCanvas(),this.resolution=t.resolution||b.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Is.defaultOptions={width:800,height:600,resolution:b.RESOLUTION,autoDensity:!1},Is.extension={type:[$t.RendererSystem,$t.CanvasRendererSystem],name:"_view"},Kt.add(Is),b.PREFER_ENV=t.WEBGL2,b.STRICT_TEXTURE_CACHE=!1,b.RENDER_OPTIONS={...yi.defaultOptions,...mi.defaultOptions,...Is.defaultOptions,...vs.defaultOptions},Object.defineProperties(b,{WRAP_MODE:{get:()=>he.defaultOptions.wrapMode,set(t){Y(0,"settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),he.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>he.defaultOptions.scaleMode,set(t){Y(0,"settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),he.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>he.defaultOptions.mipmap,set(t){Y(0,"settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),he.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>he.defaultOptions.anisotropicLevel,set(t){Y(0,"settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),he.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(Y(0,"settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),fi.defaultResolution),set(t){fi.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(Y(0,"settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),fi.defaultMultisample),set(t){fi.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>di.defaultMaxTextures,set(t){Y(0,"settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),di.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>di.defaultBatchSize,set(t){Y(0,"settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),di.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>di.canUploadSameBuffer,set(t){Y(0,"settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),di.canUploadSameBuffer=t}},GC_MODE:{get:()=>Ts.defaultMode,set(t){Y(0,"settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ts.defaultMode=t}},GC_MAX_IDLE:{get:()=>Ts.defaultMaxIdle,set(t){Y(0,"settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ts.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Ts.defaultCheckCountMax,set(t){Y(0,"settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ts.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>ri.defaultVertexPrecision,set(t){Y(0,"settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ri.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>ri.defaultFragmentPrecision,set(t){Y(0,"settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ri.defaultFragmentPrecision=t}}});var Ps=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Ps||{});class Rs{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Ms=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Rs(null,null,1/0),this.deltaMS=1/Ms.targetFPMS,this.elapsedMS=1/Ms.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Ps.NORMAL){return this._addListener(new Rs(t,e,i))}addOnce(t,e,i=Ps.NORMAL){return this._addListener(new Rs(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Ms.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Ms.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Ms._shared){const t=Ms._shared=new Ms;t.autoStart=!0,t._protected=!0}return Ms._shared}static get system(){if(!Ms._system){const t=Ms._system=new Ms;t.autoStart=!0,t._protected=!0}return Ms._system}};let Ds=Ms;Ds.targetFPMS=.06,Object.defineProperties(b,{TARGET_FPMS:{get:()=>Ds.targetFPMS,set(t){Y(0,"settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ds.targetFPMS=t}}});class ks{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Ps.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ds.shared:new Ds,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}ks.extension=$t.Application,Kt.add(ks);const Ns=[];Kt.handleByList($t.Renderer,Ns);const Os="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Fs{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=y.HIGH?this.multisample=y.HIGH:e>=y.MEDIUM?this.multisample=y.MEDIUM:e>=y.LOW?this.multisample=y.LOW:this.multisample=y.NONE}destroy(){}}Fs.extension={type:$t.RendererSystem,name:"_multisample"},Kt.add(Fs);class Ls{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Bs{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const n=t._glBuffers[r]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new Ls(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Bs.extension={type:$t.RendererSystem,name:"buffer"},Kt.add(Bs);class Us{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,r,n,o;if(e&&(s=e.renderTexture,r=e.clear,n=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(s||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Us.extension={type:$t.RendererSystem,name:"objectRenderer"},Kt.add(Us);const Gs=class extends Es{constructor(t){super(),this.type=e.WEBGL,t=Object.assign({},b.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new oi({projectionMatrix:new Re},!0);const i={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Gs.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(i),"useContextAlpha"in t&&(Y(0,"options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Gs.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(void 0===q&&(q=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:b.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!b.ADAPTER.getWebGLRenderingContext())return!1;const e=b.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const s=!!i?.getContextAttributes()?.stencil;if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,s}catch(t){return!1}}()),q)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Y(0,"renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Y(0,"renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Y(0,"renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Y(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Y(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Y(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Y(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Y(0,"renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Hs=Gs;Hs.extension={type:$t.Renderer,priority:1},Hs.__plugins={},Hs.__systems={},Kt.handleByMap($t.RendererPlugin,Hs.__plugins),Kt.handleByMap($t.RendererSystem,Hs.__systems),Kt.add(Hs);class js extends re{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new he;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof re?this.addResourceAt(t[i],i):this.addResourceAt(ie(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const Ws=class extends js{constructor(t,e){const{width:i,height:s,autoLoad:r,linkBaseTexture:n}=e||{};if(t&&t.length!==Ws.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let t=0;t<Ws.SIDES;t++)this.items[t].target=a.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==n,t&&this.initFromArray(t,e),!1!==r&&this.load()}bind(t){super.bind(t),t.target=a.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=a.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const s=this.itemDirtyIds;for(let r=0;r<Ws.SIDES;r++){const n=this.items[r];(s[r]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),s[r]=n.dirtyId):s[r]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[r]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Ws.SIDES}};let zs=Ws;zs.SIDES=6;class Vs extends Ei{constructor(t,e){let i,s;e=e||{},"string"==typeof t?(i=Vs.EMPTY,s=t):(i=t,s=null),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await b.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await e.blob();if(this.destroyed)return;const s=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return Vs._EMPTY=Vs._EMPTY??b.ADAPTER.createCanvas(0,0),Vs._EMPTY}}const Xs=class extends Ei{constructor(t,e){e=e||{},super(b.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Xs.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Ei.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,r=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),r=Math.round(r);const n=this.source;n.width=s,n.height=r,n._pixiId=`canvas_${Ot()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(t){const e=Xs.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Xs.SVG_XML.test(t)}};let $s=Xs;$s.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,$s.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Ys=class extends Ei{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const s=t[0].src||t[0];Ei.crossOrigin(i,s,e.crossorigin);for(let e=0;e<t.length;++e){const s=document.createElement("source");let{src:r,mime:n}=t[e];r=r||t[e];const o=r.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);n=n||Ys.MIME_TYPES[a]||`video/${a}`,s.src=r,s.type=n,i.appendChild(s)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=Ds.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ds.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ds.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Ds.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ds.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ds.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ys.TYPES.includes(e)}};let qs=Ys;qs.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qs.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},ee.push(Vs,wi,class extends Ei{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},qs,$s,ne,zs,class extends js{constructor(t,e){const{width:i,height:s}=e||{};let r,n;Array.isArray(t)?(r=t,n=t.length):n=t,super(n,{width:i,height:s}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=a.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:r,items:n}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let t=0;t<s;t++){const s=n[t];r[t]<s.dirtyId&&(r[t]=s.dirtyId,s.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,s.resource.width,s.resource.height,1,e.format,i.type,s.resource.source))}return!0}});class Ks{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Se.EMPTY:((t=t||new Se(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:r,d:n,tx:o,ty:a}=t,h=i*e.x+r*e.y+o,l=s*e.x+n*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,r=this.maxY,n=t[0],o=t[1];e=n<e?n:e,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=t[2],o=t[3],e=n<e?n:e,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=t[4],o=t[5],e=n<e?n:e,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,n=t[6],o=t[7],e=n<e?n:e,i=o<i?o:i,s=n>s?n:s,r=o>r?o:r,this.minX=e,this.minY=i,this.maxX=s,this.maxY=r}addFrame(t,e,i,s,r){this.addFrameMatrix(t.worldTransform,e,i,s,r)}addFrameMatrix(t,e,i,s,r){const n=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=n*e+a*i+l,_=o*e+h*i+c;u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*s+a*i+l,_=o*s+h*i+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*e+a*r+l,_=o*e+h*r+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*s+a*r+l,_=o*s+h*r+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,this.minX=u,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(t,e,i){let s=this.minX,r=this.minY,n=this.maxX,o=this.maxY;for(let a=e;a<i;a+=2){const e=t[a],i=t[a+1];s=e<s?e:s,r=i<r?i:r,n=e>n?e:n,o=i>o?i:o}this.minX=s,this.minY=r,this.maxX=n,this.maxY=o}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,r=0,n=r){const o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,p=this.minY,f=this.maxX,m=this.maxY;for(let t=i;t<s;t+=2){const i=e[t],s=e[t+1],_=o*i+h*s+c,g=l*s+a*i+u;d=Math.min(d,_-r),f=Math.max(f,_+r),p=Math.min(p,g-n),m=Math.max(m,g+n)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&s<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=s<e?s:e,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&s<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=s<e?s:e,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,r,n){t-=r,e-=n,i+=r,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class Qs extends G{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new He,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ks,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(Qs.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Se),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Se),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ks);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const n=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-r,n}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,r=0,n=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Zs),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*xe}set angle(t){this.transform.rotation=t*be}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Zs extends Qs{constructor(){super(...arguments),this.sortDirty=null}}Qs.prototype.displayObjectUpdateTransform=Qs.prototype.updateTransform;const Js=new Re;function tr(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const er=class extends Qs{constructor(){super(),this.children=[],this.sortableChildren=er.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Dt(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,Dt(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Dt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,s=e-i;let r;if(s>0&&s<=e){r=this.children.splice(i,s);for(let t=0;t<r.length;++t)r[t].parent=null,r[t].transform&&(r[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<r.length;++t)r[t].emit("removed",this),this.emit("childRemoved",r[t],this,t);return r}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(tr),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==er.prototype._render&&(i=this.getBounds(!0));const r=t.projection.transform;if(r&&(s?(s=Js.copyFrom(s),s.prepend(r)):s=r),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e],s=i.cullable;i.cullable=s||!this.cullArea,i.render(t),i.cullable=s}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==g.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<i.length;++e)i[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let ir=er;ir.defaultSortableChildren=!1,ir.prototype.containerUpdateTransform=ir.prototype.updateTransform,Object.defineProperties(b,{SORTABLE_CHILDREN:{get:()=>ir.defaultSortableChildren,set(t){Y(0,"settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ir.defaultSortableChildren=t}}});const sr=new we,rr=new Uint16Array([0,1,2,0,2,3]);class nr extends ir{constructor(t){super(),this._anchor=new Ue(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new St(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=r.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ai.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=rr,this.pluginName="batch",this.isSprite=!0,this._roundPixels=b.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=kt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=kt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,n=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,p=0,f=0,m=0;if(l?(p=l.x-u._x*c.width,d=p+l.width,m=l.y-u._y*c.height,f=m+l.height):(p=-u._x*c.width,d=p+c.width,m=-u._y*c.height,f=m+c.height),h[0]=i*p+r*m+o,h[1]=n*m+s*p+a,h[2]=i*d+r*m+o,h[3]=n*m+s*d+a,h[4]=i*d+r*f+o,h[5]=n*f+s*d+a,h[6]=i*p+r*f+o,h[7]=n*f+s*p+a,this._roundPixels){const t=b.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,h=r.d,l=r.tx,c=r.ty,u=-s._x*i.width,d=u+i.width,p=-s._y*i.height,f=p+i.height;e[0]=n*u+a*p+l,e[1]=h*p+o*u+c,e[2]=n*d+a*p+l,e[3]=h*p+o*d+c,e[4]=n*d+a*f+l,e[5]=h*f+o*d+c,e[6]=n*u+a*f+l,e[7]=h*f+o*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ks),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Se),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,sr);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let r=0;return sr.x>=s&&sr.x<s+e&&(r=-i*this.anchor.y,sr.y>=r&&sr.y<r+i)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof Ai?t:Ai.from(t,e);return new nr(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ai.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const or=new Re;Qs.prototype._cacheAsBitmap=!1,Qs.prototype._cacheData=null,Qs.prototype._cacheAsBitmapResolution=null,Qs.prototype._cacheAsBitmapMultisample=null;class ar{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Qs.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new ar),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Qs.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Qs.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;i.pad(t)}i.ceil(b.RESOLUTION);const s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),n=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=Ii.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${Ot()}`;this._cacheData.textureCacheId=h,he.addToCache(a.baseTexture,h),Ai.addToCache(a,h);const l=this.transform.localTransform.copyTo(or).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(s,r,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new nr(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-i.x/i.width,c.anchor.y=-i.y/i.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},Qs.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Qs.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,r=t._projTransform;e.ceil(b.RESOLUTION);const n=Ii.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${Ot()}`;this._cacheData.textureCacheId=o,he.addToCache(n.baseTexture,o),Ai.addToCache(n,o);const a=or;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:n,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new nr(n);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},Qs.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Qs.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Qs.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,he.removeFromCache(this._cacheData.textureCacheId),Ai.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Qs.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Qs.prototype.name=null,ir.prototype.getChildByName=function(t,e){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,i=this.children.length;e<i;e++){const i=this.children[e];if(!i.getChildByName)continue;const s=i.getChildByName(t,!0);if(s)return s}return null},Qs.prototype.getGlobalPosition=function(t=new we,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const hr={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},lr=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class cr extends fi{constructor(t,e=8,i=4,s=fi.defaultResolution,r=5){const n=function(t,e){const i=Math.ceil(t/2);let s,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="";s=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=s.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(i-1)+".0"),n+=t,n+="\n"}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}(r,t),o=function(t){const e=hr[t],i=e.length;let s,r=lr,n="";for(let r=0;r<t;r++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",r.toString());s=r,r>=i&&(s=t-r-1),o=o.replace("%value%",e[s].toString()),n+=o,n+="\n"}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}(r);super(n,o),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,s);else{const r=t.getFilterTexture(),n=t.renderer;let o=e,a=r;this.state.blend=!1,t.applyFilter(this,o,a,f.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,f.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,s),t.returnFilterTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class ur extends fi{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Os,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,s,r]=St.shared.setValue(t).toArray(),n=[i,0,0,0,0,0,s,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),r=1/3,n=(0,Math.sqrt)(r),o=[i+(1-i)*r,r*(1-i)-n*s,r*(1-i)+n*s,0,0,r*(1-i)+n*s,i+r*(1-i),r*(1-i)-n*s,0,0,r*(1-i)-n*s,r*(1-i)+n*s,i+r*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1),r=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(r,e)}saturate(t=0,e){const i=2*t/3+1,s=-.5*(i-1),r=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,s,r){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;const n=St.shared,[o,a,h]=n.setValue(i).toArray(),[l,c,u]=n.setValue(s).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,c,u,e,0,o-l,a-c,h-u,0,0];this._loadMatrix(d,r)}night(t,e){const i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ur.prototype.grayscale=ur.prototype.greyscale;const dr={AlphaFilter:class extends fi{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends fi{constructor(t=8,e=4,i=fi.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new cr(!0,t,e,i,s),this.blurYFilter=new cr(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){const r=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(r&&n){const r=t.getFilterTexture();this.blurXFilter.apply(t,e,r,f.CLEAR),this.blurYFilter.apply(t,r,i,s),t.returnFilterTexture(r)}else n?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:cr,ColorMatrixFilter:ur,DisplacementFilter:class extends fi{constructor(t,e){const i=new Re;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new we(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,n=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=r.a/n,this.uniforms.rotation[1]=r.b/n,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends fi{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends fi{constructor(t=.5,e=Math.random()){super(Os,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(dr).forEach((([t,e])=>{Object.defineProperty(dr,t,{get:()=>(Y(0,`filters.${t} has moved to ${t}`),e)})}));const pr=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(Ds.system.add(this.tickerUpdate,this,Ps.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ds.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class fr{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=fr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new we,this.page=new we,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class mr extends fr{constructor(){super(...arguments),this.client=new we,this.movement=new we,this.offset=new we,this.global=new we,this.screen=new we}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,r,n,o,a,h,l,c,u,d,p,f){throw new Error("Method not implemented.")}}class _r extends mr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class gr extends mr{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}gr.DOM_DELTA_PIXEL=0,gr.DOM_DELTA_LINE=1,gr.DOM_DELTA_PAGE=2;const yr=new we,vr=new we;class xr{constructor(t){this.dispatch=new G,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t)}hitTest(t,e){pr.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,yr.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(0===i.length)return;t.eventPhase=t.BUBBLING_PHASE;const s=Array.isArray(e)?e:[e];for(let e=i.length-1;e>=0;e--)s.forEach((s=>{t.currentTarget=i[e],this.notifyTarget(t,s)}))}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,r,n=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(pr.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],c=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,i,s,r,n||r(t,i));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:o?this._hitElements:a&&!r(t,i)&&s(t,i)?h?[t]:[]:null}hitTestRecursive(t,e,i,s,r){if(this._interactivePrune(t)||r(t,i))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(pr.pauseUpdate=!1),t.interactiveChildren&&t.children){const n=t.children;for(let o=n.length-1;o>=0;o--){const a=n[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,i,s,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const n=this._isInteractive(e),o=t.isInteractive();return n&&s(t,i)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,vr),!t.hitArea.contains(vr.x,vr.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const i=`on${e=e??t.type}`;t.currentTarget[i]?.(t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof _r))return;const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof _r))return;this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i="mouse"===e.pointerType||"pen"===e.pointerType,s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&r!==e.target){const s="mousemove"===t.type?"mouseout":"pointerout",n=this.createPointerEvent(t,s,r);if(this.dispatchEvent(n,"pointerout"),i&&this.dispatchEvent(n,"mouseout"),!e.composedPath().includes(r)){const s=this.createPointerEvent(t,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&!e.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;this.freeEvent(s)}this.freeEvent(n)}if(r!==e.target){const s="mousemove"===t.type?"mouseover":"pointerover",n=this.clonePointerEvent(e,s);this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover");let o=r?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==r&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(n)}const n=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&n.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&n.push("globaltouchmove")),i&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&n.push("globalmousemove"),this.cursor=e.target?.cursor),n.length>0&&this.all(e,n),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof _r))return;const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof _r))return;const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,s=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof _r))return;const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[t.button]);let n=r;if(r&&!i.composedPath().includes(r)){let e=r;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete s.pressTargetsByButton[t.button],n=e}if(n){const r=this.clonePointerEvent(i,"click");r.target=n,r.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const o=s.clicksByButton[t.button];if(o.target===r.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=r.target,o.timeStamp=e,r.detail=o.clickCount,"mouse"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof _r))return;const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof gr))return;const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(_r);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(gr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(_r);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof _r&&e instanceof _r&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof mr&&e instanceof mr&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,r=i.length;s<r&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}}const br={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Er=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new xr(null),pr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new _r(null),this.rootWheelEvent=new gr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Er.defaultEventFeatures},{set:(t,e,i)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Er._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let t=0,i=e.length;t<i;t++){const i=e[t],s=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;pr.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let t=0,e=s.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,s[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,pr.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;pr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;pr.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s;s=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*r,t.y=(i-s.top)*(this.domElement.height/s.height)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const s=t.changedTouches[i];void 0===s.button&&(s.button=0),void 0===s.buttons&&(s.buttons=1),void 0===s.isPrimary&&(s.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===s.width&&(s.width=s.radiusX||1),void 0===s.height&&(s.height=s.radiusY||1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="touch"),void 0===s.pointerId&&(s.pointerId=s.identifier||0),void 0===s.pressure&&(s.pressure=s.force||.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),void 0===s.layerX&&(s.layerX=s.offsetX=s.clientX),void 0===s.layerY&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const i=t;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=br[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let wr=Er;function Tr(t){return"dynamic"===t||"static"===t}wr.extension={name:"events",type:[$t.RendererSystem,$t.CanvasRendererSystem]},wr.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Kt.add(wr);const Sr={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Tr(wr.defaultEventMode)},set interactive(t){Y(0,"Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??wr.defaultEventMode},set eventMode(t){this._internalInteractive=Tr(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const s="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,s)},removeEventListener(t,e,i){const s="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,s)},dispatchEvent(t){if(!(t instanceof fr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Qs.mixin(Sr);Qs.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Cr{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(U.tablet||U.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(U.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:n,height:o,resolution:a}=this.renderer,h=s/n*a,l=r/o*a;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${n}px`,c.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,Dt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(c.style.left=(i.tx+t.x*i.a)*h+"px",c.style.top=(i.ty+t.y*i.d)*l+"px",c.style.width=t.width*i.a*h+"px",c.style.height=t.height*i.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*h+"px",c.style.top=t.y*l+"px",c.style.width=t.width*h+"px",c.style.height=t.height*l+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),e.accessibleTitle===c.title&&e.tabIndex===c.tabIndex||(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,r=Object.assign(new fr(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>s.dispatchEvent(r,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Cr.extension={name:"accessibility",type:[$t.RendererPlugin,$t.CanvasRendererPlugin]},Kt.add(Cr);const Ar=class{constructor(t){this.stage=new ir,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of Ns)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),Ar._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const i=Ar._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Ir=Ar;Ir._plugins=[],Kt.handleByList($t.Application,Ir._plugins);class Pr{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:s}=this._resizeTo;t=i,e=s}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Pr.extension=$t.Application,Kt.add(Pr);const Rr={loader:$t.LoadParser,resolver:$t.ResolveParser,cache:$t.CacheParser,detection:$t.DetectionParser};Kt.handle($t.Asset,(t=>{const e=t.ref;Object.entries(Rr).filter((([t])=>!!e[t])).forEach((([t,i])=>Kt.add(Object.assign(e[t],{extension:e[t].extension??i}))))}),(t=>{const e=t.ref;Object.keys(Rr).filter((t=>!!e[t])).forEach((t=>Kt.remove(e[t])))}));class Mr{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose,this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Dr(t,e){const i=t.split("?")[0],s=X.extname(i).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}const kr=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t);const Nr=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e}set(t,e){const i=kr(t);let s;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];if(r.test(e)){s=r.getCacheableAssets(i,e);break}}s||(s={},i.forEach((t=>{s[t]=e})));const r=Object.keys(s),n={cacheKeys:r,keys:i};if(i.forEach((t=>{this._cacheMap.set(t,n)})),r.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,s[t])})),e instanceof Ai){const t=e;i.forEach((e=>{t.baseTexture!==Ai.EMPTY.baseTexture&&he.addToCache(t.baseTexture,e),Ai.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},Or=t=>!Array.isArray(t);class Fr{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let s=null,r=null;if(e.loadParser&&(r=this._parserHash[e.loadParser]),!r){for(let i=0;i<this.parsers.length;i++){const s=this.parsers[i];if(s.load&&s.test?.(t,e,this)){r=s;break}}if(!r)return null}s=await r.load(t,e,this),i.parser=r;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];r.parse&&r.parse&&await(r.testParse?.(s,e,this))&&(s=await r.parse(s,e,this)||s,i.parser=r)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const s={},r=Or(t),n=kr(t,(t=>({src:t}))),o=n.length,a=n.map((async t=>{const r=X.toAbsolute(t.src);if(!s[t.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,t)),s[t.src]=await this.promiseCache[r].promise,e&&e(++i/o)}catch(e){throw delete this.promiseCache[r],delete s[t.src],new Error(`[Loader.load] Failed to load ${r}.\n${e}`)}}));return await Promise.all(a),r?s[n[0].src]:s}async unload(t){const e=kr(t,(t=>({src:t}))).map((async t=>{const e=X.toAbsolute(t.src),i=this.promiseCache[e];if(i){const s=await i.promise;i.parser?.unload?.(s,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name],{...t,[e.name]:e})),{})}}var Lr=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Lr||{});function Br(t,e){if(Array.isArray(e)){for(const i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}const Ur={extension:{type:$t.LoadParser,priority:Lr.Low},name:"loadJson",test:t=>Br(t,"application/json")||Dr(t,".json"),async load(t){const e=await b.ADAPTER.fetch(t);return await e.json()}};Kt.add(Ur);const Gr={name:"loadTxt",extension:{type:$t.LoadParser,priority:Lr.Low},test:t=>Br(t,"text/plain")||Dr(t,".txt"),async load(t){const e=await b.ADAPTER.fetch(t);return await e.text()}};Kt.add(Gr);const Hr=["normal","bold","100","200","300","400","500","600","700","800","900"],jr=[".ttf",".otf",".woff",".woff2"],Wr=["font/ttf","font/otf","font/woff","font/woff2"],zr=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Vr={extension:{type:$t.LoadParser,priority:Lr.Low},name:"loadWebFont",test:t=>Br(t,Wr)||Dr(t,jr),async load(t,e){const i=b.ADAPTER.getFontFaceSet();if(i){const s=[],r=e.data?.family??function(t){const e=X.extname(t),i=X.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let s=i.length>0;for(const t of i)if(!t.match(zr)){s=!1;break}let r=i.join(" ");return s||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}(t),n=e.data?.weights?.filter((t=>Hr.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<n.length;e++){const a=n[e],h=new FontFace(r,`url(${encodeURI(t)})`,{...o,weight:a});await h.load(),i.add(h),s.push(h)}return 1===s.length?s[0]:s}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>b.ADAPTER.getFontFaceSet().delete(t)))}};Kt.add(Vr);let Xr,$r=0;const Yr={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},qr={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let Kr;const Qr=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([Yr.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",(s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Xr&&(Xr=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Xr&&(Kr||(Kr=URL.createObjectURL(new Blob([qr.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Kr),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise(((i,s)=>{this.queue.push({id:t,arguments:e,resolve:i,reject:s})}));return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[$r]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:$r++,id:i})}};function Zr(t,e,i){const s=new Ai(t);return s.baseTexture.on("dispose",(()=>{delete e.promiseCache[i]})),s}const Jr=[".jpeg",".jpg",".png",".webp",".avif"],tn=["image/jpeg","image/png","image/webp","image/avif"];const en={name:"loadTextures",extension:{type:$t.LoadParser,priority:Lr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Br(t,tn)||Dr(t,Jr),async load(t,e,i){let s=null;s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Qr.isImageBitmapSupported()?await Qr.loadImageBitmap(t):await async function(t){const e=await b.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const i=await e.blob();return await createImageBitmap(i)}(t):await new Promise((e=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=t,s.complete?e(s):s.onload=()=>{e(s)}}));const r=new he(s,{resolution:Xt(t),...e.data});return r.resource.src=t,Zr(r,i,t)},unload(t){t.destroy(!0)}};Kt.add(en);const sn={extension:{type:$t.LoadParser,priority:Lr.High},name:"loadSVG",test:t=>Br(t,"image/svg+xml")||Dr(t,".svg"),testParse:async t=>$s.test(t),async parse(t,e,i){const s=new $s(t,e?.data?.resourceOptions);await s.load();const r=new he(s,{resolution:Xt(t),...e?.data});r.resource.src=t;return Zr(r,i,t)},load:async(t,e)=>(await b.ADAPTER.fetch(t)).text(),unload:en.unload};function rn(t,e,i,s,r){const n=e[i];for(let o=0;o<n.length;o++){const a=n[o];i<e.length-1?rn(t.replace(s[i],a),e,i+1,s,r):r.push(t.replace(s[i],a))}}function nn(t){const e=t.match(/\{(.*?)\}/g),i=[];if(e){const s=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");s.push(e)})),rn(t,s,0,e,i)}else i.push(t);return i}Kt.add(sn);class on{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const s=this._createBundleAssetId(t,e.name);i.push(s),this.add([e.name,s],e.srcs,e.data)}else{const s=e.name.map((e=>this._createBundleAssetId(t,e)));s.forEach((t=>{i.push(t)})),this.add([...e.name,...s],e.srcs)}})):Object.keys(e).forEach((s=>{i.push(this._createBundleAssetId(t,s)),this.add([s,this._createBundleAssetId(t,s)],e[s])})),this._bundles[t]=i}add(t,e,i){const s=kr(t);s.forEach((t=>{this.hasKey(t)})),Array.isArray(e)||(e="string"==typeof e?nn(e):[e]);const r=e.map((t=>{let e=t;if("string"==typeof t){let i=!1;for(let s=0;s<this._parsers.length;s++){const r=this._parsers[s];if(r.test(t)){e=r.parse(t),i=!0;break}}i||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=s),(this._basePath||this._rootPath)&&(e.src=X.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??i,e}));s.forEach((t=>{this._assetMap[t]=r}))}resolveBundle(t){const e=Or(t);t=kr(t);const i={};return t.forEach((t=>{const e=this._bundles[t];if(e){const s=this.resolve(e),r={};for(const e in s){const i=s[e];r[this._extractAssetIdFromBundle(t,e)]=i}i[t]=r}})),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const i in e)t[i]=e[i].src;return t}return e.src}resolve(t){const e=Or(t);t=kr(t);const i={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const i=this._getPreferredOrder(e),s=e[0];i?.priority.forEach((t=>{i.params[t].forEach((i=>{const s=e.filter((e=>!!e[t]&&e[t]===i));s.length&&(e=s)}))})),this._resolverHash[t]=e[0]??s}else{let e=t;(this._basePath||this._rootPath)&&(e=X.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}i[t]=this._resolverHash[t]})),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],i=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}const an=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new on,this.loader=new Fr,this.cache=Nr,this._backgroundLoader=new Mr(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,i="number"==typeof e?[e]:e;let s=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;s="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(s=await t.remove(s))}else for(const t of this._detections)await t.test()&&(s=await t.add(s));this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=Or(t),s=kr(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),r=this.resolver.resolve(s),n=await this._mapLoadToResolve(r,e);return i?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;"string"==typeof t&&(i=!0,t=[t]);const s=this.resolver.resolveBundle(t),r={},n=Object.keys(s);let o=0,a=0;const h=()=>{e?.(++o/a)},l=n.map((t=>{const e=s[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{r[t]=e}))}));return await Promise.all(l),i?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Nr.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Nr.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const n={};return i.forEach(((t,e)=>{const i=r[t.src],o=[t.src];t.alias&&o.push(...t.alias),n[s[e]]=i,Nr.set(o,i)})),n}async unload(t){this._initialized||await this.init();const e=kr(t).map((t=>"string"!=typeof t?t.src:t)),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=kr(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Nr.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return en.config.preferWorkers}set preferWorkers(t){Y(0,"Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((i=>{e.config[i]=t[i]}))}))}};Kt.handleByList($t.LoadParser,an.loader.parsers).handleByList($t.ResolveParser,an.resolver.parsers).handleByList($t.CacheParser,an.cache.parsers).handleByList($t.DetectionParser,an.detections);const hn={extension:$t.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Ai)),getCacheableAssets:(t,e)=>{const i={};return t.forEach((t=>{e.forEach(((e,s)=>{i[t+(0===s?"":s+1)]=e}))})),i}};Kt.add(hn);const ln={extension:{type:$t.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await b.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};Kt.add(ln);const cn={extension:{type:$t.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await b.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};Kt.add(cn);const un=["png","jpg","jpeg"],dn={extension:{type:$t.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...un],remove:async t=>t.filter((t=>!un.includes(t)))};Kt.add(dn);const pn={extension:$t.ResolveParser,test:en.test,parse:t=>({resolution:parseFloat(b.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};Kt.add(pn);const fn=(t,e)=>{const i=e.split("?")[1];return i&&(t+=`?${i}`),t};var mn=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(mn||{});const _n={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let gn,yn;function vn(){yn={s3tc:gn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gn.getExtension("WEBGL_compressed_texture_etc"),etc1:gn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gn.getExtension("WEBGL_compressed_texture_pvrtc")||gn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gn.getExtension("WEBGL_compressed_texture_atc"),astc:gn.getExtension("WEBGL_compressed_texture_astc")}}const xn={extension:{type:$t.DetectionParser,priority:2},test:async()=>{const t=b.ADAPTER.createCanvas().getContext("webgl");return!!t&&(gn=t,!0)},add:async t=>{yn||vn();const e=[];for(const t in yn){yn[t]&&e.push(t)}return[...e,...t]},remove:async t=>(yn||vn(),t.filter((t=>!(t in yn))))};Kt.add(xn);class bn extends ne{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;"string"==typeof t?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Qt(s):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Qt(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class En extends bn{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=En._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||En._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:i,levelHeight:r,levelBuffer:n}=this._levelBuffers[t];s.compressedTexImage2D(s.TEXTURE_2D,e,this.format,i,r,0,n)}return!0}onBlobLoaded(){this._levelBuffers=En._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,r,n,o){const a=new Array(i);let h=t.byteOffset,l=n,c=o,u=l+s-1&~(s-1),d=c+r-1&~(r-1),p=u*d*_n[e];for(let n=0;n<i;n++)a[n]={levelID:n,levelWidth:i>1?l:u,levelHeight:i>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,l=l>>1||1,c=c>>1||1,u=l+s-1&~(s-1),d=c+r-1&~(r-1),p=u*d*_n[e];return a}}const wn=124,Tn=3,Sn=4,Cn=7,An=19,In=2,Pn=0,Rn=1,Mn=2,Dn=3;const kn={827611204:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT},Nn={70:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:mn.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:mn.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:mn.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:mn.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const On=[171,75,84,88,32,49,49,187,13,10,26,10],Fn=12,Ln=16,Bn=24,Un=28,Gn=36,Hn=40,jn=44,Wn=48,zn=52,Vn=56,Xn=60,$n={[h.UNSIGNED_BYTE]:1,[h.UNSIGNED_SHORT]:2,[h.INT]:4,[h.UNSIGNED_INT]:4,[h.FLOAT]:4,[h.HALF_FLOAT]:8},Yn={[o.RGBA]:4,[o.RGB]:3,[o.RG]:2,[o.RED]:1,[o.LUMINANCE]:1,[o.LUMINANCE_ALPHA]:2,[o.ALPHA]:1},qn={[h.UNSIGNED_SHORT_4_4_4_4]:2,[h.UNSIGNED_SHORT_5_5_5_1]:2,[h.UNSIGNED_SHORT_5_6_5]:2};function Kn(t,e,i=!1){const s=new DataView(e);if(!function(t,e){for(let t=0;t<On.length;t++)if(e.getUint8(t)!==On[t])return!1;return!0}(0,s))return null;const r=67305985===s.getUint32(Fn,!0),n=s.getUint32(Ln,r),o=s.getUint32(Bn,r),a=s.getUint32(Un,r),l=s.getUint32(Gn,r),c=s.getUint32(Hn,r)||1,u=s.getUint32(jn,r)||1,d=s.getUint32(Wn,r)||1,p=s.getUint32(zn,r),f=s.getUint32(Vn,r),m=s.getUint32(Xn,r);if(0===c||1!==u)throw new Error("Only 2D textures are supported");if(1!==p)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw new Error("WebGL does not support array textures");const _=l+3&-4,g=c+3&-4,y=new Array(d);let v,x=l*c;if(0===n&&(x=_*g),v=0!==n?$n[n]?$n[n]*Yn[o]:qn[n]:_n[a],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=i?function(t,e,i){const s=new Map;let r=0;for(;r<e;){const n=t.getUint32(64+r,i),o=64+r+4,a=3-(n+3)%4;if(0===n||n>e-r)break;let h=0;for(;h<n&&0!==t.getUint8(o+h);h++);if(-1===h)break;const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),c=new DataView(t.buffer,o+h+1,n-h-1);s.set(l,c),r+=4+n+a}return s}(s,m,r):null;let E=x*v,w=l,T=c,S=_,C=g,A=64+m;for(let t=0;t<f;t++){const i=s.getUint32(A,r);let o=A+4;for(let i=0;i<d;i++){let s=y[i];s||(s=y[i]=new Array(f)),s[t]={levelID:t,levelWidth:f>1||0!==n?w:S,levelHeight:f>1||0!==n?T:C,levelBuffer:new Uint8Array(e,o,E)},o+=E}A+=i+4,A=A%4!=0?A+4-A%4:A,w=w>>1||1,T=T>>1||1,S=w+4-1&-4,C=T+4-1&-4,E=S*C*v}return 0!==n?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,i=!1;return n===h.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):n===h.UNSIGNED_INT?(i=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):n===h.INT&&(i=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new ne(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:n,format:i?Qn(o):o}})),kvData:b}:{compressed:y.map((t=>new En(null,{format:a,width:l,height:c,levels:f,levelBuffers:t}))),kvData:b}}function Qn(t){switch(t){case o.RGBA:return o.RGBA_INTEGER;case o.RGB:return o.RGB_INTEGER;case o.RG:return o.RG_INTEGER;case o.RED:return o.RED_INTEGER;default:return t}}const Zn={extension:{type:$t.LoadParser,priority:Lr.High},name:"loadDDS",test:t=>Dr(t,".dds"),async load(t,e,i){const s=await b.ADAPTER.fetch(t),r=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(t,0,wn/Uint32Array.BYTES_PER_ELEMENT),s=i[Tn],r=i[Sn],n=i[Cn],o=new Uint32Array(t,An*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const i=o[In];if(808540228!==i){const e=kn[i],o=new Uint8Array(t,128);return[new En(o,{format:e,width:r,height:s,levels:n})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[Pn],c=h[Rn],u=h[Mn],d=h[Dn],p=Nn[l];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,m=148;if(1===d)f.push(new Uint8Array(t,m));else{const e=_n[p];let i=0,o=r,a=s;for(let t=0;t<n;t++)i+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let h=m;for(let e=0;e<d;e++)f.push(new Uint8Array(t,h,i)),h+=i}return f.map((t=>new En(t,{format:p,width:r,height:s,levels:n})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await s.arrayBuffer()),n=r.map((s=>Zr(new he(s,{mipmap:d.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:Xt(t),...e.data}),i,t)));return 1===n.length?n[0]:n},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Kt.add(Zn);const Jn={extension:{type:$t.LoadParser,priority:Lr.High},name:"loadKTX",test:t=>Dr(t,".ktx"),async load(t,e,i){const s=await b.ADAPTER.fetch(t),r=await s.arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=Kn(0,r),h=n??o,l={mipmap:d.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:Xt(t),...e.data},c=h.map((e=>{h===o&&Object.assign(l,{type:e.type,format:e.format});const s=new he(e,l);return s.ktxKeyValueData=a,Zr(s,i,t)}));return 1===c.length?c[0]:c},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Kt.add(Jn);const to={extension:$t.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(b.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(b.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};Kt.add(to);const eo=new Se,io=class{constructor(t){this.renderer=t}async image(t,e,i){const s=new Image;return s.src=await this.base64(t,e,i),s}async base64(t,e,i){const s=this.canvas(t);if(void 0!==s.toBlob)return new Promise(((t,r)=>{s.toBlob((e=>{if(!e)return void r(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)}),e,i)}));if(void 0!==s.toDataURL)return s.toDataURL(e,i);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:i});return new Promise(((e,i)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=i,s.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(t,e);n&&io._flipY(i,s,r),io._unpremultiplyAlpha(i);const o=new Ht(s,r,1),a=new ImageData(new Uint8ClampedArray(i.buffer),s,r);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(t,e);return n&&io._flipY(i,s,r),io._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,r,n=!1,o=!1;if(t&&(t instanceof Ii?r=t:(r=i.generateTexture(t,{resolution:i.resolution,multisample:i.multisample}),o=!0)),r){if(s=r.baseTexture.resolution,e=e??r.frame,n=!1,!o){i.renderTexture.bind(r);const t=r.framebuffer.glFramebuffers[i.CONTEXT_UID];t.blitFramebuffer&&i.framebuffer.bind(t.blitFramebuffer)}}else s=i.resolution,e||((e=eo).width=i.width/s,e.height=i.height/s),n=!0,i.renderTexture.bind();const a=Math.round(e.width*s),h=Math.round(e.height*s),l=new Uint8Array(4*a*h),c=i.gl;return c.readPixels(Math.round(e.x*s),Math.round(e.y*s),a,h,c.RGBA,c.UNSIGNED_BYTE,l),o&&r?.destroy(!0),{pixels:l,width:a,height:h,flipY:n}}destroy(){this.renderer=null}static _flipY(t,e,i){const s=e<<2,r=i>>1,n=new Uint8Array(s);for(let e=0;e<r;e++){const r=e*s,o=(i-e-1)*s;n.set(t.subarray(r,r+s)),t.copyWithin(r,o,o+s),t.set(n,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const e=t[i+3];if(0!==e){const s=255.001/e;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}};let so=io;so.extension={name:"extract",type:$t.RendererSystem},Kt.add(so);const ro={build(t){const e=t.points;let i,s,r,n,o,a;if(t.type===Ee.CIRC){const e=t.shape;i=e.x,s=e.y,o=a=e.radius,r=n=0}else if(t.type===Ee.ELIP){const e=t.shape;i=e.x,s=e.y,o=e.width,a=e.height,r=n=0}else{const e=t.shape,h=e.width/2,l=e.height/2;i=e.x+h,s=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),r=h-o,n=l-a}if(!(o>=0&&a>=0&&r>=0&&n>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(r?4:0)+(n?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=i+r,e[1]=e[3]=s+n,e[2]=e[4]=i-r,void(e[5]=e[7]=s-n);let c=0,u=4*h+(r?2:0)+2,d=u,p=l;{const t=r+o,a=n,h=i+t,l=i-t,f=s+a;if(e[c++]=h,e[c++]=f,e[--u]=f,e[--u]=l,n){const t=s-a;e[d++]=l,e[d++]=t,e[--p]=t,e[--p]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),f=r+Math.cos(l)*o,m=n+Math.sin(l)*a,_=i+f,g=i-f,y=s+m,v=s-m;e[c++]=_,e[c++]=y,e[--u]=y,e[--u]=g,e[d++]=g,e[d++]=v,e[--p]=v,e[--p]=_}{const t=n+a,o=i+r,h=i-r,l=s+t,u=s-t;e[c++]=o,e[c++]=l,e[--p]=u,e[--p]=o,r&&(e[c++]=h,e[c++]=l,e[--p]=u,e[--p]=h)}},triangulate(t,e){const i=t.points,s=e.points,r=e.indices;if(0===i.length)return;let n=s.length/2;const o=n;let a,h;if(t.type!==Ee.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;s.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),n++,s.push(i[0],i[1]);for(let t=2;t<i.length;t+=2)s.push(i[t],i[t+1]),r.push(n++,o,n);r.push(o+1,o,n)}};function no(t,e=!1){const i=t.length;if(i<6)return;let s=0;for(let e=0,r=t[i-2],n=t[i-1];e<i;e+=2){const i=t[e],o=t[e+1];s+=(i-r)*(o+n),r=i,n=o}if(!e&&s>0||e&&s<=0){const e=i/2;for(let s=e+e%2;s<i;s+=2){const e=i-s-2,r=i-s-1,n=s,o=s+1;[t[e],t[n]]=[t[n],t[e]],[t[r],t[o]]=[t[o],t[r]]}}}const oo={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points;const s=t.holes,r=e.points,n=e.indices;if(i.length>=6){no(i,!1);const t=[];for(let e=0;e<s.length;e++){const r=s[e];no(r.points,!0),t.push(i.length/2),i=i.concat(r.points)}const e=H(i,t,2);if(!e)return;const o=r.length/2;for(let t=0;t<e.length;t+=3)n.push(e[t]+o),n.push(e[t+1]+o),n.push(e[t+2]+o);for(let t=0;t<i.length;t++)r.push(i[t])}}},ao={build(t){const e=t.shape,i=e.x,s=e.y,r=e.width,n=e.height,o=t.points;o.length=0,r>=0&&n>=0&&o.push(i,s,i+r,s,i+r,s+n,i,s+n)},triangulate(t,e){const i=t.points,s=e.points;if(0===i.length)return;const r=s.length/2;s.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},ho={build(t){ro.build(t)},triangulate(t,e){ro.triangulate(t,e)}};var lo=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(lo||{}),co=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(co||{});const uo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class po{static curveTo(t,e,i,s,r,n){const o=n[n.length-2],a=n[n.length-1]-e,h=o-t,l=s-e,c=i-t,u=Math.abs(a*c-h*l);if(u<1e-8||0===r)return n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e),null;const d=a*a+h*h,p=l*l+c*c,f=a*l+h*c,m=r*Math.sqrt(d)/u,_=r*Math.sqrt(p)/u,g=m*f/d,y=_*f/p,v=m*c+_*h,x=m*l+_*a,b=h*(_+g),E=a*(_+g),w=c*(m+y),T=l*(m+y);return{cx:v+t,cy:x+e,radius:r,startAngle:Math.atan2(E-x,b-v),endAngle:Math.atan2(T-x,w-v),anticlockwise:h*l>c*a}}static arc(t,e,i,s,r,n,o,a,h){const l=o-n,c=uo._segmentsCount(Math.abs(l)*r,40*Math.ceil(Math.abs(l)/ve)),u=l/(2*c),d=2*u,p=Math.cos(u),f=Math.sin(u),m=c-1,_=m%1/m;for(let t=0;t<=m;++t){const e=u+n+d*(t+_*t),o=Math.cos(e),a=-Math.sin(e);h.push((p*o+f*a)*r+i,(p*-a+f*o)*r+s)}}}class fo{static curveLength(t,e,i,s,r,n,o,a){let h=0,l=0,c=0,u=0,d=0,p=0,f=0,m=0,_=0,g=0,y=0,v=t,x=e;for(let b=1;b<=10;++b)l=b/10,c=l*l,u=c*l,d=1-l,p=d*d,f=p*d,m=f*t+3*p*l*i+3*d*c*r+u*o,_=f*e+3*p*l*s+3*d*c*n+u*a,g=v-m,y=x-_,v=m,x=_,h+=Math.sqrt(g*g+y*y);return h}static curveTo(t,e,i,s,r,n,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=uo._segmentsCount(fo.curveLength(a,h,t,e,i,s,r,n));let c=0,u=0,d=0,p=0,f=0;o.push(a,h);for(let m=1,_=0;m<=l;++m)_=m/l,c=1-_,u=c*c,d=u*c,p=_*_,f=p*_,o.push(d*a+3*u*_*t+3*c*p*i+f*r,d*h+3*u*_*e+3*c*p*s+f*n)}}function mo(t,e,i,s,r,n,o,a){let h,l;o?(h=s,l=-i):(h=-s,l=i);const c=t-i*r+h,u=e-s*r+l,d=t+i*n+h,p=e+s*n+l;return a.push(c,u,d,p),2}function _o(t,e,i,s,r,n,o,a){const h=i-t,l=s-e;let c=Math.atan2(h,l),u=Math.atan2(r-t,n-e);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(h*h+l*l),_=1+(15*f*Math.sqrt(m)/Math.PI>>0),g=p/_;if(d+=g,a){o.push(t,e,i,s);for(let i=1,s=d;i<_;i++,s+=g)o.push(t,e,t+Math.sin(s)*m,e+Math.cos(s)*m);o.push(t,e,r,n)}else{o.push(i,s,t,e);for(let i=1,s=d;i<_;i++,s+=g)o.push(t+Math.sin(s)*m,e+Math.cos(s)*m,t,e);o.push(r,n,t,e)}return 2*_}function go(t,e){t.lineStyle.native?function(t,e){let i=0;const s=t.shape,r=t.points||s.points,n=s.type!==Ee.POLY||s.closeStroke;if(0===r.length)return;const o=e.points,a=e.indices,h=r.length/2,l=o.length/2;let c=l;for(o.push(r[0],r[1]),i=1;i<h;i++)o.push(r[2*i],r[2*i+1]),a.push(c,c+1),c++;n&&a.push(c,l)}(t,e):function(t,e){const i=t.shape;let s=t.points||i.points.slice();const r=e.closePointEps;if(0===s.length)return;const n=t.lineStyle,o=new we(s[0],s[1]),a=new we(s[s.length-2],s[s.length-1]),h=i.type!==Ee.POLY||i.closeStroke,l=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(h){s=s.slice(),l&&(s.pop(),s.pop(),a.set(s[s.length-2],s[s.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);s.unshift(t,e),s.push(t,e)}const c=e.points,u=s.length/2;let d=s.length;const p=c.length/2,f=n.width/2,m=f*f,_=n.miterLimit*n.miterLimit;let g=s[0],y=s[1],v=s[2],x=s[3],b=0,E=0,w=-(y-x),T=g-v,S=0,C=0,A=Math.sqrt(w*w+T*T);w/=A,T/=A,w*=f,T*=f;const I=n.alignment,P=2*(1-I),R=2*I;h||(n.cap===co.ROUND?d+=_o(g-w*(P-R)*.5,y-T*(P-R)*.5,g-w*P,y-T*P,g+w*R,y+T*R,c,!0)+2:n.cap===co.SQUARE&&(d+=mo(g,y,w,T,P,R,!0,c))),c.push(g-w*P,y-T*P,g+w*R,y+T*R);for(let t=1;t<u-1;++t){g=s[2*(t-1)],y=s[2*(t-1)+1],v=s[2*t],x=s[2*t+1],b=s[2*(t+1)],E=s[2*(t+1)+1],w=-(y-x),T=g-v,A=Math.sqrt(w*w+T*T),w/=A,T/=A,w*=f,T*=f,S=-(x-E),C=v-b,A=Math.sqrt(S*S+C*C),S/=A,C/=A,S*=f,C*=f;const e=v-g,i=y-x,r=v-b,o=E-x,a=e*r+i*o,h=i*r-o*e,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){c.push(v-w*P,x-T*P,v+w*R,x+T*R),a>=0&&(n.join===lo.ROUND?d+=_o(v,x,v-w*P,x-T*P,v-S*P,x-C*P,c,!1)+4:d+=2,c.push(v-S*R,x-C*R,v+S*P,x+C*P));continue}const u=(-w+g)*(-T+x)-(-w+v)*(-T+y),p=(-S+b)*(-C+x)-(-S+v)*(-C+E),I=(e*p-r*u)/h,M=(o*u-i*p)/h,D=(I-v)*(I-v)+(M-x)*(M-x),k=v+(I-v)*P,N=x+(M-x)*P,O=v-(I-v)*R,F=x-(M-x)*R,L=l?P:R,B=D<=Math.min(e*e+i*i,r*r+o*o)+L*L*m;let U=n.join;if(U===lo.MITER&&D/m>_&&(U=lo.BEVEL),B)switch(U){case lo.MITER:c.push(k,N,O,F);break;case lo.BEVEL:l?c.push(k,N,v+w*R,x+T*R,k,N,v+S*R,x+C*R):c.push(v-w*P,x-T*P,O,F,v-S*P,x-C*P,O,F),d+=2;break;case lo.ROUND:l?(c.push(k,N,v+w*R,x+T*R),d+=_o(v,x,v+w*R,x+T*R,v+S*R,x+C*R,c,!0)+4,c.push(k,N,v+S*R,x+C*R)):(c.push(v-w*P,x-T*P,O,F),d+=_o(v,x,v-w*P,x-T*P,v-S*P,x-C*P,c,!1)+4,c.push(v-S*P,x-C*P,O,F))}else{switch(c.push(v-w*P,x-T*P,v+w*R,x+T*R),U){case lo.MITER:l?c.push(O,F,O,F):c.push(k,N,k,N),d+=2;break;case lo.ROUND:d+=l?_o(v,x,v+w*R,x+T*R,v+S*R,x+C*R,c,!0)+2:_o(v,x,v-w*P,x-T*P,v-S*P,x-C*P,c,!1)+2}c.push(v-S*P,x-C*P,v+S*R,x+C*R),d+=2}}g=s[2*(u-2)],y=s[2*(u-2)+1],v=s[2*(u-1)],x=s[2*(u-1)+1],w=-(y-x),T=g-v,A=Math.sqrt(w*w+T*T),w/=A,T/=A,w*=f,T*=f,c.push(v-w*P,x-T*P,v+w*R,x+T*R),h||(n.cap===co.ROUND?d+=_o(v-w*(P-R)*.5,x-T*(P-R)*.5,v-w*P,x-T*P,v+w*R,x+T*R,c,!1)+2:n.cap===co.SQUARE&&(d+=mo(v,x,w,T,P,R,!1,c)));const M=e.indices,D=uo.epsilon*uo.epsilon;for(let t=p;t<d+p-2;++t)g=c[2*t],y=c[2*t+1],v=c[2*(t+1)],x=c[2*(t+1)+1],b=c[2*(t+2)],E=c[2*(t+2)+1],Math.abs(g*(x-E)+v*(E-y)+b*(y-x))<D||M.push(t,t+1,t+2)}(t,e)}class yo{static curveLength(t,e,i,s,r,n){const o=t-2*i+r,a=e-2*s+n,h=2*i-2*t,l=2*s-2*e,c=4*(o*o+a*a),u=4*(o*h+a*l),d=h*h+l*l,p=2*Math.sqrt(c+u+d),f=Math.sqrt(c),m=2*c*f,_=2*Math.sqrt(d),g=u/f;return(m*p+f*u*(p-_)+(4*d*c-u*u)*Math.log((2*f+g+p)/(g+_)))/(4*m)}static curveTo(t,e,i,s,r){const n=r[r.length-2],o=r[r.length-1],a=uo._segmentsCount(yo.curveLength(n,o,t,e,i,s));let h=0,l=0;for(let c=1;c<=a;++c){const u=c/a;h=n+(t-n)*u,l=o+(e-o)*u,r.push(h+(t+(i-t)*u-h)*u,l+(e+(s-e)*u-l)*u)}}}const vo={[Ee.POLY]:oo,[Ee.CIRC]:ro,[Ee.ELIP]:ro,[Ee.RECT]:ao,[Ee.RREC]:ho},xo=[],bo=[];class Eo{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new Eo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class wo{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const To=new we,So=class extends ye{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ks,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),bo.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),xo.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){const r=new Eo(t,e,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Eo(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const s=e[i];if(s.fillStyle.visible&&(s.shape&&(s.matrix?s.matrix.applyInverse(t,To):To.copyFrom(t),s.shape.contains(To.x,To.y)))){let t=!1;if(s.holes)for(let e=0;e<s.holes.length;e++){if(s.holes[e].shape.contains(To.x,To.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let r=this.shapeIndex;r<e.length;r++){this.shapeIndex++;const n=e[r],o=n.fillStyle,a=n.lineStyle;vo[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(o.visible||a.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const r=0===e?o:a;if(!r.visible)continue;const h=r.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=u.REPEAT,0===e?this.processFill(n):this.processLine(n);const d=this.points.length/2-c;0!==d&&(i&&!this._compareStyles(s,r)&&(i.end(l,c),i=null),i||(i=xo.pop()||new wo,i.begin(r,l,c),this.batches.push(i),s=r),this.addUvs(this.points,t,r.texture,c,d,r.matrix))}}const r=this.indices.length,n=this.points.length/2;if(i&&i.end(r,n),0===this.batches.length)return void(this.batchable=!0);const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,s=e.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*So.BATCHABLE_SIZE}buildDrawCalls(){let t=++he._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),bo.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let s=bo.pop();s||(s=new le,s.texArray=new li),s.texArray.count=0,s.start=0,s.size=0,s.type=n.TRIANGLES;let r=0,o=null,a=0,h=!1,l=n.TRIANGLES,c=0;this.drawCalls.push(s);for(let d=0;d<this.batches.length;d++){const p=this.batches[d],f=8,m=p.style,_=m.texture.baseTexture;h!==!!m.native&&(h=!!m.native,l=h?n.LINES:n.TRIANGLES,o=null,r=f,t++),o!==_&&(o=_,_._batchEnabled!==t&&(r===f&&(t++,r=0,s.size>0&&(s=bo.pop(),s||(s=new le,s.texArray=new li),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=l),_.touched=1,_._batchEnabled=t,_._batchLocation=r,_.wrapMode=u.REPEAT,s.texArray.elements[s.texArray.count++]=_,r++)),s.size+=p.size,c+=p.size,a=_._batchLocation,this.addColors(e,m.color,m.alpha,p.attribSize,p.attribStart),this.addTextureIds(i,a,p.attribSize,p.attribStart)}he._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(3*t.length*4),n=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let r=0;r<t.length/2;r++)n[a++]=t[2*r],n[a++]=t[2*r+1],n[a++]=e[2*r],n[a++]=e[2*r+1],o[a++]=i[r],n[a++]=s[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)oo.triangulate(t,this);else{vo[t.type].triangulate(t,this)}}processLine(t){go(t,this);for(let e=0;e<t.holes.length;e++)go(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];vo[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const s=t[2*i],r=t[2*i+1];t[2*i]=e.a*s+e.c*r+e.tx,t[2*i+1]=e.b*s+e.d*r+e.ty}}addColors(t,e,i,s,r=0){const n=St.shared.setValue(e).toLittleEndianNumber(),o=St.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,r+s);for(let e=0;e<s;e++)t[r+e]=o}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let r=0;r<i;r++)t[s+r]=e}addUvs(t,e,i,s,r,n=null){let o=0;const a=e.length,h=i.frame;for(;o<r;){let i=t[2*(s+o)],r=t[2*(s+o)+1];if(n){const t=n.a*i+n.c*r+n.tx;r=n.b*i+n.d*r+n.ty,i=t}o++,e.push(i/h.width,r/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,i,a,r)}adjustUvs(t,e,i,s){const r=e.baseTexture,n=1e-6,o=i+2*s,a=e.frame,h=a.width/r.width,l=a.height/r.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(t[i]+n),p=Math.floor(t[i+1]+n);for(let e=i+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+n)),p=Math.min(p,Math.floor(t[e+1]+n));c-=d,u-=p;for(let e=i;e<o;e+=2)t[e]=(t[e]+c)*h,t[e+1]=(t[e+1]+u)*l}};let Co=So;Co.BATCHABLE_SIZE=100;class Ao{constructor(){this.color=16777215,this.alpha=1,this.texture=Ai.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ao;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ai.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Io extends Ao{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=co.BUTT,this.join=lo.MITER,this.miterLimit=10}clone(){const t=new Io;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Po={},Ro=class extends ir{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ao,this._lineStyle=new Io,this._matrix=null,this._holeMode=!1,this.state=te.for2d(),this._geometry=t||new Co,this._geometry.refCount++,this._transformID=-1,this._tintColor=new St(16777215),this.blendMode=r.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ro(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,r=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:s,native:r}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Ai.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:co.BUTT,join:lo.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ie,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ie,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return s===t&&r===e||i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),yo.curveTo(t,e,i,s,r),this}bezierCurveTo(t,e,i,s,r,n){return this._initCurve(),fo.curveTo(t,e,i,s,r,n,this.currentPath.points),this}arcTo(t,e,i,s,r){this._initCurve(t,e);const n=this.currentPath.points,o=po.curveTo(t,e,i,s,r,n);if(o){const{cx:t,cy:e,radius:i,startAngle:s,endAngle:r,anticlockwise:n}=o;this.arc(t,e,i,s,r,n)}return this}arc(t,e,i,s,r,n=!1){if(s===r)return this;!n&&r<=s?r+=ve:n&&s<=r&&(s+=ve);if(0===r-s)return this;const o=t+Math.cos(s)*i,a=e+Math.sin(s)*i,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return po.arc(o,a,t,e,i,s,r,n,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Ai.WHITE,color:t,alpha:e})}normalizeColor(t){const e=St.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Ai.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new Se(t,e,i,s))}drawRoundedRect(t,e,i,s,r){return this.drawShape(new Pe(t,e,i,s,r))}drawCircle(t,e,i){return this.drawShape(new Ce(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new Ae(t,e,i,s))}drawPolygon(...t){let e,i=!0;const s=t[0];s.points?(i=s.closeStroke,e=s.points):e=Array.isArray(t[0])?t[0]:t;const r=new Ie(e);return r.closeStroke=i,this.drawShape(r),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Ee.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){const i=t.batches[s],r=i.style.color,n=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),a={vertexData:n,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:St.shared.setValue(r).toRgbArray(),_tintRGB:r,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[s]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,r=e.uniforms,n=i.drawCalls;r.translationMatrix=this.transform.worldTransform,St.shared.setValue(this._tintColor).premultiply(s).toArray(r.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let e=0,s=n.length;e<s;e++)this._renderDrawCallDirect(t,i.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:i,type:s,size:r,start:n}=e,o=i.count;for(let e=0;e<o;e++)t.texture.bind(i.elements[e],e);t.geometry.draw(s,r,n)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!Po[i]){const{maxTextures:e}=t.plugins[i],s=new Int32Array(e);for(let t=0;t<e;t++)s[t]=t;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Re,default:oi.from({uSamplers:s},!0)},n=t.plugins[i]._shader.program;Po[i]=new ai(n,r)}e=Po[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:s,maxY:r}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,r)}containsPoint(t){return this.worldTransform.applyInverse(t,Ro._TEMP_POINT),this._geometry.containsPoint(Ro._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=St.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,n=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let t=0;t<h.length;t+=2){const e=h[t],u=h[t+1];l[c++]=i*e+r*u+o,l[c++]=n*u+s*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let Mo=Ro;Mo.curves=uo,Mo._TEMP_POINT=new we;class Do{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const ko=new we,No=new Ie,Oo=class extends ir{constructor(t,e,i,s=n.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||te.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=b.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===n.TRIANGLES&&e.length<2*Oo.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,r=s.a,n=s.b,o=s.c,a=s.d,h=s.tx,l=s.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const i=e[2*t],s=e[2*t+1];c[2*t]=r*i+o*s+h,c[2*t+1]=n*i+a*s+l}if(this._roundPixels){const t=b.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Do(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ko);const e=this.geometry.getBuffer("aVertexPosition").data,i=No.points,s=this.geometry.getIndex().data,r=s.length,n=4===this.drawMode?3:1;for(let t=0;t+2<r;t+=n){const r=2*s[t],n=2*s[t+1],o=2*s[t+2];if(i[0]=e[r],i[1]=e[r+1],i[2]=e[n],i[3]=e[n+1],i[4]=e[o],i[5]=e[o+1],No.contains(ko.x,ko.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Fo=Oo;Fo.BATCHABLE_SIZE=100;class Lo extends ge{constructor(t,e,i){super();const s=new ue(t),r=new ue(e,!0),n=new ue(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,h.FLOAT).addAttribute("aTextureCoord",r,2,!1,h.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Bo extends ai{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:Re.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||ri.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new ji(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new St(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;St.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Uo{constructor(t,e,i){this.geometry=new ge,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let s=t[i];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||h.FLOAT,offset:s.offset},e[i]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new ue(function(t,e=null){const i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let t=0,s=0;t<i;t+=6,s+=4)e[t+0]=s+0,e[t+1]=s+1,e[t+2]=s+2,e[t+3]=s+0,e[t+4]=s+2,e[t+5]=s+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];i.offset=e,e+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ue(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=s,s+=e.size,this.staticStride+=e.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new ue(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];t.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===h.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let e=0;e<this.staticProperties.length;++e){const i=this.staticProperties[e];t.addAttribute(i.attributeName,this.staticBuffer,0,i.type===h.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(t,e,i,r.type===h.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(t,e,i,r.type===h.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Go extends ci{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Re,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:h.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ai.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=te.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,r=this.renderer;let n=e.length;if(0===n)return;n>i&&!t.autoResize&&(n=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=At(t.blendMode,h),r.state.set(this.state);const l=r.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=St.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let u=!1;for(let i=0,a=0;i<n;i+=s,a+=1){let h=n-i;h>s&&(h=s),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const c=o[a];c.uploadDynamic(e,i,h);const d=t._bufferUpdateIDs[a]||0;u=u||c._updateID<d,u&&(c._updateID=t._updateID,c.uploadStatic(e,i,h)),r.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,r=t._properties;for(let t=0;t<i;t+=s)e.push(new Uo(this.properties,r,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new Uo(this.properties,i,e)}uploadVertices(t,e,i,s,r,n){let o=0,a=0,h=0,l=0;for(let c=0;c<i;++c){const i=t[e+c],u=i._texture,d=i.scale.x,p=i.scale.y,f=u.trim,m=u.orig;f?(a=f.x-i.anchor.x*m.width,o=a+f.width,l=f.y-i.anchor.y*m.height,h=l+f.height):(o=m.width*(1-i.anchor.x),a=m.width*-i.anchor.x,h=m.height*(1-i.anchor.y),l=m.height*-i.anchor.y),s[n]=a*d,s[n+1]=l*p,s[n+r]=o*d,s[n+r+1]=l*p,s[n+2*r]=o*d,s[n+2*r+1]=h*p,s[n+3*r]=a*d,s[n+3*r+1]=h*p,n+=4*r}}uploadPosition(t,e,i,s,r,n){for(let o=0;o<i;o++){const i=t[e+o].position;s[n]=i.x,s[n+1]=i.y,s[n+r]=i.x,s[n+r+1]=i.y,s[n+2*r]=i.x,s[n+2*r+1]=i.y,s[n+3*r]=i.x,s[n+3*r+1]=i.y,n+=4*r}}uploadRotation(t,e,i,s,r,n){for(let o=0;o<i;o++){const i=t[e+o].rotation;s[n]=i,s[n+r]=i,s[n+2*r]=i,s[n+3*r]=i,n+=4*r}}uploadUvs(t,e,i,s,r,n){for(let o=0;o<i;++o){const i=t[e+o]._texture._uvs;i?(s[n]=i.x0,s[n+1]=i.y0,s[n+r]=i.x1,s[n+r+1]=i.y1,s[n+2*r]=i.x2,s[n+2*r+1]=i.y2,s[n+3*r]=i.x3,s[n+3*r+1]=i.y3,n+=4*r):(s[n]=0,s[n+1]=0,s[n+r]=0,s[n+r+1]=0,s[n+2*r]=0,s[n+2*r+1]=0,s[n+3*r]=0,s[n+3*r+1]=0,n+=4*r)}}uploadTint(t,e,i,s,r,n){for(let o=0;o<i;++o){const i=t[e+o],a=St.shared.setValue(i._tintRGB).toPremultiplied(i.alpha,i.texture.baseTexture.alphaMode>0);s[n]=a,s[n+r]=a,s[n+2*r]=a,s[n+3*r]=a,n+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Go.extension={name:"particle",type:$t.RendererPlugin},Kt.add(Go);var Ho=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Ho||{});const jo={willReadFrequently:!0},Wo=class{static get experimentalLetterSpacingSupported(){let t=Wo._experimentalLetterSpacingSupported;if(void 0!==t){const e=b.ADAPTER.getCanvasRenderingContext2D().prototype;t=Wo._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,r,n,o,a,h){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=r,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,e,i,s=Wo._canvas){i=null==i?e.wordWrap:i;const r=e.toFontString(),n=Wo.measureFont(r);0===n.fontSize&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);const o=s.getContext("2d",jo);o.font=r;const a=(i?Wo.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),h=new Array(a.length);let l=0;for(let t=0;t<a.length;t++){const i=Wo._measureText(a[t],e.letterSpacing,o);h[t]=i,l=Math.max(l,i)}let c=l+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||n.fontSize+e.strokeThickness;let d=Math.max(u,n.fontSize+2*e.strokeThickness)+(a.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Wo(t,e,c,d,a,h,u+e.leading,l,n)}static _measureText(t,e,i){let s=!1;Wo.experimentalLetterSpacingSupported&&(Wo.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let r=i.measureText(t).width;return r>0&&(s?r-=e:r+=(Wo.graphemeSegmenter(t).length-1)*e),r}static wordWrap(t,e,i=Wo._canvas){const s=i.getContext("2d",jo);let r=0,n="",o="";const a=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,c=Wo.collapseSpaces(l),u=Wo.collapseNewlines(l);let d=!c;const p=e.wordWrapWidth+h,f=Wo.tokenize(t);for(let t=0;t<f.length;t++){let i=f[t];if(Wo.isNewline(i)){if(!u){o+=Wo.addLine(n),d=!c,n="",r=0;continue}i=" "}if(c){const t=Wo.isBreakingSpace(i),e=Wo.isBreakingSpace(n[n.length-1]);if(t&&e)continue}const l=Wo.getFromCache(i,h,a,s);if(l>p)if(""!==n&&(o+=Wo.addLine(n),n="",r=0),Wo.canBreakWords(i,e.breakWords)){const t=Wo.wordWrapSplit(i);for(let l=0;l<t.length;l++){let c=t[l],u=c,f=1;for(;t[l+f];){const s=t[l+f];if(Wo.canBreakChars(u,s,i,l,e.breakWords))break;c+=s,u=s,f++}l+=f-1;const m=Wo.getFromCache(c,h,a,s);m+r>p&&(o+=Wo.addLine(n),d=!1,n="",r=0),n+=c,r+=m}}else{n.length>0&&(o+=Wo.addLine(n),n="",r=0);const e=t===f.length-1;o+=Wo.addLine(i,!e),d=!1,n="",r=0}else l+r>p&&(d=!1,o+=Wo.addLine(n),n="",r=0),(n.length>0||!Wo.isBreakingSpace(i)||d)&&(n+=i,r+=l)}return o+=Wo.addLine(n,!1),o}static addLine(t,e=!0){return t=Wo.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,i,s){let r=i[t];return"number"!=typeof r&&(r=Wo._measureText(t,e,s)+e,i[t]=r),r}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!Wo.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Wo._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Wo._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if("string"!=typeof t)return e;for(let s=0;s<t.length;s++){const r=t[s],n=t[s+1];Wo.isBreakingSpace(r,n)||Wo.isNewline(r)?(""!==i&&(e.push(i),i=""),e.push(r)):i+=r}return""!==i&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,r){return!0}static wordWrapSplit(t){return Wo.graphemeSegmenter(t)}static measureFont(t){if(Wo._fonts[t])return Wo._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=Wo._canvas,s=Wo._context;s.font=t;const r=Wo.METRICS_STRING+Wo.BASELINE_SYMBOL,n=Math.ceil(s.measureText(r).width);let o=Math.ceil(s.measureText(Wo.BASELINE_SYMBOL).width);const a=Math.ceil(Wo.HEIGHT_MULTIPLIER*o);if(o=o*Wo.BASELINE_MULTIPLIER|0,0===n||0===a)return Wo._fonts[t]=e,e;i.width=n,i.height=a,s.fillStyle="#f00",s.fillRect(0,0,n,a),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,o);const h=s.getImageData(0,0,n,a).data,l=h.length,c=4*n;let u=0,d=0,p=!1;for(u=0;u<o;++u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d+=c}for(e.ascent=o-u,d=l-c,p=!1,u=a;u>o;--u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d-=c}return e.descent=u-o,e.fontSize=e.ascent+e.descent,Wo._fonts[t]=e,e}static clearMetrics(t=""){t?delete Wo._fonts[t]:Wo._fonts={}}static get _canvas(){if(!Wo.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",jo)?.measureText)return Wo.__canvas=e,e;t=b.ADAPTER.createCanvas()}catch(e){t=b.ADAPTER.createCanvas()}t.width=t.height=10,Wo.__canvas=t}return Wo.__canvas}static get _context(){return Wo.__context||(Wo.__context=Wo._canvas.getContext("2d",jo)),Wo.__context}};let zo=Wo;zo.METRICS_STRING="|ÉqÅ",zo.BASELINE_SYMBOL="M",zo.BASELINE_MULTIPLIER=1.4,zo.HEIGHT_MULTIPLIER=2,zo.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),zo.experimentalLetterSpacing=!1,zo._fonts={},zo._newlines=[10,13],zo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Vo=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Xo=class{constructor(t){this.styleID=0,this.reset(),qo(this,t,t)}clone(){const t={};return qo(t,this,Xo.defaultStyle),new Xo(t)}reset(){qo(this,Xo.defaultStyle,Xo.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Yo(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Yo(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Yo(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();/([\"\'])[^\'\"]+\1/.test(i)||Vo.includes(i)||(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let $o=Xo;function Yo(t){const e=St.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function qo(t,e,i){for(const s in i)Array.isArray(e[s])?t[s]=e[s].slice():t[s]=e[s]}$o.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ho.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Ko={texture:!0,children:!1,baseTexture:!0},Qo=class extends nr{constructor(t,e,i){let s=!1;i||(i=b.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const r=Ai.from(i);r.orig=new Se,r.trim=new Se,super(r),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Qo.defaultResolution??b.RESOLUTION,this._autoResolution=Qo.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return zo.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Y(0,"Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),zo.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,s=zo.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,n=s.height,o=s.lines,a=s.lineHeight,h=s.lineWidths,l=s.maxLineWidth,c=s.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let t=0;t<p;++t){const r=e.dropShadow&&0===t,p=r?Math.ceil(Math.max(1,n)+2*e.padding):0,f=p*this._resolution;if(r){i.fillStyle="black",i.strokeStyle="black";const t=e.dropShadowColor,s=e.dropShadowBlur*this._resolution,r=e.dropShadowDistance*this._resolution;i.shadowColor=St.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=s,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*r,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*r+f}else i.fillStyle=this._generateFillStyle(e,o,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let m=(a-c.fontSize)/2;a-c.fontSize<0&&(m=0);for(let t=0;t<o.length;t++)u=e.strokeThickness/2,d=e.strokeThickness/2+t*a+c.ascent+m,"right"===e.align?u+=l-h[t]:"center"===e.align&&(u+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-p,!0),e.fill&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-p)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){const r=this._style.letterSpacing;let n=!1;if(zo.experimentalLetterSpacingSupported&&(zo.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||n)return void(s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));let o=e;const a=zo.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];s?this.context.strokeText(e,o,i):this.context.fillText(e,o,i);let n="";for(let e=t+1;e<a.length;++e)n+=a[e];l=this.context.measureText(n).width,o+=h-l+r,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=zt(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,i=this._style,s=i.trim?0:i.padding,r=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),r.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const s=t.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let r;const n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-n-2*o,h=this.canvas.height/this._resolution-n-2*o,l=s.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(s[0]),c.unshift(0),l.push(s[s.length-1]),c.push(1),t.fillGradientType===Ho.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,h+o);const s=i.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const n=i.lineHeight*(t-1)+s,o=i.lineHeight*t;let a=o;t>0&&n>o&&(a=(o+n)/2);const u=o+s,d=i.lineHeight*(t+1);let p=u;t+1<e.length&&d<u&&(p=(u+d)/2);const f=(p-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let i=Math.min(1,Math.max(0,a/h+e*f));i=Number(i.toFixed(5)),r.addColorStop(i,l[t])}}}else{r=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let i=0;i<l.length;i++){let s;s="number"==typeof c[i]?c[i]:e/t,r.addColorStop(s,l[i]),e++}}return r}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ko,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof $o?t:new $o(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Zo=Qo;Zo.defaultAutoResolution=!0;class Jo{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function ta(t,e){let i=!1;if(t?._textures?.length)for(let s=0;s<t._textures.length;s++)if(t._textures[s]instanceof Ai){const r=t._textures[s].baseTexture;e.includes(r)||(e.push(r),i=!0)}return i}function ea(t,e){if(t.baseTexture instanceof he){const i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function ia(t,e){if(t._texture&&t._texture instanceof Ai){const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function sa(t,e){return e instanceof Zo&&(e.updateText(!0),!0)}function ra(t,e){if(e instanceof $o){const t=e.toFontString();return zo.measureFont(t),!0}return!1}function na(t,e){if(t instanceof Zo){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function oa(t,e){return t instanceof $o&&(e.includes(t)||e.push(t),!0)}const aa=class{constructor(t){this.limiter=new Jo(aa.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(na),this.registerFindHook(oa),this.registerFindHook(ta),this.registerFindHook(ea),this.registerFindHook(ia),this.registerUploadHook(sa),this.registerUploadHook(ra)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Ds.system.addOnce(this.tick,this,Ps.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Ds.system.addOnce(this.tick,this,Ps.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ir)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Ds.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let ha=aa;function la(t,e){return e instanceof he&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ca(t,e){if(!(e instanceof Mo))return!1;const{geometry:i}=e;e.finishPoly(),i.updateBatches();const{batches:s}=i;for(let e=0;e<s.length;e++){const{texture:i}=s[e].style;i&&la(t,i.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function ua(t,e){return t instanceof Mo&&(e.push(t),!0)}ha.uploadsPerFrame=4,Object.defineProperties(b,{UPLOADS_PER_FRAME:{get:()=>ha.uploadsPerFrame,set(t){Y(0,"settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),ha.uploadsPerFrame=t}}});class da extends ha{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ua),this.registerUploadHook(la),this.registerUploadHook(ca)}}da.extension={name:"prepare",type:$t.RendererSystem},Kt.add(da);class pa extends nr{constructor(t,e=!0){super(t[0]instanceof Ai?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ds.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ds.shared.add(this.update,this,Ps.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){let i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];const s=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*s,this._currentTime+=s;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let i=0;i<t.length;++i)e.push(Ai.from(t[i]));return new pa(e)}static fromImages(t){const e=[];for(let i=0;i<t.length;++i)e.push(Ai.from(t[i]));return new pa(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Ai)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ds.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ds.shared.add(this.update,this),this._isConnectedToTicker=!0))}}new we;var fa="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const ma=new Re;class _a extends ci{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Mi,this.state=te.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ai.from(fa,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?ai.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):ai.from(fa,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-n,s[2]=s[4]=1-r,s[5]=s[7]=1-n,i.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let d=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;d&&(a._glTextures[e.CONTEXT_UID]?d=a.wrapMode!==u.CLAMP:a.wrapMode===u.CLAMP&&(a.wrapMode=u.REPEAT));const p=d?this.simpleShader:this.shader,f=o.width,m=o.height,_=t._width,g=t._height;ma.set(l.a*f/_,l.b*f/g,l.c*m/_,l.d*m/g,l.tx/_,l.ty/g),ma.invert(),d?ma.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=ma.toArray(!0),p.uniforms.uColor=St.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=o,e.shader.bind(p),e.geometry.bind(i),this.state.blendMode=At(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}_a.extension={name:"tilingSprite",type:$t.RendererPlugin},Kt.add(_a);const ga=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof Ai?t:null,this.baseTexture=t instanceof he?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=Xt(t,null);return null===i&&(i=parseFloat(e??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=ga.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const i=ga.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const t=this._frameKeys[e],i=this._frames[t],s=i.frame;if(s){let e=null,r=null;const n=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,o=new Se(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);e=i.rotated?new Se(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new Se(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(r=new Se(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[t]=new Ai(this.baseTexture,e,o,r,i.rotated?2:0,i.anchor,i.borders),Ai.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*ga.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*ga.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ya=ga;ya.BATCH_SIZE=1e3;const va=["jpg","png","jpeg","avif","webp"];function xa(t,e,i){const s={};if(t.forEach((t=>{s[t]=e})),Object.keys(e.textures).forEach((t=>{s[t]=e.textures[t]})),!i){const i=X.dirname(t[0]);e.linkedSheets.forEach(((t,r)=>{const n=xa([`${i}/${e.data.meta.related_multi_packs[r]}`],t,!0);Object.assign(s,n)}))}return s}const ba={extension:$t.Asset,cache:{test:t=>t instanceof ya,getCacheableAssets:(t,e)=>xa(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),i=e.pop(),s=e.pop();return"json"===i&&va.includes(s)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(b.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:$t.LoadParser,priority:Lr.Normal},testParse:async(t,e)=>".json"===X.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,i){let s=X.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let r=s+t.meta.image;r=fn(r,e.src);const n=(await i.load([r]))[r],o=new ya(n.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const r of a){if("string"!=typeof r)continue;let n=s+r;e.data?.ignoreMultiPack||(n=fn(n,e.src),t.push(i.load({src:n,data:{ignoreMultiPack:!0}})))}const r=await Promise.all(t);o.linkedSheets=r,r.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};Kt.add(ba);class Ea{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class wa{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const s=e[t].match(/^[a-z]+/gm)[0],r=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const t in r){const e=r[t].split("="),i=e[0],s=e[1].replace(/"/gm,""),o=parseFloat(s),a=isNaN(o)?s:o;n[i]=a}i[s].push(n)}const s=new Ea;return i.info.forEach((t=>s.info.push({face:t.face,size:parseInt(t.size,10)}))),i.common.forEach((t=>s.common.push({lineHeight:parseInt(t.lineHeight,10)}))),i.page.forEach((t=>s.page.push({id:parseInt(t.id,10),file:t.file}))),i.char.forEach((t=>s.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),i.kerning.forEach((t=>s.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),i.distanceField.forEach((t=>s.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),s}}class Ta{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Ea,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<i.length;t++)e.info.push({face:i[t].getAttribute("face"),size:parseInt(i[t].getAttribute("size"),10)});for(let t=0;t<s.length;t++)e.common.push({lineHeight:parseInt(s[t].getAttribute("lineHeight"),10)});for(let t=0;t<r.length;t++)e.page.push({id:parseInt(r[t].getAttribute("id"),10)||0,file:r[t].getAttribute("file")});for(let t=0;t<n.length;t++){const i=n[t];e.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class Sa{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Ta.test(b.ADAPTER.parseXML(t))}static parse(t){return Ta.parse(b.ADAPTER.parseXML(t))}}const Ca=[wa,Ta,Sa];function Aa(t,e,i,s,r,n,o){const a=i.text,h=i.fontProperties;e.translate(s,r),e.scale(n,n);const l=o.strokeThickness/2,c=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,i,s,r,n){const o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=t.width/s-h-2*l,u=t.height/s-h-2*l,d=o.slice(),p=i.fillGradientStops.slice();if(!p.length){const t=d.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),i.fillGradientType===Ho.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const s=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let e=0;e<r.length;e++){const i=n.lineHeight*e;for(let e=0;e<d.length;e++){let r=0;r="number"==typeof p[e]?p[e]:e/d.length;const n=i/u+r*s;let o=Math.max(t,n);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let i=1;for(let e=0;e<d.length;e++){let s;s="number"==typeof p[e]?p[e]:i/t,a.addColorStop(s,d[e]),i++}}return a}(t,e,o,n,[a],i),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,i=o.dropShadowBlur*n,s=o.dropShadowDistance*n;e.shadowColor=St.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=i,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*s,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*s}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,c+i.lineHeight-h.descent),o.fill&&e.fillText(a,l,c+i.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Ia(t){return Array.from?Array.from(t):t.split("")}function Pa(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const Ra=class{constructor(t,e,i){const[s]=t.info,[r]=t.common,[n]=t.page,[o]=t.distanceField,a=Xt(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=r.lineHeight/a,this.chars={},this.pageTextures=h;for(let i=0;i<t.page.length;i++){const{id:s,file:r}=t.page[i];h[s]=e instanceof Array?e[i]:e[r],o?.fieldType&&"none"!==o.fieldType&&(h[s].baseTexture.alphaMode=p.NO_PREMULTIPLIED_ALPHA,h[s].baseTexture.mipmap=d.OFF)}for(let e=0;e<t.char.length;e++){const{id:i,page:s}=t.char[e];let{x:r,y:n,width:o,height:l,xoffset:c,yoffset:u,xadvance:d}=t.char[e];r/=a,n/=a,o/=a,l/=a,c/=a,u/=a,d/=a;const p=new Se(r+h[s].frame.x/a,n+h[s].frame.y/a,o,l);this.chars[i]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Ai(h[s].baseTexture,p),page:s}}for(let e=0;e<t.kerning.length;e++){let{first:i,second:s,amount:r}=t.kerning[e];i/=a,s/=a,r/=a,this.chars[s]&&(this.chars[s].kerning[i]=r)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof Ea)s=t;else{const e=function(t){for(let e=0;e<Ca.length;e++)if(Ca[e].test(t))return Ca[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");s=e.parse(t)}e instanceof Ai&&(e=[e]);const r=new Ra(s,e,i);return Ra.available[r.font]=r,r}static uninstall(t){const e=Ra.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Ra.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:r,resolution:n,textureWidth:o,textureHeight:a,...h}=Object.assign({},Ra.defaultOptions,i),l=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];if(Array.isArray(s)){if(2!==s.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const t=s[0].charCodeAt(0),i=s[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let s=t,r=i;s<=r;s++)e.push(String.fromCharCode(s))}else e.push(...Ia(s))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),c=e instanceof $o?e:new $o(e),u=o,d=new Ea;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let p,f,m,_=0,g=0,y=0;const v=[],x=[];for(let t=0;t<l.length;t++){p||(p=b.ADAPTER.createCanvas(),p.width=o,p.height=a,f=p.getContext("2d"),m=new he(p,{resolution:n,...h}),v.push(m),x.push(new Ai(m)),d.page.push({id:x.length-1,file:""}));const e=l[t],i=zo.measureText(e,c,!1,p),s=i.width,E=Math.ceil(i.height),w=Math.ceil(("italic"===c.fontStyle?2:1)*s);if(g>=a-E*n){if(0===g)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,p=null,f=null,m=null,g=0,_=0,y=0;continue}if(y=Math.max(E+i.fontProperties.descent,y),w*n+_>=u){if(0===_)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,g+=y*n,g=Math.ceil(g),_=0,y=0;continue}Aa(p,f,i,_,g,n,c);const T=Pa(i.text);d.char.push({id:T,page:x.length-1,x:_/n,y:g/n,width:w,height:E,xoffset:0,yoffset:0,xadvance:s-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),_+=(w+2*r)*n,_=Math.ceil(_)}for(let t=0,e=l.length;t<e;t++){const i=l[t];for(let t=0;t<e;t++){const e=l[t],s=f.measureText(i).width,r=f.measureText(e).width,n=f.measureText(i+e).width-(s+r);n&&d.kerning.push({first:Pa(i),second:Pa(e),amount:n})}}const E=new Ra(d,x,!0);return void 0!==Ra.available[t]&&Ra.uninstall(t),Ra.available[t]=E,E}};let Ma=Ra;Ma.ALPHA=[["a","z"],["A","Z"]," "],Ma.NUMERIC=[["0","9"]],Ma.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ma.ASCII=[[" ","~"]],Ma.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ra.ALPHANUMERIC},Ma.available={};const Da=[],ka=[],Na=[],Oa=class extends ir{constructor(t,e={}){super();const{align:i,tint:s,maxWidth:r,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},Oa.styleDefaults,e);if(!Ma.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new St(s),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new Ue((()=>{this.dirty=!0}),this,0,0),this._roundPixels=b.ROUND_PIXELS,this.dirty=!0,this._resolution=b.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=Ma.available[this._fontName],e=this.fontSize,i=e/t.size,s=new we,n=[],o=[],a=[],h=Ia(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*t.size/e,c="none"===t.distanceFieldType?Da:ka;let u=null,d=0,p=0,f=0,m=-1,_=0,g=0,y=0,v=0;for(let e=0;e<h.length;e++){const i=h[e],r=Pa(i);if(/(?:\s)/.test(i)&&(m=e,_=d,v++),"\r"===i||"\n"===i){o.push(d),a.push(-1),p=Math.max(p,d),++f,++g,s.x=0,s.y+=t.lineHeight,u=null,v=0;continue}const c=t.chars[r];if(!c)continue;u&&c.kerning[u]&&(s.x+=c.kerning[u]);const x=Na.pop()||{texture:Ai.EMPTY,line:0,charCode:0,prevSpaces:0,position:new we};x.texture=c.texture,x.line=f,x.charCode=r,x.position.x=Math.round(s.x+c.xOffset+this._letterSpacing/2),x.position.y=Math.round(s.y+c.yOffset),x.prevSpaces=v,n.push(x),d=x.position.x+Math.max(c.xAdvance-c.xOffset,c.texture.orig.width),s.x+=c.xAdvance+this._letterSpacing,y=Math.max(y,c.yOffset+c.texture.height),u=r,-1!==m&&l>0&&s.x>l&&(++g,Dt(n,1+m-g,1+e-m),e=m,m=-1,o.push(_),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,_),f++,s.x=0,s.y+=t.lineHeight,u=null,v=0)}const x=h[h.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=_),o.push(d),p=Math.max(p,d),a.push(-1));const b=[];for(let t=0;t<=f;t++){let e=0;"right"===this._align?e=p-o[t]:"center"===this._align?e=(p-o[t])/2:"justify"===this._align&&(e=a[t]<0?0:(p-o[t])/a[t]),b.push(e)}const E=n.length,w={},T=[],S=this._activePagesMeshData;c.push(...S);for(let e=0;e<E;e++){const i=n[e].texture,s=i.baseTexture.uid;if(!w[s]){let e=c.pop();if(!e){const i=new Lo;let s,n;"none"===t.distanceFieldType?(s=new Bo(Ai.EMPTY),n=r.NORMAL):(s=new Bo(Ai.EMPTY,{program:ri.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),n=r.NORMAL_NPM);const o=new Fo(i,s);o.blendMode=n,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:n}=this;n[s]=n[s]||new Ai(i.baseTexture),e.mesh.texture=n[s],e.mesh.tint=this._tintColor.value,T.push(e),w[s]=e}w[s].total++}for(let t=0;t<S.length;t++)T.includes(S[t])||this.removeChild(S[t].mesh);for(let t=0;t<T.length;t++)T[t].mesh.parent!==this&&this.addChild(T[t].mesh);this._activePagesMeshData=T;for(const t in w){const e=w[t],i=e.total;if(!(e.indices?.length>6*i)||e.vertices.length<2*Fo.BATCHABLE_SIZE)e.vertices=new Float32Array(8*i),e.uvs=new Float32Array(8*i),e.indices=new Uint16Array(6*i);else{const t=e.total,i=e.vertices;for(let e=4*t*2;e<i.length;e++)i[e]=0}e.mesh.size=6*i}for(let t=0;t<E;t++){const e=n[t];let s=e.position.x+b[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(s=Math.round(s));const r=s*i,o=e.position.y*i,a=e.texture,h=w[a.baseTexture.uid],l=a.frame,c=a._uvs,u=h.index++;h.indices[6*u+0]=0+4*u,h.indices[6*u+1]=1+4*u,h.indices[6*u+2]=2+4*u,h.indices[6*u+3]=0+4*u,h.indices[6*u+4]=2+4*u,h.indices[6*u+5]=3+4*u,h.vertices[8*u+0]=r,h.vertices[8*u+1]=o,h.vertices[8*u+2]=r+l.width*i,h.vertices[8*u+3]=o,h.vertices[8*u+4]=r+l.width*i,h.vertices[8*u+5]=o+l.height*i,h.vertices[8*u+6]=r,h.vertices[8*u+7]=o+l.height*i,h.uvs[8*u+0]=c.x0,h.uvs[8*u+1]=c.y0,h.uvs[8*u+2]=c.x1,h.uvs[8*u+3]=c.y1,h.uvs[8*u+4]=c.x2,h.uvs[8*u+5]=c.y2,h.uvs[8*u+6]=c.x3,h.uvs[8*u+7]=c.y3}this._textWidth=p*i,this._textHeight=(s.y+t.lineHeight)*i;for(const t in w){const e=w[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const i=this._textWidth*this.anchor.x,s=this._textHeight*this.anchor.y;for(let r=0;r<e.total;r++)e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s}this._maxLineHeight=y*i;const s=e.mesh.geometry.getBuffer("aVertexPosition"),r=e.mesh.geometry.getBuffer("aTextureCoord"),n=e.mesh.geometry.getIndex();s.data=e.vertices,r.data=e.uvs,n.data=e.indices,s.update(),r.update(),n.update()}for(let t=0;t<n.length;t++)Na.push(n[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:s}=Ma.available[this._fontName];if("none"!==i){const{a:i,b:r,c:n,d:o}=this.worldTransform,a=Math.sqrt(i*i+r*r),h=Math.sqrt(n*n+o*o),l=(Math.abs(a)+Math.abs(h))/2,c=this.fontSize/s,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Ma.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Ma.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Ma.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i="none"===Ma.available[this._fontName].distanceFieldType?Da:ka;i.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],i.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Ai.EMPTY}));for(const t in e){e[t].destroy(),delete e[t]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Oa.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Fa=[".xml",".fnt"],La={extension:{type:$t.LoadParser,priority:Lr.Normal},name:"loadBitmapFont",test:t=>Fa.includes(X.extname(t).toLowerCase()),testParse:async t=>wa.test(t)||Sa.test(t),async parse(t,e,i){const s=wa.test(t)?wa.parse(t):Sa.parse(t),{src:r}=e,{page:n}=s,o=[];for(let t=0;t<n.length;++t){const e=n[t].file;let i=X.join(X.dirname(r),e);i=fn(i,r),o.push(i)}const a=await i.load(o),h=o.map((t=>a[t]));return Ma.install(s,h,!0)},load:async(t,e)=>(await b.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};Kt.add(La);const Ba=class extends $o{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Ba(Object.keys(Ba.defaultOptions).reduce(((e,i)=>({...e,[i]:t[i]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Ba.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=Ba;if(i[t]){const e=i[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return b.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,i)=>{const s=URL.createObjectURL(t),r=new FileReader;r.onload=()=>e([s,r.result]),r.onerror=i,r.readAsDataURL(t)})))).then((async([s,r])=>{const n=Object.assign({family:X.basename(t,X.extname(t)),weight:"normal",style:"normal",src:s,dataSrc:r,refs:1,originalUrl:t,fontFace:null},e);i[t]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){var e,i;return Array.isArray(t)&&(e=t,Y(0,"utils.rgb2hex is deprecated, use Color#toNumber instead"),t=St.shared.setValue(e).toNumber()),"number"==typeof t?(i=t,Y(0,"utils.hex2string is deprecated, use Color#toHex instead"),St.shared.setValue(i).toHex()):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const r=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${r} ${t}`}reset(){Object.assign(this,Ba.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=b.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){}get fillGradientType(){return super.fillGradientType}set miterLimit(t){}get miterLimit(){return super.miterLimit}set trim(t){}get trim(){return super.trim}set textBaseline(t){}get textBaseline(){return super.textBaseline}set leading(t){}get leading(){return super.leading}set lineJoin(t){}get lineJoin(){return super.lineJoin}};let Ua=Ba;Ua.availableFonts={},Ua.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Ga=class extends nr{constructor(t="",e={}){super(Ai.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const i=new Image,s=Ai.from(i,{scaleMode:b.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new Se,s.trim=new Se,this.texture=s;const r="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),a=document.createElementNS(r,"foreignObject"),h=document.createElementNS(n,"div"),l=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Ga.defaultMaxWidth,this.maxHeight=Ga.defaultMaxHeight,this._domElement=h,this._styleElement=l,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(l),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=Ga.defaultAutoResolution,this._resolution=Ga.defaultResolution??b.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const n=Math.min(this.maxWidth,Math.ceil(r.width)),o=Math.min(this.maxHeight,Math.ceil(r.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:n+2*i.padding,height:o+2*i.padding}}async updateText(t=!0){const{style:e,_image:i,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:r,height:n}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,r)),i.height=s.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise((t=>{s.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,i.src=s.src,s.onload=null,s.src="",this.updateTexture(),t()};const r=(new XMLSerializer).serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:s}=this,{padding:r}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),n.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ga.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=kt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=kt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Ua?(this.ownsStyle=!1,this._style=t):t instanceof $o?(this.ownsStyle=!0,this._style=Ua.from(t)):(this.ownsStyle=!0,this._style=new Ua(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Ha=Ga;Ha.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ha.defaultMaxWidth=2024,Ha.defaultMaxHeight=2024,Ha.defaultAutoResolution=!0;class ja{constructor(){}static initialize(){ja.initialized||(ja.initialized=!0,document.addEventListener("keydown",ja.onKeyDown),document.addEventListener("keyup",ja.onKeyUp))}static onKeyDown(t){1!=ja.state.get(t.code)&&ja.down.emit(t.code),ja.state.set(t.code,!0)}static onKeyUp(t){ja.up.emit(t.code),ja.state.set(t.code,!1)}}ja.state=new Map,ja.down=new G,ja.up=new G,ja.initialized=!1;const Wa={bundles:[{name:"mainScene",assets:{Font:"PressStart2P.ttf",SongTitle:"naves_song_title.mp3",SongLevel:"naves_song_level.mp3",GameOver:"gameover.mp3",EnemyKilled:"enemy_killed.mp3",Item:"item.mp3",Background:"background.png",Background1:"background1.png",Background2:"background2.png",Ship:"ship.png",Ship_left:"ship_left.png",Ship_right:"ship_right.png",Shot:"shot.png",Enemy01:"enemy01.png",Enemy02:"enemy02.png",Enemy03:"enemy03.png",Enemy04:"enemy04.png",Two:"two.png",Three:"three.png",Speed:"speed.png",Fullscreen:"fullscreen.png",Muted:"muted.png",Unmuted:"unmuted.png",Back:"back.png",Ok:"ok.png",Highscore:"highscore.png"}}]};let za;za="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};class Va{constructor(){Va.prototype.__init.call(this),Va.prototype.__init2.call(this),Va.prototype.__init3.call(this),Va.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return Va._shared||(Va._shared=new Va),Va._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=void 0}__init4(){this.now=za}getAll(){return Object.keys(this._tweens).map((t=>this._tweens[t]))}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(null==t&&(null==this._lastUpdateTime?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const i=Object.keys(this._tweens);if(0==i.length)return!1;for(let s=0;s<i.length;s++){const r=this._tweens[i[s]];r&&0==r.update(t,!0)&&!e&&delete this._tweens[i[s]]}return!0}}const Xa={Step:{None:t=>t<.5?0:1},Linear:{None:t=>t},Quadratic:{In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Cubic:{In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Quartic:{In:t=>t*t*t*t,Out:t=>1- --t*t*t*t,InOut:t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},Quintic:{In:t=>t*t*t*t*t,Out:t=>--t*t*t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},Sinusoidal:{In:t=>1-Math.cos(t*Math.PI/2),Out:t=>Math.sin(t*Math.PI/2),InOut:t=>.5*(1-Math.cos(Math.PI*t))},Exponential:{In:t=>0==t?0:Math.pow(1024,t-1),Out:t=>1==t?1:1-Math.pow(2,-10*t),InOut:t=>0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},Circular:{In:t=>1-Math.sqrt(1-t*t),Out:t=>Math.sqrt(1- --t*t),InOut:t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},Elastic:{In:t=>0==t?0:1==t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI),Out:t=>0==t?0:1==t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1,InOut:t=>0==t?0:1==t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:t=>1-Xa.Bounce.Out(1-t),Out:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,InOut:t=>t<.5?.5*Xa.Bounce.In(2*t):.5*Xa.Bounce.Out(2*t-1)+.5}},$a={Geom:{Linear(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.Linear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)},Bezier(t,e){let i=0;const s=t.length-1,r=Math.pow,n=$a.Utils.Bernstein;for(let o=0;o<=s;o++)i+=n(s,o)*r(1-e,s-o)*r(e,o)*t[o];return i},QuadraticBezier(t,e){let i=0;const s=t.length-1;if(1==e)return t[s];const r=Math.pow,n=$a.Utils.Bernstein,o=s*e,a=Math.floor(o),h=.5*(o-a)+a%2*.5,l=a-a%2,c=l+1,u=l+2;return i+=n(2,0)*r(1-h,2)*r(h,0)*t[l],i+=n(2,1)*r(1-h,1)*r(h,1)*t[c],i+=n(2,2)*r(1-h,0)*r(h,2)*t[u],i},CubicBezier(t,e){let i=0;const s=t.length-1;if(1==e)return t[s];const r=Math.pow,n=$a.Utils.Bernstein,o=s*e,a=Math.floor(o),h=1/3*(o-a)+1/3*(a%3),l=a-a%3,c=l+1,u=l+2,d=l+3;return i+=n(3,0)*r(1-h,3)*r(h,0)*t[l],i+=n(3,1)*r(1-h,2)*r(h,1)*t[c],i+=n(3,2)*r(1-h,1)*r(h,2)*t[u],i+=n(3,3)*r(1-h,0)*r(h,3)*t[d],i},CatmullRom(t,e){const i=t.length-1;let s=i*e,r=Math.floor(s);const n=$a.Utils.CatmullRom;return t[0]==t[i]?(e<0&&(r=Math.floor(s=i*(1+e))),n(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],s-r)):e<0?t[0]-(n(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(n(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):n(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],s-r)}},Angle:{Radians(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.WrapLinear;return e<0?n(t[0],t[1],s,2*Math.PI):e>1?n(t[i],t[i-1],i-s,2*Math.PI):n(t[r],t[r+1>i?i:r+1],s-r,2*Math.PI)},Degrees(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.WrapLinear;return e<0?n(t[0],t[1],s,360):e>1?n(t[i],t[i-1],i-s,360):n(t[r],t[r+1>i?i:r+1],s-r,360)}},Color:{RGB(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.RGBLinear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)},HSV(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.HSVLinear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)},HCL(t,e){const i=t.length-1,s=i*e,r=Math.floor(s),n=$a.Utils.HCLLinear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)}},Utils:{RGBsplit:t=>({a:t>>24&255,r:t>>16&255,g:t>>8&255,b:255&t}),HSVsplit(t){const e=$a.Utils.RGBsplit(t);e.r/=255,e.g/=255,e.b/=255;const i=Math.max(e.r,e.g,e.b),s=Math.min(e.r,e.g,e.b);let r;const n=i,o=i-s,a=0==i?0:o/i;if(i==s)r=0;else{switch(i){case e.r:r=(e.g-e.b)/o+(e.g<e.b?6:0);break;case e.g:r=(e.b-e.r)/o+2;break;case e.b:r=(e.r-e.g)/o+4}r/=6}return{a:e.a,h:r,s:a,v:n}},HSVJoin(t){let e,i,s;const r=Math.floor(6*t.h),n=6*t.h-r,o=t.v*(1-t.s),a=t.v*(1-n*t.s),h=t.v*(1-(1-n)*t.s);switch(r%6){case 0:e=t.v,i=h,s=o;break;case 1:e=a,i=t.v,s=o;break;case 2:e=o,i=t.v,s=h;break;case 3:e=o,i=a,s=t.v;break;case 4:e=h,i=o,s=t.v;break;case 5:e=t.v,i=o,s=a}return t.a<<24|e<<16|i<<8|s},HCLSplit(t){const e=$a.Utils.RGBsplit(t),i={a:e.a,h:0,c:0,l:0};let s=0;const r=Math.min(e.r,Math.min(e.g,e.b)),n=Math.max(e.r,Math.max(e.g,e.b));let o=.03;return i.c=n-r,0!=i.c&&(s=Math.atan2(e.g-e.b,e.r-e.g)/Math.PI,o*=r/n),o=Math.exp(o),i.h=(s/2-Math.min(s%1,-s%1)/6)%1,i.c*=o,i.l=$a.Utils.Linear(-r,n,o)/1.060909067907034,i},HCLJoin(t){const e={a:t.a,r:0,g:0,b:0};if(0!=t.l){let i=t.h;const s=t.c,r=.530454533953517*t.l,n=Math.exp(.03*(1-s/(2*r))),o=(2*r-s)/(2*n-1),a=s/n,h=(i+Math.min(2*i%1/4,-2*i%1/8))*Math.PI*2;let l;i*=6,i<=.999?(l=Math.tan(h),e.r=1,e.g=l/(1+l)):i<=1.001?(e.r=1,e.g=1):i<=2?(l=Math.tan(h),e.r=(1+l)/l,e.g=1):i<=3?(l=Math.tan(h),e.g=1,e.b=1+l):i<=3.999?(l=Math.tan(h),e.g=1/(1+l),e.b=1):i<=4.001?(e.g=0,e.b=1):i<=5?(l=Math.tan(h),e.r=-1/l,e.b=1):(l=Math.tan(h),e.r=1,e.b=-l),e.r=e.r*a+o,e.g=e.g*a+o,e.b=e.b*a+o}return e.a<<24|e.r<<16|e.g<<8|e.b},WrapLinear(t,e,i,s){let r;return t=(t+s*Math.trunc(Math.abs(t/s)))%s,e=(e+s*Math.trunc(Math.abs(e/s)))%s,Math.abs(t-e)<=.5*s?r=$a.Utils.Linear(t,e,i):(r=t<e?$a.Utils.Linear(t+s,e,i):$a.Utils.Linear(t,e+s,i),r%=s),r},RGBLinear(t,e,i){const s=$a.Utils.RGBsplit(t),r=$a.Utils.RGBsplit(e);return $a.Utils.Linear(s.a,r.a,i)<<24|$a.Utils.Linear(s.r,r.r,i)<<16|$a.Utils.Linear(s.g,r.g,i)<<8|$a.Utils.Linear(s.b,r.b,i)},HSVLinear(t,e,i){const s=$a.Utils.HSVsplit(t),r=$a.Utils.HSVsplit(e);let n;Math.abs(s.h-r.h)<=.5?n=$a.Utils.Linear(s.h,r.h,i):(n=s.h<r.h?$a.Utils.Linear(s.h+1,r.h,i):$a.Utils.Linear(s.h,r.h+1,i),n%=1);const o=$a.Utils.Linear(s.s,r.s,i),a=$a.Utils.Linear(s.v,r.v,i),h=$a.Utils.Linear(s.a,r.a,i);return $a.Utils.HSVJoin({a:h,h:n,s:o,v:a})},HCLLinear(t,e,i){const s=$a.Utils.HCLSplit(t),r=$a.Utils.HCLSplit(e);let n;Math.abs(s.h-r.h)<=.5?n=$a.Utils.Linear(s.h,r.h,i):(n=s.h<r.h?$a.Utils.Linear(s.h+1,r.h,i):$a.Utils.Linear(s.h,r.h+1,i),n%=1);const o=$a.Utils.Linear(s.c,r.c,i),a=$a.Utils.Linear(s.l,r.l,i),h=$a.Utils.Linear(s.a,r.a,i);return $a.Utils.HSVJoin({a:h,h:n,s:o,v:a})},Linear:(t,e,i)=>(e-t)*i+t,Bernstein(t,e){const i=$a.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){const t=[1];return function(e){let i=1;if(t[e])return t[e];for(let t=e;t>1;t--)i*=t;return t[e]=i,i}}(),CatmullRom(t,e,i,s,r){const n=.5*(i-t),o=.5*(s-e),a=r*r;return(2*e-2*i+n+o)*(r*a)+(-3*e+3*i-2*n-o)*a+n*r+e}}};class Ya{static __initStatic(){this._nextId=0}static nextId(){return Ya._nextId++}}Ya.__initStatic();const qa={safetyCheckFunction:t=>!0,easingFunction:Xa.Linear.None,yoyoEasingFunction:void 0,interpolationFunction:$a.Geom.Linear};class Ka{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!=0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=qa.safetyCheckFunction}__init15(){this._easingFunction=qa.easingFunction}__init16(){this._yoyoEasingFunction=qa.yoyoEasingFunction}__init17(){this._interpolationFunction=qa.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=Ya.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:Va.shared}set _group(t){this._groupRef=t}constructor(t,e){Ka.prototype.__init.call(this),Ka.prototype.__init2.call(this),Ka.prototype.__init3.call(this),Ka.prototype.__init4.call(this),Ka.prototype.__init5.call(this),Ka.prototype.__init6.call(this),Ka.prototype.__init7.call(this),Ka.prototype.__init8.call(this),Ka.prototype.__init9.call(this),Ka.prototype.__init10.call(this),Ka.prototype.__init11.call(this),Ka.prototype.__init12.call(this),Ka.prototype.__init13.call(this),Ka.prototype.__init14.call(this),Ka.prototype.__init15.call(this),Ka.prototype.__init16.call(this),Ka.prototype.__init17.call(this),Ka.prototype.__init18.call(this),Ka.prototype.__init19.call(this),Ka.prototype.__init20.call(this),Ka.prototype.__init21.call(this),Ka.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch(t){throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch(i){return this.dynamicTo(t,e)}return void 0!==e&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying||(null!=t&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1)),this}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);const t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,i,s,r){for(const n in i){const o=t[n],a=Array.isArray(o),h=!Number.isNaN(Number(o)),l=a?"array":typeof o,c="object"==l,u="object"==typeof i[n],d=!a&&Array.isArray(i[n]);"undefined"!=l&&"function"!=l&&null!=i[n]&&(a||h||c)&&((c||a||u)&&o&&!d?(void 0===e[n]&&(e[n]=a?[]:{}),void 0===s[n]&&(s[n]=a?[]:{}),this._setupProperties(o,e[n],i[n],s[n],r)):((void 0===e[n]||r)&&(e[n]=o),(void 0===s[n]||r)&&(s[n]=d?i[n].slice().reverse()[0]:e[n]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(1/0),!t){this._chainedTweens=e;for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this}resume(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=1/0){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){const i=this._internalUpdate(t);return i||e||this._group.remove(this),i}_internalUpdate(t){if(!this._safetyCheckFunction(this._object))return!1;if(this._isPaused)return!1;let e;t*=this._timescale,this._elapsedTime+=t;const i=this._duration,s=this._startTime+this._elapsedTime;if(s>i&&!this._isPlaying)return!1;this.isPlaying||this.start(),0==this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),0==this._onAfterDelayCallbackFired&&s>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=s/this._duration,0==this._duration&&(e=s>=0?1:0),e=Math.min(1,e),e=Math.max(0,e);let r=Number.isFinite(s)?s%this._duration:s;Number.isNaN(r)&&(r=0);const n=Math.floor(s/this._duration);let o;if(o=this._reversed&&this._yoyoEasingFunction?this._yoyoEasingFunction(e):this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&(1!=e||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),1==e){if(this._repeat-this._repeatCount>0){const t=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+n),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||r<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),void 0!==this._repeatDelayTime?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let e=1;Number.isFinite(n)?e=this._repeatCount-t:Number.isFinite(this._repeat)&&(e=this._repeat-t);for(let i=0;i<e;i++)this._onRepeatCallback(this._object,t+1+i,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return r>0&&Number.isFinite(this._repeat)&&this._internalUpdate(r),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start(),r>0&&this._chainedTweens[t].update(r);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,i,s){for(const r in i){if(null==e[r])continue;const n=e[r];let o=i[r];const a=Array.isArray(t[r]),h=Array.isArray(o);!a&&h?this._reversed?t[r]=this._interpolationFunction(o.concat([n]),s):t[r]=this._interpolationFunction([n].concat(o),s):"object"==typeof o&&o?this._updateProperties(t[r],n,o,s):(o=this._handleRelativeValue(n,o),"number"!=typeof o||"number"!=typeof n&&"string"!=typeof n||(t[r]=Number(n)+(o-Number(n))*s,"string"==typeof n&&(t[r]=String(t[r]))))}}_handleRelativeValue(t,e){return"string"!=typeof e?e:"+"==e.charAt(0)||"-"==e.charAt(0)?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(const i in t){const s=!Array.isArray(t[i])&&Array.isArray(e[i]);if("object"==typeof t[i])this._swapEndStartRepeatValues(t[i],e[i]);else{const r=t[i];if("string"==typeof e[i])t[i]=Number(t[i])+Number(e[i]),e[i]=r;else if(s){const s=e[i].slice().reverse();t[i]=s[0],e[i]=s}else t[i]=e[i],e[i]=r}}}_moveForwardStartRepeatValues(t,e){for(const i in t)"object"==typeof e[i]?this._moveForwardStartRepeatValues(t[i],e[i]):"string"==typeof e[i]&&(t[i]=Number(t[i])+Number(e[i]))}}class Qa{constructor(){}static get width(){return Qa._width}static get height(){return Qa._height}static initialize(t,e,i){Qa._width=t,Qa._height=e,Qa.app=new Ir({view:document.getElementById("pixi-canvas"),resolution:window.devicePixelRatio||1,autoDensity:!0,backgroundColor:i,width:t,height:e,antialias:!1,premultipliedAlpha:!1,backgroundAlpha:1}),globalThis.__PIXI_APP__=Qa.app,window.addEventListener("resize",(()=>{const t=window.innerWidth/this.app.screen.width,e=window.innerHeight/this.app.screen.height,i=Math.min(t,e),s=Math.round(this.app.screen.width*i),r=Math.round(this.app.screen.height*i),n=Math.floor((window.innerWidth-s)/2),o=Math.floor((window.innerHeight-r)/2),a=this.app.view;a.style.width=s+"px",a.style.height=r+"px",a.style.marginLeft=n+"px",a.style.marginRight=n+"px",a.style.marginTop=o+"px",a.style.marginBottom=o+"px"})),window.dispatchEvent(new Event("resize")),Ds.shared.add(Qa.update)}static changeScene(t){Qa.currentScene&&(Qa.app.stage.removeChild(Qa.currentScene),Qa.currentScene.destroy()),Qa.currentScene=t,Qa.app.stage.addChild(Qa.currentScene)}static update(t){Qa.currentScene&&(Qa.currentScene.update(Ds.shared.deltaMS,t),Va.shared.update())}}Qa.muted=!1;class Za extends ir{constructor(){super(...arguments),this.speed=new we,this.acceleration=new we}update(t){this.x+=this.speed.x*t+.5*this.acceleration.x*Math.pow(t,2),this.y+=this.speed.y*t+.5*this.acceleration.y*Math.pow(t,2),this.speed.x+=this.acceleration.x*t,this.speed.y+=this.acceleration.y*t}}class Ja extends ir{constructor(){super(),this.states=new Map,this.animContainer=new ir,this.addChild(this.animContainer)}playState(t,e=!1){this.animContainer.removeChildren();const i=this.states.get(t);i&&(this.animContainer.addChild(i),e&&i.gotoAndPlay(0))}addState(t,e,i=.2,s=!0){const r=[];for(const t of e)"string"==typeof t?r.push(Ai.from(t)):r.push(t);const n=new pa(r);n.anchor.set(.5,.5),n.animationSpeed=i,n.loop=s,n.play(),this.states.set(t,n)}update(t,e){for(const t of this.states.values())t.update(e)}}class th extends Za{constructor(){super(),this.shipAnimated=new Ja,this.shipAnimated.addState("idle",["./ship.png"]),this.shipAnimated.addState("left",["./ship_left.png"]),this.shipAnimated.addState("right",["./ship_right.png"]),this.shipAnimated.playState("idle",!0),this.hitbox=new Mo,this.hitbox.beginFill(16711935,.5),this.hitbox.visible=!1,this.hitbox.drawRect(-4,-4,8,8),this.hitbox.endFill,this.addChild(this.shipAnimated),this.addChild(this.hitbox)}update(t){super.update(t/1e3),ja.state.get("ArrowRight")?this.speed.x=th.MOVE_SPEED:ja.state.get("ArrowLeft")&&(this.speed.x=-th.MOVE_SPEED),ja.state.get("ArrowDown")?this.speed.y=th.MOVE_SPEED:ja.state.get("ArrowUp")&&(this.speed.y=-th.MOVE_SPEED),ja.up.on("ArrowLeft",(()=>{this.resetSpeedandAnimation()})),ja.up.on("ArrowRight",(()=>{this.resetSpeedandAnimation()})),ja.up.on("ArrowUp",(()=>{this.resetSpeedandAnimation()})),ja.up.on("ArrowDown",(()=>{this.resetSpeedandAnimation()})),this.speed.x>0?this.shipAnimated.playState("right",!0):this.speed.x<0?this.shipAnimated.playState("left",!0):this.shipAnimated.playState("idle",!0)}resetSpeedandAnimation(){this.speed.x=0,this.speed.y=0}getHitbox(){return this.hitbox.getBounds()}separate(t,e,i){t.width<t.height?this.x>e.x||(this.x,e.x):this.y<e.y&&this.speed.y>1?(this.y-=t.height,this.speed.y=0,this.x+=i,0!==this.speed.x?this.shipAnimated.playState("run",!1):this.shipAnimated.playState("idle",!0)):(this.y,e.y)}playState(t,e){this.shipAnimated.playState(t,e)}}function eh(t,e){const i=t.getHitbox(),s=e.getHitbox(),r=i.left<s.left?s.left:i.left,n=i.right>s.right?s.right:i.right,o=i.top<s.top?s.top:i.top,a=i.bottom>s.bottom?s.bottom:i.bottom;if(r<n&&o<a){const t=new Se;return t.x=r,t.y=o,t.width=n-r,t.height=a-o,t}return null}th.MOVE_SPEED=350,th.NORMAL_SHOOT_DELAY=700,th.SHOOT_DELAY=th.NORMAL_SHOOT_DELAY,th.SHOOT_STYLE="normal";class ih extends Za{constructor(t){super();const e=nr.from("shot.png");e.scale.set(6),e.anchor.set(.5),this.position.set(Km.player.x,Km.player.y),this.addChild(e),this.hitbox=new Mo,this.hitbox.beginFill(16711935,.01),this.hitbox.drawRect(-4,-4,8,8),this.hitbox.endFill,this.hitbox.scale.set(6),this.addChild(this.hitbox),this.tween=new Ka(this).to({x:Km.player.x+t,y:this.y-1500},2200).start()}getHitbox(){return this.hitbox.getBounds()}}const sh=!1,rh=!1,nh="${JSCORE_VERSION}",oh=function(t,e){if(!t)throw ah(e)},ah=function(t){return new Error("Firebase Database ("+nh+") INTERNAL ASSERT FAILED: "+t)},hh=function(t){const e=[];let i=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):55296==(64512&r)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++s)),e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e},lh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const r=t[e],n=e+1<t.length,o=n?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,l=r>>2,c=(3&r)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,n||(u=64)),s.push(i[l],i[c],i[u],i[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(hh(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,s=0;for(;i<t.length;){const r=t[i++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const n=t[i++];e[s++]=String.fromCharCode((31&r)<<6|63&n)}else if(r>239&&r<365){const n=((7&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[s++]=String.fromCharCode(55296+(n>>10)),e[s++]=String.fromCharCode(56320+(1023&n))}else{const n=t[i++],o=t[i++];e[s++]=String.fromCharCode((15&r)<<12|(63&n)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=i[t.charAt(e++)],n=e<t.length?i[t.charAt(e)]:0;++e;const o=e<t.length?i[t.charAt(e)]:64;++e;const a=e<t.length?i[t.charAt(e)]:64;if(++e,null==r||null==n||null==o||null==a)throw new ch;const h=r<<2|n>>4;if(s.push(h),64!==o){const t=n<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class ch extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uh=function(t){const e=hh(t);return lh.encodeByteArray(e,!0)},dh=function(t){return uh(t).replace(/\./g,"")},ph=function(t){try{return lh.decodeString(t,!0)}catch(t){}return null};function fh(t){return mh(void 0,t)}function mh(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const i in e)e.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=mh(t[i],e[i]));return t}const _h=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i.g)return i.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,gh=()=>{try{return _h()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&ph(t[1]);return e&&JSON.parse(e)})()}catch(t){return}},yh=t=>{const e=(t=>{var e,i;return null===(i=null===(e=gh())||void 0===e?void 0:e.emulatorHosts)||void 0===i?void 0:i[t]})(t);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(i+1),10);return"["===e[0]?[e.substring(1,i-1),s]:[e.substring(0,i),s]},vh=()=>{var t;return null===(t=gh())||void 0===t?void 0:t.config};class xh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}function bh(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Eh(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(bh())}function wh(){return!0===sh||!0===rh}class Th extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Th.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sh.prototype.create)}}class Sh{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],n=r?function(t,e){return t.replace(Ch,((t,i)=>{const s=e[i];return null!=s?String(s):`<${i}?>`}))}(r,i):"Error",o=`${this.serviceName}: ${n} (${s}).`;return new Th(s,o,i)}}const Ch=/\{\$([^}]+)}/g;function Ah(t){return JSON.parse(t)}function Ih(t){return JSON.stringify(t)}const Ph=function(t){let e={},i={},s={},r="";try{const n=t.split(".");e=Ah(ph(n[0])||""),i=Ah(ph(n[1])||""),r=n[2],s=i.d||{},delete i.d}catch(t){}return{header:e,claims:i,data:s,signature:r}};function Rh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mh(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Dh(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function kh(t,e,i){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=e.call(i,t[r],r,t));return s}function Nh(t,e){if(t===e)return!0;const i=Object.keys(t),s=Object.keys(e);for(const r of i){if(!s.includes(r))return!1;const i=t[r],n=e[r];if(Oh(i)&&Oh(n)){if(!Nh(i,n))return!1}else if(i!==n)return!1}for(const t of s)if(!i.includes(t))return!1;return!0}function Oh(t){return null!==t&&"object"==typeof t}class Fh{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const i=this.W_;if("string"==typeof t)for(let s=0;s<16;s++)i[s]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let s=0;s<16;s++)i[s]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let t=16;t<80;t++){const e=i[t-3]^i[t-8]^i[t-14]^i[t-16];i[t]=4294967295&(e<<1|e>>>31)}let s,r,n=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(let t=0;t<80;t++){t<40?t<20?(s=h^o&(a^h),r=1518500249):(s=o^a^h,r=1859775393):t<60?(s=o&a|h&(o|a),r=2400959708):(s=o^a^h,r=3395469782);const e=(n<<5|n>>>27)+s+l+r+i[t]&4294967295;l=h,h=a,a=4294967295&(o<<30|o>>>2),o=n,n=e}this.chain_[0]=this.chain_[0]+n&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const i=e-this.blockSize;let s=0;const r=this.buf_;let n=this.inbuf_;for(;s<e;){if(0===n)for(;s<=i;)this.compress_(t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[n]=t.charCodeAt(s),++n,++s,n===this.blockSize){this.compress_(r),n=0;break}}else for(;s<e;)if(r[n]=t[s],++n,++s,n===this.blockSize){this.compress_(r),n=0;break}}this.inbuf_=n,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let t=this.blockSize-1;t>=56;t--)this.buf_[t]=255&e,e/=256;this.compress_(this.buf_);let i=0;for(let e=0;e<5;e++)for(let s=24;s>=0;s-=8)t[i]=this.chain_[e]>>s&255,++i;return t}}function Lh(t,e){return`${t} failed: ${e} argument `}const Bh=function(t){let e=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,i++):e+=3}return e};function Uh(t){return t&&t._delegate?t._delegate:t}class Gh{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Hh="[DEFAULT]";class jh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new xh;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:Hh})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t=Hh){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=Hh){return this.instances.has(t)}getOptions(t=Hh){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries()){i===this.normalizeInstanceIdentifier(t)&&e.resolve(s)}return s}onInit(t,e){var i;const s=this.normalizeInstanceIdentifier(e),r=null!==(i=this.onInitCallbacks.get(s))&&void 0!==i?i:new Set;r.add(t),this.onInitCallbacks.set(s,r);const n=this.instances.get(s);return n&&t(n,s),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const s of i)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===Hh?void 0:s),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var s;return i||null}normalizeInstanceIdentifier(t=Hh){return this.component?this.component.multipleInstances?t:Hh:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Wh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new jh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const zh=[];var Vh;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Vh||(Vh={}));const Xh={debug:Vh.DEBUG,verbose:Vh.VERBOSE,info:Vh.INFO,warn:Vh.WARN,error:Vh.ERROR,silent:Vh.SILENT},$h=Vh.INFO,Yh={[Vh.DEBUG]:"log",[Vh.VERBOSE]:"log",[Vh.INFO]:"info",[Vh.WARN]:"warn",[Vh.ERROR]:"error"},qh=(t,e,...i)=>{if(e<t.logLevel)return;(new Date).toISOString();if(!Yh[e])throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Kh{constructor(t){this.name=t,this._logLevel=$h,this._logHandler=qh,this._userLogHandler=null,zh.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Vh))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?Xh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Vh.DEBUG,...t),this._logHandler(this,Vh.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Vh.VERBOSE,...t),this._logHandler(this,Vh.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Vh.INFO,...t),this._logHandler(this,Vh.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Vh.WARN,...t),this._logHandler(this,Vh.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Vh.ERROR,...t),this._logHandler(this,Vh.ERROR,...t)}}let Qh,Zh;const Jh=new WeakMap,tl=new WeakMap,el=new WeakMap,il=new WeakMap,sl=new WeakMap;let rl={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return tl.get(t);if("objectStoreNames"===e)return t.objectStoreNames||el.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return al(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function nl(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Zh||(Zh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(hl(this),e),al(Jh.get(this))}:function(...e){return al(t.apply(hl(this),e))}:function(e,...i){const s=t.call(hl(this),e,...i);return el.set(s,e.sort?e.sort():[e]),al(s)}}function ol(t){return"function"==typeof t?nl(t):(t instanceof IDBTransaction&&function(t){if(tl.has(t))return;const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",n),t.removeEventListener("abort",n)},r=()=>{e(),s()},n=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",n),t.addEventListener("abort",n)}));tl.set(t,e)}(t),e=t,(Qh||(Qh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>e instanceof t))?new Proxy(t,rl):t);var e}function al(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",n)},r=()=>{e(al(t.result)),s()},n=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",n)}));return e.then((e=>{e instanceof IDBCursor&&Jh.set(e,t)})).catch((()=>{})),sl.set(e,t),e}(t);if(il.has(t))return il.get(t);const e=ol(t);return e!==t&&(il.set(t,e),sl.set(e,t)),e}const hl=t=>sl.get(t);const ll=["get","getKey","getAll","getAllKeys","count"],cl=["put","add","delete","clear"],ul=new Map;function dl(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(ul.get(e))return ul.get(e);const i=e.replace(/FromIndex$/,""),s=e!==i,r=cl.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!ll.includes(i))return;const n=async function(t,...e){const n=this.transaction(t,r?"readwrite":"readonly");let o=n.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),r&&n.done]))[0]};return ul.set(e,n),n}rl=(t=>({...t,get:(e,i,s)=>dl(e,i)||t.get(e,i,s),has:(e,i)=>!!dl(e,i)||t.has(e,i)}))(rl);class pl{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const fl="@firebase/app",ml="0.9.19",_l=new Kh("@firebase/app"),gl="[DEFAULT]",yl={[fl]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},vl=new Map,xl=new Map;function bl(t,e){try{t.container.addComponent(e)}catch(i){_l.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function El(t){const e=t.name;if(xl.has(e))return _l.debug(`There were multiple attempts to register component ${e}.`),!1;xl.set(e,t);for(const e of vl.values())bl(e,t);return!0}function wl(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}const Tl=new Sh("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Sl{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Gh("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Tl.create("app-deleted",{appName:this._name})}}function Cl(t,e={}){let i=t;if("object"!=typeof e){e={name:e}}const s=Object.assign({name:gl,automaticDataCollectionEnabled:!1},e),r=s.name;if("string"!=typeof r||!r)throw Tl.create("bad-app-name",{appName:String(r)});if(i||(i=vh()),!i)throw Tl.create("no-options");const n=vl.get(r);if(n){if(Nh(i,n.options)&&Nh(s,n.config))return n;throw Tl.create("duplicate-app",{appName:r})}const o=new Wh(r);for(const t of xl.values())o.addComponent(t);const a=new Sl(i,s,o);return vl.set(r,a),a}function Al(t,e,i){var s;let r=null!==(s=yl[t])&&void 0!==s?s:t;i&&(r+=`-${i}`);const n=r.match(/\s|\//),o=e.match(/\s|\//);if(n||o){const t=[`Unable to register library "${r}" with version "${e}":`];return n&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),n&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void _l.warn(t.join(" "))}El(new Gh(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const Il="firebase-heartbeat-store";let Pl=null;function Rl(){return Pl||(Pl=function(t,e,{blocked:i,upgrade:s,blocking:r,terminated:n}={}){const o=indexedDB.open(t,e),a=al(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(al(o.result),t.oldVersion,t.newVersion,al(o.transaction),t)})),i&&o.addEventListener("blocked",(t=>i(t.oldVersion,t.newVersion,t))),a.then((t=>{n&&t.addEventListener("close",(()=>n())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(Il)}}).catch((t=>{throw Tl.create("idb-open",{originalErrorMessage:t.message})}))),Pl}async function Ml(t,e){try{const i=(await Rl()).transaction(Il,"readwrite"),s=i.objectStore(Il);await s.put(e,Dl(t)),await i.done}catch(t){if(t instanceof Th)_l.warn(t.message);else{const e=Tl.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});_l.warn(e.message)}}}function Dl(t){return`${t.name}!${t.options.appId}`}class kl{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ol(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Nl();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Nl(),{heartbeatsToSend:e,unsentEntries:i}=function(t,e=1024){const i=[];let s=t.slice();for(const r of t){const t=i.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),Fl(i)>e){t.dates.pop();break}}else if(i.push({agent:r.agent,dates:[r.date]}),Fl(i)>e){i.pop();break}s=s.slice(1)}return{heartbeatsToSend:i,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=dh(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Nl(){return(new Date).toISOString().substring(0,10)}class Ol{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let i=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),i||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{i=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await Rl();return await e.transaction(Il).objectStore(Il).get(Dl(t))}catch(t){if(t instanceof Th)_l.warn(t.message);else{const e=Tl.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});_l.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return Ml(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return Ml(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}}}function Fl(t){return dh(JSON.stringify({version:2,heartbeats:t})).length}var Ll;Ll="",El(new Gh("platform-logger",(t=>new pl(t)),"PRIVATE")),El(new Gh("heartbeat",(t=>new kl(t)),"PRIVATE")),Al(fl,ml,Ll),Al(fl,ml,"esm2017"),Al("fire-js","");Al("firebase","10.4.0","app");const Bl="@firebase/database",Ul="1.0.1";let Gl="";function Hl(t){Gl=t}class jl{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ih(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ah(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Wl{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return Rh(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const zl=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new jl(e)}}catch(t){}return new Wl},Vl=zl("localStorage"),Xl=zl("sessionStorage"),$l=new Kh("@firebase/database"),Yl=function(){let t=1;return function(){return t++}}(),ql=function(t){const e=function(t){const e=[];let i=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);if(r>=55296&&r<=56319){const e=r-55296;s++,oh(s<t.length,"Surrogate pair missing trail surrogate."),r=65536+(e<<10)+(t.charCodeAt(s)-56320)}r<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):r<65536?(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128)}return e}(t),i=new Fh;i.update(e);const s=i.digest();return lh.encodeByteArray(s)},Kl=function(...t){let e="";for(let i=0;i<t.length;i++){const s=t[i];Array.isArray(s)||s&&"object"==typeof s&&"number"==typeof s.length?e+=Kl.apply(null,s):e+="object"==typeof s?Ih(s):s,e+=" "}return e};let Ql=null,Zl=!0;const Jl=function(t,e){oh(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?($l.logLevel=Vh.VERBOSE,Ql=$l.log.bind($l),e&&Xl.set("logging_enabled",!0)):"function"==typeof t?Ql=t:(Ql=null,Xl.remove("logging_enabled"))},tc=function(...t){if(!0===Zl&&(Zl=!1,null===Ql&&!0===Xl.get("logging_enabled")&&Jl(!0)),Ql){const e=Kl.apply(null,t);Ql(e)}},ec=function(t){return function(...e){tc(t,...e)}},ic=function(...t){const e="FIREBASE INTERNAL ERROR: "+Kl(...t);$l.error(e)},sc=function(...t){const e=`FIREBASE FATAL ERROR: ${Kl(...t)}`;throw $l.error(e),new Error(e)},rc=function(...t){const e="FIREBASE WARNING: "+Kl(...t);$l.warn(e)},nc=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},oc="[MIN_NAME]",ac="[MAX_NAME]",hc=function(t,e){if(t===e)return 0;if(t===oc||e===ac)return-1;if(e===oc||t===ac)return 1;{const i=_c(t),s=_c(e);return null!==i?null!==s?i-s==0?t.length-e.length:i-s:-1:null!==s?1:t<e?-1:1}},lc=function(t,e){return t===e?0:t<e?-1:1},cc=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Ih(e))},uc=function(t){if("object"!=typeof t||null===t)return Ih(t);const e=[];for(const i in t)e.push(i);e.sort();let i="{";for(let s=0;s<e.length;s++)0!==s&&(i+=","),i+=Ih(e[s]),i+=":",i+=uc(t[e[s]]);return i+="}",i},dc=function(t,e){const i=t.length;if(i<=e)return[t];const s=[];for(let r=0;r<i;r+=e)r+e>i?s.push(t.substring(r,i)):s.push(t.substring(r,r+e));return s};function pc(t,e){for(const i in t)t.hasOwnProperty(i)&&e(i,t[i])}const fc=function(t){oh(!nc(t),"Invalid JSON number");const e=1023;let i,s,r,n,o;0===t?(s=0,r=0,i=1/t==-1/0?1:0):(i=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=Math.min(Math.floor(Math.log(t)/Math.LN2),e),s=n+e,r=Math.round(t*Math.pow(2,52-n)-Math.pow(2,52))):(s=0,r=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);a.push(i?1:0),a.reverse();const h=a.join("");let l="";for(o=0;o<64;o+=8){let t=parseInt(h.substr(o,8),2).toString(16);1===t.length&&(t="0"+t),l+=t}return l.toLowerCase()};const mc=new RegExp("^-?(0*)\\d{1,10}$"),_c=function(t){if(mc.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},gc=function(t){try{t()}catch(t){setTimeout((()=>{const e=t.stack||"";throw rc("Exception was thrown by user callback.",e),t}),Math.floor(0))}},yc=function(t,e){const i=setTimeout(t,e);return"number"==typeof i&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(i):"object"==typeof i&&i.unref&&i.unref(),i};class vc{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then((t=>this.appCheck=t))}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise(((e,i)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,i):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){rc(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class xc{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(tc("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,i)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,i):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rc(t)}}class bc{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}bc.OWNER="owner";const Ec="5",wc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Tc="ac",Sc="websocket",Cc="long_polling";class Ac{constructor(t,e,i,s,r=!1,n="",o=!1,a=!1){this.secure=e,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=n,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Vl.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Vl.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Ic(t,e,i){let s;if(oh("string"==typeof e,"typeof type must == string"),oh("object"==typeof i,"typeof params must == object"),e===Sc)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==Cc)throw new Error("Unknown connection type: "+e);s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(i.ns=t.namespace);const r=[];return pc(i,((t,e)=>{r.push(t+"="+e)})),s+r.join("&")}class Pc{constructor(){this.counters_={}}incrementCounter(t,e=1){Rh(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return fh(this.counters_)}}const Rc={},Mc={};function Dc(t){const e=t.toString();return Rc[e]||(Rc[e]=new Pc),Rc[e]}class kc{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&gc((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Nc="start";class Oc{constructor(t,e,i,s,r,n,o){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=n,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ec(t),this.stats_=Dc(e),this.urlFn=t=>(this.appCheckToken&&(t[Tc]=this.appCheckToken),Ic(e,Cc,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new kc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(wh()||"complete"===document.readyState)t();else{let e=!1;const i=function(){document.body?e||(e=!0,t()):setTimeout(i,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&i()})),window.attachEvent("onload",i))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Fc(((...t)=>{const[e,i,s,r,n]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===Nc)this.id=i,this.password=s;else{if("close"!==e)throw new Error("Unrecognized command received: "+e);i?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(i,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,i]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,i)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[Nc]="t",t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v=Ec,this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t[Tc]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&wc.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oc.forceAllow_=!0}static forceDisallow(){Oc.forceDisallow_=!0}static isAvailable(){return!wh()&&(!!Oc.forceAllow_||!(Oc.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Ih(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=uh(e),s=dc(i,1840);for(let t=0;t<s.length;t++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[t]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(wh())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Ih(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Fc{constructor(t,e,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,wh())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Yl(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Fc.createIFrame_();let i="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){i='<script>document.domain="'+document.domain+'";<\/script>'}const s="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){tc("frame writing exception"),t.stack&&tc(t.stack),tc(t)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||tc("No IE domain setting required")}catch(e){const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),i="",s=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+i.length<=1870))break;{const t=this.pendingSegs.shift();i=i+"&seg"+s+"="+t.seg+"&ts"+s+"="+t.ts+"&d"+s+"="+t.d,s++}}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(t,(()=>{clearTimeout(s),i()}))}addTag(t,e){wh()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const t=i.readyState;t&&"loaded"!==t&&"complete"!==t||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{tc("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch(t){}}),Math.floor(1))}}let Lc=null;"undefined"!=typeof MozWebSocket?Lc=MozWebSocket:"undefined"!=typeof WebSocket&&(Lc=WebSocket);class Bc{constructor(t,e,i,s,r,n,o){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ec(this.connId),this.stats_=Dc(e),this.connURL=Bc.connectionURL_(e,n,o,s,i),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,i,s,r){const n={};return n.v=Ec,!wh()&&"undefined"!=typeof location&&location.hostname&&wc.test(location.hostname)&&(n.r="f"),e&&(n.s=e),i&&(n.ls=i),s&&(n[Tc]=s),r&&(n.p=r),Ic(t,Sc,n)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Vl.set("previous_websocket_failure",!0);try{let t;if(wh()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Ec}/${Gl}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const i=process.env,s=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;s&&(t.proxy={origin:s})}this.mySock=new Lc(this.connURL,[],t)}catch(t){this.log_("Error instantiating WebSocket.");const e=t.message||t.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Bc.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(e);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&null!==Lc&&!Bc.forceDisallow_}static previouslyFailed(){return Vl.isInMemoryStorage||!0===Vl.get("previous_websocket_failure")}markConnectionHealthy(){Vl.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=Ah(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(oh(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=Ih(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=dc(e,16384);i.length>1&&this.sendString_(String(i.length));for(let t=0;t<i.length;t++)this.sendString_(i[t])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Bc.responsesRequiredToBeHealthy=2,Bc.healthyTimeout=3e4;class Uc{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Oc,Bc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const e=Bc&&Bc.isAvailable();let i=e&&!Bc.previouslyFailed();if(t.webSocketOnly&&(e||rc("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Bc];else{const t=this.transports_=[];for(const e of Uc.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e);Uc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Uc.globalTransportInitialized_=!1;class Gc{constructor(t,e,i,s,r,n,o,a,h,l){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=n,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ec("c:"+this.id+":"),this.transportManager_=new Uc(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,i)}),Math.floor(0));const s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=yc((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=cc("t",t),i=cc("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=cc("t",t),i=cc("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=cc("t",t);if("d"in t){const i=t.d;if("h"===e){const t=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?ic("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ic("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Ec!==i&&rc("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),yc((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):yc((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Vl.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Hc{put(t,e,i,s){}merge(t,e,i,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}class jc{constructor(t){this.allowedEvents_=t,this.listeners_={},oh(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let t=0;t<i.length;t++)i[t].callback.apply(i[t].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const s=this.getInitialEvent(t);s&&e.apply(i,s)}off(t,e,i){this.validateEventType_(t);const s=this.listeners_[t]||[];for(let t=0;t<s.length;t++)if(s[t].callback===e&&(!i||i===s[t].context))return void s.splice(t,1)}validateEventType_(t){oh(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}class Wc extends jc{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Eh()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Wc}getInitialEvent(t){return oh("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class zc{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Vc(){return new zc("")}function Xc(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function $c(t){return t.pieces_.length-t.pieceNum_}function Yc(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new zc(t.pieces_,e)}function qc(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Kc(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Qc(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let i=t.pieceNum_;i<t.pieces_.length-1;i++)e.push(t.pieces_[i]);return new zc(e,0)}function Zc(t,e){const i=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)i.push(t.pieces_[e]);if(e instanceof zc)for(let t=e.pieceNum_;t<e.pieces_.length;t++)i.push(e.pieces_[t]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&i.push(t[e])}return new zc(i,0)}function Jc(t){return t.pieceNum_>=t.pieces_.length}function tu(t,e){const i=Xc(t),s=Xc(e);if(null===i)return e;if(i===s)return tu(Yc(t),Yc(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function eu(t,e){if($c(t)!==$c(e))return!1;for(let i=t.pieceNum_,s=e.pieceNum_;i<=t.pieces_.length;i++,s++)if(t.pieces_[i]!==e.pieces_[s])return!1;return!0}function iu(t,e){let i=t.pieceNum_,s=e.pieceNum_;if($c(t)>$c(e))return!1;for(;i<t.pieces_.length;){if(t.pieces_[i]!==e.pieces_[s])return!1;++i,++s}return!0}class su{constructor(t,e){this.errorPrefix_=e,this.parts_=Kc(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let t=0;t<this.parts_.length;t++)this.byteLength_+=Bh(this.parts_[t]);ru(this)}}function ru(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nu(t))}function nu(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}class ou extends jc{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}static getInstance(){return new ou}getInitialEvent(t){return oh("visible"===t,"Unknown event type: "+t),[this.visible_]}}const au=1e3;class hu extends Hc{constructor(t,e,i,s,r,n,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=n,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=hu.nextPersistentConnectionId_++,this.log_=ec("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=au,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!wh())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ou.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Wc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,i){const s=++this.requestNumber_,r={r:s,a:t,b:e};this.log_(Ih(r)),oh(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();const e=new xh,i={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:t=>{const i=t.d;"ok"===t.s?e.resolve(i):e.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),e.promise}listen(t,e,i,s){this.initConnection_();const r=t._queryIdentifier,n=t._path.toString();this.log_("Listen called for "+n+" "+r),this.listens.has(n)||this.listens.set(n,new Map),oh(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),oh(!this.listens.get(n).has(r),"listen() called twice for same path/queryId.");const o={onComplete:s,hashFn:e,query:t,tag:i};this.listens.get(n).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(i)}))}sendListen_(t){const e=t.query,i=e._path.toString(),s=e._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i};t.tag&&(r.q=e._queryObject,r.t=t.tag),r.h=t.hashFn(),this.sendRequest("q",r,(r=>{const n=r.d,o=r.s;hu.warnOnListenWarnings_(n,e);(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(i,s),t.onComplete&&t.onComplete(o,n))}))}static warnOnListenWarnings_(t,e){if(t&&"object"==typeof t&&Rh(t,"w")){const i=Mh(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',i=e._path.toString();rc(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=Ph(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=Ph(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",i={cred:t};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(e,i,(e=>{const i=e.s,s=e.d||"error";this.authToken_===t&&("ok"===i?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,s))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t.s,i=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,i)}))}unlisten(t,e){const i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),oh(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,e)}sendUnlisten_(t,e,i,s){this.log_("Unlisten on "+t+" for "+e);const r={p:t};s&&(r.q=i,r.t=s),this.sendRequest("n",r)}onDisconnectPut(t,e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:i})}onDisconnectMerge(t,e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:i})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,i,s){const r={p:e,d:i};this.log_("onDisconnect "+t,r),this.sendRequest(t,r,(t=>{s&&setTimeout((()=>{s(t.s,t.d)}),Math.floor(0))}))}put(t,e,i,s){this.putInternal("p",t,e,i,s)}merge(t,e,i,s){this.putInternal("m",t,e,i,s)}putInternal(t,e,i,s,r){this.initConnection_();const n={p:e,d:i};void 0!==r&&(n.h=r),this.outstandingPuts_.push({action:t,request:n,onComplete:s}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,i,(i=>{this.log_(e+" response",i),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ih(t));const e=t.r,i=this.requestCBHash_[e];i&&(delete this.requestCBHash_[e],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):ic("Unrecognized action received from server: "+Ih(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){oh(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=au,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=au,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=au),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+hu.nextConnectionId_++,r=this.lastSessionId;let n=!1,o=null;const a=function(){o?o.close():(n=!0,i())},h=function(t){oh(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:h};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);n?tc("getToken() completed but was canceled"):(tc("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new Gc(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,i,(t=>{rc(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(t){this.log_("Failed to get token: "+t),n||(this.repoInfo_.nodeAdmin&&rc(t),a())}}}interrupt(t){tc("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){tc("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Dh(this.interruptReasons_)&&(this.reconnectDelay_=au,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let i;i=e?e.map((t=>uc(t))).join("$"):"default";const s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,e){const i=new zc(t).toString();let s;if(this.listens.has(i)){const t=this.listens.get(i);s=t.get(e),t.delete(e),0===t.size&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,e){tc("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){tc("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_&&this.securityDebugCallback_(t)}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";wh()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+Gl.replace(/\./g,"-")]=1,Eh()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Wc.getInstance().currentlyOnline();return Dh(this.interruptReasons_)&&t}}hu.nextPersistentConnectionId_=0,hu.nextConnectionId_=0;class lu{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new lu(t,e)}}class cu{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new lu(oc,t),s=new lu(oc,e);return 0!==this.compare(i,s)}minPost(){return lu.MIN}}let uu;class du extends cu{static get __EMPTY_NODE(){return uu}static set __EMPTY_NODE(t){uu=t}compare(t,e){return hc(t.name,e.name)}isDefinedOn(t){throw ah("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return lu.MIN}maxPost(){return new lu(ac,uu)}makePost(t,e){return oh("string"==typeof t,"KeyIndex indexValue must always be a string."),new lu(t,uu)}toString(){return".key"}}const pu=new du;class fu{constructor(t,e,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let n=1;for(;!t.isEmpty();)if(n=e?i(t.key,e):1,s&&(n*=-1),n<0)t=this.isReverse_?t.left:t.right;else{if(0===n){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class mu{constructor(t,e,i,s,r){this.key=t,this.value=e,this.color=null!=i?i:mu.RED,this.left=null!=s?s:_u.EMPTY_NODE,this.right=null!=r?r:_u.EMPTY_NODE}copy(t,e,i,s,r){return new mu(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=s?s:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let s=this;const r=i(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,i),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return _u.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let i,s;if(i=this,e(t,i.key)<0)i.left.isEmpty()||i.left.isRed_()||i.left.left.isRed_()||(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),i.right.isEmpty()||i.right.isRed_()||i.right.left.isRed_()||(i=i.moveRedRight_()),0===e(t,i.key)){if(i.right.isEmpty())return _u.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,mu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,mu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}mu.RED=!0,mu.BLACK=!1;class _u{constructor(t,e=_u.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new _u(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,mu.BLACK,null,null))}remove(t){return new _u(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,mu.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,s=null;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new fu(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new fu(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new fu(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new fu(this.root_,null,this.comparator_,!0,t)}}function gu(t,e){return hc(t.name,e.name)}function yu(t,e){return hc(t,e)}let vu;_u.EMPTY_NODE=new class{copy(t,e,i,s,r){return this}insert(t,e,i){return new mu(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const xu=function(t){return"number"==typeof t?"number:"+fc(t):"string:"+t},bu=function(t){if(t.isLeafNode()){const e=t.val();oh("string"==typeof e||"number"==typeof e||"object"==typeof e&&Rh(e,".sv"),"Priority must be a string or number.")}else oh(t===vu||t.isEmpty(),"priority of unexpected type.");oh(t===vu||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Eu,wu,Tu;class Su{constructor(t,e=Su.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,oh(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),bu(this.priorityNode_)}static set __childrenNodeConstructor(t){Eu=t}static get __childrenNodeConstructor(){return Eu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Su(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:Su.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Jc(t)?this:".priority"===Xc(t)?this.priorityNode_:Su.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Su.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const i=Xc(t);return null===i?e:e.isEmpty()&&".priority"!==i?this:(oh(".priority"!==i||1===$c(t),".priority must be the last token in a path"),this.updateImmediateChild(i,Su.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yc(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+xu(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?fc(this.value_):this.value_,this.lazyHash_=ql(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Su.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Su.__childrenNodeConstructor?-1:(oh(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,i=typeof this.value_,s=Su.VALUE_TYPE_ORDER.indexOf(e),r=Su.VALUE_TYPE_ORDER.indexOf(i);return oh(s>=0,"Unknown leaf type: "+e),oh(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}Su.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Cu=new class extends cu{compare(t,e){const i=t.node.getPriority(),s=e.node.getPriority(),r=i.compareTo(s);return 0===r?hc(t.name,e.name):r}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return lu.MIN}maxPost(){return new lu(ac,new Su("[PRIORITY-POST]",Tu))}makePost(t,e){const i=wu(t);return new lu(e,new Su("[PRIORITY-POST]",i))}toString(){return".priority"}},Au=Math.log(2);class Iu{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Au,10)),this.current_=this.count-1;const i=(s=this.count,parseInt(Array(s+1).join("1"),2));var s;this.bits_=t+1&i}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Pu=function(t,e,i,s){t.sort(e);const r=function(e,s){const n=s-e;let o,a;if(0===n)return null;if(1===n)return o=t[e],a=i?i(o):o,new mu(a,o.node,mu.BLACK,null,null);{const h=parseInt(n/2,10)+e,l=r(e,h),c=r(h+1,s);return o=t[h],a=i?i(o):o,new mu(a,o.node,mu.BLACK,l,c)}},n=function(e){let s=null,n=null,o=t.length;const a=function(e,s){const n=o-e,a=o;o-=e;const l=r(n+1,a),c=t[n],u=i?i(c):c;h(new mu(u,c.node,s,null,l))},h=function(t){s?(s.left=t,s=t):(n=t,s=t)};for(let t=0;t<e.count;++t){const i=e.nextBitIsOne(),s=Math.pow(2,e.count-(t+1));i?a(s,mu.BLACK):(a(s,mu.BLACK),a(s,mu.RED))}return n}(new Iu(t.length));return new _u(s||e,n)};let Ru;const Mu={};class Du{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return oh(Mu&&Cu,"ChildrenNode.ts has not been loaded"),Ru=Ru||new Du({".priority":Mu},{".priority":Cu}),Ru}get(t){const e=Mh(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof _u?e:null}hasIndex(t){return Rh(this.indexSet_,t.toString())}addIndex(t,e){oh(t!==pu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=e.getIterator(lu.Wrap);let n,o=r.getNext();for(;o;)s=s||t.isDefinedOn(o.node),i.push(o),o=r.getNext();n=s?Pu(i,t.getCompare()):Mu;const a=t.toString(),h=Object.assign({},this.indexSet_);h[a]=t;const l=Object.assign({},this.indexes_);return l[a]=n,new Du(l,h)}addToIndexes(t,e){const i=kh(this.indexes_,((i,s)=>{const r=Mh(this.indexSet_,s);if(oh(r,"Missing index implementation for "+s),i===Mu){if(r.isDefinedOn(t.node)){const i=[],s=e.getIterator(lu.Wrap);let n=s.getNext();for(;n;)n.name!==t.name&&i.push(n),n=s.getNext();return i.push(t),Pu(i,r.getCompare())}return Mu}{const s=e.get(t.name);let r=i;return s&&(r=r.remove(new lu(t.name,s))),r.insert(t,t.node)}}));return new Du(i,this.indexSet_)}removeFromIndexes(t,e){const i=kh(this.indexes_,(i=>{if(i===Mu)return i;{const s=e.get(t.name);return s?i.remove(new lu(t.name,s)):i}}));return new Du(i,this.indexSet_)}}let ku;class Nu{constructor(t,e,i){this.children_=t,this.priorityNode_=e,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&bu(this.priorityNode_),this.children_.isEmpty()&&oh(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ku||(ku=new Nu(new _u(yu),null,Du.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ku}updatePriority(t){return this.children_.isEmpty()?this:new Nu(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?ku:e}}getChild(t){const e=Xc(t);return null===e?this:this.getImmediateChild(e).getChild(Yc(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(oh(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const i=new lu(t,e);let s,r;e.isEmpty()?(s=this.children_.remove(t),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,e),r=this.indexMap_.addToIndexes(i,this.children_));const n=s.isEmpty()?ku:this.priorityNode_;return new Nu(s,n,r)}}updateChild(t,e){const i=Xc(t);if(null===i)return e;{oh(".priority"!==Xc(t)||1===$c(t),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(Yc(t),e);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let i=0,s=0,r=!0;if(this.forEachChild(Cu,((n,o)=>{e[n]=o.val(t),i++,r&&Nu.INTEGER_REGEXP_.test(n)?s=Math.max(s,Number(n)):r=!1})),!t&&r&&s<2*i){const t=[];for(const i in e)t[i]=e[i];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+xu(this.getPriority().val())+":"),this.forEachChild(Cu,((e,i)=>{const s=i.hash();""!==s&&(t+=":"+e+":"+s)})),this.lazyHash_=""===t?"":ql(t)}return this.lazyHash_}getPredecessorChildName(t,e,i){const s=this.resolveIndex_(i);if(s){const i=s.getPredecessorKey(new lu(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new lu(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new lu(e,this.children_.get(e)):null}forEachChild(t,e){const i=this.resolveIndex_(t);return i?i.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const i=this.resolveIndex_(e);if(i)return i.getIteratorFrom(t,(t=>t));{const i=this.children_.getIteratorFrom(t.name,lu.Wrap);let s=i.peek();for(;null!=s&&e.compare(s,t)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const i=this.resolveIndex_(e);if(i)return i.getReverseIteratorFrom(t,(t=>t));{const i=this.children_.getReverseIteratorFrom(t.name,lu.Wrap);let s=i.peek();for(;null!=s&&e.compare(s,t)>0;)i.getNext(),s=i.peek();return i}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ou?-1:0}withIndex(t){if(t===pu||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Nu(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===pu||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(Cu),i=e.getIterator(Cu);let s=t.getNext(),r=i.getNext();for(;s&&r;){if(s.name!==r.name||!s.node.equals(r.node))return!1;s=t.getNext(),r=i.getNext()}return null===s&&null===r}return!1}return!1}}resolveIndex_(t){return t===pu?null:this.indexMap_.get(t.toString())}}Nu.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Ou=new class extends Nu{constructor(){super(new _u(yu),Nu.EMPTY_NODE,Du.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Nu.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(lu,{MIN:{value:new lu(oc,Nu.EMPTY_NODE)},MAX:{value:new lu(ac,Ou)}}),du.__EMPTY_NODE=Nu.EMPTY_NODE,Su.__childrenNodeConstructor=Nu,vu=Ou,function(t){Tu=t}(Ou);function Fu(t,e=null){if(null===t)return Nu.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),oh(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t){return new Su(t,Fu(e))}if(t instanceof Array){let i=Nu.EMPTY_NODE;return pc(t,((e,s)=>{if(Rh(t,e)&&"."!==e.substring(0,1)){const t=Fu(s);!t.isLeafNode()&&t.isEmpty()||(i=i.updateImmediateChild(e,t))}})),i.updatePriority(Fu(e))}{const i=[];let s=!1;if(pc(t,((t,e)=>{if("."!==t.substring(0,1)){const r=Fu(e);r.isEmpty()||(s=s||!r.getPriority().isEmpty(),i.push(new lu(t,r)))}})),0===i.length)return Nu.EMPTY_NODE;const r=Pu(i,gu,(t=>t.name),yu);if(s){const t=Pu(i,Cu.getCompare());return new Nu(r,Fu(e),new Du({".priority":t},{".priority":Cu}))}return new Nu(r,Fu(e),Du.Default)}}!function(t){wu=t}(Fu);class Lu extends cu{constructor(t){super(),this.indexPath_=t,oh(!Jc(t)&&".priority"!==Xc(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),s=this.extractChild(e.node),r=i.compareTo(s);return 0===r?hc(t.name,e.name):r}makePost(t,e){const i=Fu(t),s=Nu.EMPTY_NODE.updateChild(this.indexPath_,i);return new lu(e,s)}maxPost(){const t=Nu.EMPTY_NODE.updateChild(this.indexPath_,Ou);return new lu(ac,t)}toString(){return Kc(this.indexPath_,0).join("/")}}const Bu=new class extends cu{compare(t,e){const i=t.node.compareTo(e.node);return 0===i?hc(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return lu.MIN}maxPost(){return lu.MAX}makePost(t,e){const i=Fu(t);return new lu(e,i)}toString(){return".value"}};function Uu(t){return{type:"value",snapshotNode:t}}function Gu(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Hu(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function ju(t,e,i){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:i}}class Wu{constructor(t){this.index_=t}updateChild(t,e,i,s,r,n){oh(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=t.getImmediateChild(e);return o.getChild(s).equals(i.getChild(s))&&o.isEmpty()===i.isEmpty()?t:(null!=n&&(i.isEmpty()?t.hasChild(e)?n.trackChildChange(Hu(e,o)):oh(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?n.trackChildChange(Gu(e,i)):n.trackChildChange(ju(e,i,o))),t.isLeafNode()&&i.isEmpty()?t:t.updateImmediateChild(e,i).withIndex(this.index_))}updateFullNode(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(Cu,((t,s)=>{e.hasChild(t)||i.trackChildChange(Hu(t,s))})),e.isLeafNode()||e.forEachChild(Cu,((e,s)=>{if(t.hasChild(e)){const r=t.getImmediateChild(e);r.equals(s)||i.trackChildChange(ju(e,s,r))}else i.trackChildChange(Gu(e,s))}))),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?Nu.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class zu{constructor(t){this.indexedFilter_=new Wu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=zu.getStartPost_(t),this.endPost_=zu.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,s,r,n){return this.matches(new lu(e,i))||(i=Nu.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,s,r,n)}updateFullNode(t,e,i){e.isLeafNode()&&(e=Nu.EMPTY_NODE);let s=e.withIndex(this.index_);s=s.updatePriority(Nu.EMPTY_NODE);const r=this;return e.forEachChild(Cu,((t,e)=>{r.matches(new lu(t,e))||(s=s.updateImmediateChild(t,Nu.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class Vu{constructor(t){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const e=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?e<=0:e<0},this.withinEndPost=t=>{const e=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?e<=0:e<0},this.rangedFilter_=new zu(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,s,r,n){return this.rangedFilter_.matches(new lu(e,i))||(i=Nu.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,s,r,n):this.fullLimitUpdateChild_(t,e,i,r,n)}updateFullNode(t,e,i){let s;if(e.isLeafNode()||e.isEmpty())s=Nu.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let t;s=Nu.EMPTY_NODE.withIndex(this.index_),t=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let i=0;for(;t.hasNext()&&i<this.limit_;){const e=t.getNext();if(this.withinDirectionalStart(e)){if(!this.withinDirectionalEnd(e))break;s=s.updateImmediateChild(e.name,e.node),i++}}}else{let t;s=e.withIndex(this.index_),s=s.updatePriority(Nu.EMPTY_NODE),t=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let i=0;for(;t.hasNext();){const e=t.getNext();i<this.limit_&&this.withinDirectionalStart(e)&&this.withinDirectionalEnd(e)?i++:s=s.updateImmediateChild(e.name,Nu.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,s,r){let n;if(this.reverse_){const t=this.index_.getCompare();n=(e,i)=>t(i,e)}else n=this.index_.getCompare();const o=t;oh(o.numChildren()===this.limit_,"");const a=new lu(e,i),h=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(e)){const t=o.getImmediateChild(e);let c=s.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=c&&(c.name===e||o.hasChild(c.name));)c=s.getChildAfterChild(this.index_,c,this.reverse_);const u=null==c?1:n(c,a);if(l&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(ju(e,i,t)),o.updateImmediateChild(e,i);{null!=r&&r.trackChildChange(Hu(e,t));const i=o.updateImmediateChild(e,Nu.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(Gu(c.name,c.node)),i.updateImmediateChild(c.name,c.node)):i}}return i.isEmpty()?t:l&&n(h,a)>=0?(null!=r&&(r.trackChildChange(Hu(h.name,h.node)),r.trackChildChange(Gu(e,i))),o.updateImmediateChild(e,i).updateImmediateChild(h.name,Nu.EMPTY_NODE)):t}}class Xu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Cu}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return oh(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return oh(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:oc}hasEnd(){return this.endSet_}getIndexEndValue(){return oh(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return oh(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ac}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return oh(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Cu}copy(){const t=new Xu;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function $u(t,e){const i=t.copy();return i.index_=e,i}function Yu(t){const e={};if(t.isDefault())return e;let i;if(t.index_===Cu?i="$priority":t.index_===Bu?i="$value":t.index_===pu?i="$key":(oh(t.index_ instanceof Lu,"Unrecognized index type!"),i=t.index_.toString()),e.orderBy=Ih(i),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=Ih(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+Ih(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=Ih(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+Ih(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function qu(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let i=t.viewFrom_;""===i&&(i=t.isViewFromLeft()?"l":"r"),e.vf=i}return t.index_!==Cu&&(e.i=t.index_.toString()),e}class Ku extends Hc{constructor(t,e,i,s){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ec("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(oh(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,s){const r=t._path.toString();this.log_("Listen called for "+r+" "+t._queryIdentifier);const n=Ku.getListenId_(t,i),o={};this.listens_[n]=o;const a=Yu(t._queryParams);this.restRequest_(r+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(r,a,!1,i),Mh(this.listens_,n)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",s(e,null)}}))}unlisten(t,e){const i=Ku.getListenId_(t,e);delete this.listens_[i]}get(t){const e=Yu(t._queryParams),i=t._path.toString(),s=new xh;return this.restRequest_(i+".json",e,((t,e)=>{let r=e;404===t&&(r=null,t=null),null===t?(this.onDataUpdate_(i,r,!1,null),s.resolve(r)):s.reject(new Error(r))})),s.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([s,r])=>{s&&s.accessToken&&(e.auth=s.accessToken),r&&r.token&&(e.ac=r.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+function(t){const e=[];for(const[i,s]of Object.entries(t))Array.isArray(s)?s.forEach((t=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(i)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}(e);this.log_("Sending REST request for "+n);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(i&&4===o.readyState){this.log_("REST Response for "+n+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Ah(o.responseText)}catch(t){rc("Failed to parse JSON response for "+n+": "+o.responseText)}i(null,t)}else 401!==o.status&&404!==o.status&&rc("Got unsuccessful REST response for "+n+" Status: "+o.status),i(o.status);i=null}},o.open("GET",n,!0),o.send()}))}}class Qu{constructor(){this.rootNode_=Nu.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function Zu(){return{value:null,children:new Map}}function Ju(t,e,i){if(Jc(e))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,i);else{const s=Xc(e);t.children.has(s)||t.children.set(s,Zu());Ju(t.children.get(s),e=Yc(e),i)}}function td(t,e,i){null!==t.value?i(e,t.value):function(t,e){t.children.forEach(((t,i)=>{e(i,t)}))}(t,((t,s)=>{td(s,new zc(e.toString()+"/"+t),i)}))}class ed{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&pc(this.last_,((t,i)=>{e[t]=e[t]-i})),this.last_=t,e}}class id{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new ed(t);const i=1e4+2e4*Math.random();yc(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;pc(t,((t,s)=>{s>0&&Rh(this.statsToReport_,t)&&(e[t]=s,i=!0)})),i&&this.server_.reportStats(e),yc(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var sd;function rd(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(sd||(sd={}));class nd{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=sd.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(Jc(this.path)){if(null!=this.affectedTree.value)return oh(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new zc(t));return new nd(Vc(),e,this.revert)}}return oh(Xc(this.path)===t,"operationForChild called for unrelated child."),new nd(Yc(this.path),this.affectedTree,this.revert)}}class od{constructor(t,e){this.source=t,this.path=e,this.type=sd.LISTEN_COMPLETE}operationForChild(t){return Jc(this.path)?new od(this.source,Vc()):new od(this.source,Yc(this.path))}}class ad{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=sd.OVERWRITE}operationForChild(t){return Jc(this.path)?new ad(this.source,Vc(),this.snap.getImmediateChild(t)):new ad(this.source,Yc(this.path),this.snap)}}class hd{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=sd.MERGE}operationForChild(t){if(Jc(this.path)){const e=this.children.subtree(new zc(t));return e.isEmpty()?null:e.value?new ad(this.source,Vc(),e.value):new hd(this.source,Vc(),e)}return oh(Xc(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new hd(this.source,Yc(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ld{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Jc(t))return this.isFullyInitialized()&&!this.filtered_;const e=Xc(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class cd{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function ud(t,e,i,s,r,n){const o=s.filter((t=>t.type===i));o.sort(((e,i)=>function(t,e,i){if(null==e.childName||null==i.childName)throw ah("Should only compare child_ events.");const s=new lu(e.childName,e.snapshotNode),r=new lu(i.childName,i.snapshotNode);return t.index_.compare(s,r)}(t,e,i))),o.forEach((i=>{const s=function(t,e,i){return"value"===e.type||"child_removed"===e.type||(e.prevName=i.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,i,n);r.forEach((r=>{r.respondsTo(i.type)&&e.push(r.createEvent(s,t.query_))}))}))}function dd(t,e){return{eventCache:t,serverCache:e}}function pd(t,e,i,s){return dd(new ld(e,i,s),t.serverCache)}function fd(t,e,i,s){return dd(t.eventCache,new ld(e,i,s))}function md(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function _d(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let gd;class yd{constructor(t,e=(()=>(gd||(gd=new _u(lc)),gd))()){this.value=t,this.children=e}static fromObject(t){let e=new yd(null);return pc(t,((t,i)=>{e=e.set(new zc(t),i)})),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:Vc(),value:this.value};if(Jc(t))return null;{const i=Xc(t),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(Yc(t),e);if(null!=r){return{path:Zc(new zc(i),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(Jc(t))return this;{const e=Xc(t),i=this.children.get(e);return null!==i?i.subtree(Yc(t)):new yd(null)}}set(t,e){if(Jc(t))return new yd(e,this.children);{const i=Xc(t),s=(this.children.get(i)||new yd(null)).set(Yc(t),e),r=this.children.insert(i,s);return new yd(this.value,r)}}remove(t){if(Jc(t))return this.children.isEmpty()?new yd(null):new yd(null,this.children);{const e=Xc(t),i=this.children.get(e);if(i){const s=i.remove(Yc(t));let r;return r=s.isEmpty()?this.children.remove(e):this.children.insert(e,s),null===this.value&&r.isEmpty()?new yd(null):new yd(this.value,r)}return this}}get(t){if(Jc(t))return this.value;{const e=Xc(t),i=this.children.get(e);return i?i.get(Yc(t)):null}}setTree(t,e){if(Jc(t))return e;{const i=Xc(t),s=(this.children.get(i)||new yd(null)).setTree(Yc(t),e);let r;return r=s.isEmpty()?this.children.remove(i):this.children.insert(i,s),new yd(this.value,r)}}fold(t){return this.fold_(Vc(),t)}fold_(t,e){const i={};return this.children.inorderTraversal(((s,r)=>{i[s]=r.fold_(Zc(t,s),e)})),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,Vc(),e)}findOnPath_(t,e,i){const s=!!this.value&&i(e,this.value);if(s)return s;if(Jc(t))return null;{const s=Xc(t),r=this.children.get(s);return r?r.findOnPath_(Yc(t),Zc(e,s),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Vc(),e)}foreachOnPath_(t,e,i){if(Jc(t))return this;{this.value&&i(e,this.value);const s=Xc(t),r=this.children.get(s);return r?r.foreachOnPath_(Yc(t),Zc(e,s),i):new yd(null)}}foreach(t){this.foreach_(Vc(),t)}foreach_(t,e){this.children.inorderTraversal(((i,s)=>{s.foreach_(Zc(t,i),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,i)=>{i.value&&t(e,i.value)}))}}class vd{constructor(t){this.writeTree_=t}static empty(){return new vd(new yd(null))}}function xd(t,e,i){if(Jc(e))return new vd(new yd(i));{const s=t.writeTree_.findRootMostValueAndPath(e);if(null!=s){const r=s.path;let n=s.value;const o=tu(r,e);return n=n.updateChild(o,i),new vd(t.writeTree_.set(r,n))}{const s=new yd(i),r=t.writeTree_.setTree(e,s);return new vd(r)}}}function bd(t,e,i){let s=t;return pc(i,((t,i)=>{s=xd(s,Zc(e,t),i)})),s}function Ed(t,e){if(Jc(e))return vd.empty();{const i=t.writeTree_.setTree(e,new yd(null));return new vd(i)}}function wd(t,e){return null!=Td(t,e)}function Td(t,e){const i=t.writeTree_.findRootMostValueAndPath(e);return null!=i?t.writeTree_.get(i.path).getChild(tu(i.path,e)):null}function Sd(t){const e=[],i=t.writeTree_.value;return null!=i?i.isLeafNode()||i.forEachChild(Cu,((t,i)=>{e.push(new lu(t,i))})):t.writeTree_.children.inorderTraversal(((t,i)=>{null!=i.value&&e.push(new lu(t,i.value))})),e}function Cd(t,e){if(Jc(e))return t;{const i=Td(t,e);return new vd(null!=i?new yd(i):t.writeTree_.subtree(e))}}function Ad(t){return t.writeTree_.isEmpty()}function Id(t,e){return Pd(Vc(),t.writeTree_,e)}function Pd(t,e,i){if(null!=e.value)return i.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal(((e,r)=>{".priority"===e?(oh(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=Pd(Zc(t,e),r,i)})),i.getChild(t).isEmpty()||null===s||(i=i.updateChild(Zc(t,".priority"),s)),i}}function Rd(t,e){return Wd(e,t)}function Md(t,e){const i=t.allWrites.findIndex((t=>t.writeId===e));oh(i>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[i];t.allWrites.splice(i,1);let r=s.visible,n=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const e=t.allWrites[o];e.visible&&(o>=i&&Dd(e,s.path)?r=!1:iu(s.path,e.path)&&(n=!0)),o--}if(r){if(n)return function(t){t.visibleWrites=Nd(t.allWrites,kd,Vc()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0;if(s.snap)t.visibleWrites=Ed(t.visibleWrites,s.path);else{pc(s.children,(e=>{t.visibleWrites=Ed(t.visibleWrites,Zc(s.path,e))}))}return!0}return!1}function Dd(t,e){if(t.snap)return iu(t.path,e);for(const i in t.children)if(t.children.hasOwnProperty(i)&&iu(Zc(t.path,i),e))return!0;return!1}function kd(t){return t.visible}function Nd(t,e,i){let s=vd.empty();for(let r=0;r<t.length;++r){const n=t[r];if(e(n)){const t=n.path;let e;if(n.snap)iu(i,t)?(e=tu(i,t),s=xd(s,e,n.snap)):iu(t,i)&&(e=tu(t,i),s=xd(s,Vc(),n.snap.getChild(e)));else{if(!n.children)throw ah("WriteRecord should have .snap or .children");if(iu(i,t))e=tu(i,t),s=bd(s,e,n.children);else if(iu(t,i))if(e=tu(t,i),Jc(e))s=bd(s,Vc(),n.children);else{const t=Mh(n.children,Xc(e));if(t){const i=t.getChild(Yc(e));s=xd(s,Vc(),i)}}}}}return s}function Od(t,e,i,s,r){if(s||r){const n=Cd(t.visibleWrites,e);if(!r&&Ad(n))return i;if(r||null!=i||wd(n,Vc())){const n=function(t){return(t.visible||r)&&(!s||!~s.indexOf(t.writeId))&&(iu(t.path,e)||iu(e,t.path))};return Id(Nd(t.allWrites,n,e),i||Nu.EMPTY_NODE)}return null}{const s=Td(t.visibleWrites,e);if(null!=s)return s;{const s=Cd(t.visibleWrites,e);if(Ad(s))return i;if(null!=i||wd(s,Vc())){return Id(s,i||Nu.EMPTY_NODE)}return null}}}function Fd(t,e,i,s){return Od(t.writeTree,t.treePath,e,i,s)}function Ld(t,e){return function(t,e,i){let s=Nu.EMPTY_NODE;const r=Td(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Cu,((t,e)=>{s=s.updateImmediateChild(t,e)})),s;if(i){const r=Cd(t.visibleWrites,e);return i.forEachChild(Cu,((t,e)=>{const i=Id(Cd(r,new zc(t)),e);s=s.updateImmediateChild(t,i)})),Sd(r).forEach((t=>{s=s.updateImmediateChild(t.name,t.node)})),s}return Sd(Cd(t.visibleWrites,e)).forEach((t=>{s=s.updateImmediateChild(t.name,t.node)})),s}(t.writeTree,t.treePath,e)}function Bd(t,e,i,s){return function(t,e,i,s,r){oh(s||r,"Either existingEventSnap or existingServerSnap must exist");const n=Zc(e,i);if(wd(t.visibleWrites,n))return null;{const e=Cd(t.visibleWrites,n);return Ad(e)?r.getChild(i):Id(e,r.getChild(i))}}(t.writeTree,t.treePath,e,i,s)}function Ud(t,e){return function(t,e){return Td(t.visibleWrites,e)}(t.writeTree,Zc(t.treePath,e))}function Gd(t,e,i,s,r,n){return function(t,e,i,s,r,n,o){let a;const h=Cd(t.visibleWrites,e),l=Td(h,Vc());if(null!=l)a=l;else{if(null==i)return[];a=Id(h,i)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),i=n?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let h=i.getNext();for(;h&&t.length<r;)0!==e(h,s)&&t.push(h),h=i.getNext();return t}}(t.writeTree,t.treePath,e,i,s,r,n)}function Hd(t,e,i){return function(t,e,i,s){const r=Zc(e,i),n=Td(t.visibleWrites,r);if(null!=n)return n;if(s.isCompleteForChild(i))return Id(Cd(t.visibleWrites,r),s.getNode().getImmediateChild(i));return null}(t.writeTree,t.treePath,e,i)}function jd(t,e){return Wd(Zc(t.treePath,e),t.writeTree)}function Wd(t,e){return{treePath:t,writeTree:e}}class zd{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;oh("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),oh(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===e&&"child_removed"===r)this.changeMap.set(i,ju(i,t.snapshotNode,s.snapshotNode));else if("child_removed"===e&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===e&&"child_changed"===r)this.changeMap.set(i,Hu(i,s.oldSnap));else if("child_changed"===e&&"child_added"===r)this.changeMap.set(i,Gu(i,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==r)throw ah("Illegal combination of changes: "+t+" occurred after "+s);this.changeMap.set(i,ju(i,t.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}const Vd=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}};class Xd{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new ld(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Hd(this.writes_,t,e)}}getChildAfterChild(t,e,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:_d(this.viewCache_),r=Gd(this.writes_,s,e,1,i,t);return 0===r.length?null:r[0]}}function $d(t,e,i,s,r){const n=new zd;let o,a;if(i.type===sd.OVERWRITE){const h=i;h.source.fromUser?o=Kd(t,e,h.path,h.snap,s,r,n):(oh(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!Jc(h.path),o=qd(t,e,h.path,h.snap,s,r,a,n))}else if(i.type===sd.MERGE){const h=i;h.source.fromUser?o=function(t,e,i,s,r,n,o){let a=e;return s.foreach(((s,h)=>{const l=Zc(i,s);Qd(e,Xc(l))&&(a=Kd(t,a,l,h,r,n,o))})),s.foreach(((s,h)=>{const l=Zc(i,s);Qd(e,Xc(l))||(a=Kd(t,a,l,h,r,n,o))})),a}(t,e,h.path,h.children,s,r,n):(oh(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=Jd(t,e,h.path,h.children,s,r,a,n))}else if(i.type===sd.ACK_USER_WRITE){const a=i;o=a.revert?function(t,e,i,s,r,n){let o;if(null!=Ud(s,i))return e;{const a=new Xd(s,e,r),h=e.eventCache.getNode();let l;if(Jc(i)||".priority"===Xc(i)){let i;if(e.serverCache.isFullyInitialized())i=Fd(s,_d(e));else{const t=e.serverCache.getNode();oh(t instanceof Nu,"serverChildren would be complete if leaf node"),i=Ld(s,t)}l=t.filter.updateFullNode(h,i,n)}else{const r=Xc(i);let c=Hd(s,r,e.serverCache);null==c&&e.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),l=null!=c?t.filter.updateChild(h,r,c,Yc(i),a,n):e.eventCache.getNode().hasChild(r)?t.filter.updateChild(h,r,Nu.EMPTY_NODE,Yc(i),a,n):h,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Fd(s,_d(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,n)))}return o=e.serverCache.isFullyInitialized()||null!=Ud(s,Vc()),pd(e,l,o,t.filter.filtersNodes())}}(t,e,a.path,s,r,n):function(t,e,i,s,r,n,o){if(null!=Ud(r,i))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=s.value){if(Jc(i)&&h.isFullyInitialized()||h.isCompleteForPath(i))return qd(t,e,i,h.getNode().getChild(i),r,n,a,o);if(Jc(i)){let s=new yd(null);return h.getNode().forEachChild(pu,((t,e)=>{s=s.set(new zc(t),e)})),Jd(t,e,i,s,r,n,a,o)}return e}{let l=new yd(null);return s.foreach(((t,e)=>{const s=Zc(i,t);h.isCompleteForPath(s)&&(l=l.set(t,h.getNode().getChild(s)))})),Jd(t,e,i,l,r,n,a,o)}}(t,e,a.path,a.affectedTree,s,r,n)}else{if(i.type!==sd.LISTEN_COMPLETE)throw ah("Unknown operation type: "+i.type);o=function(t,e,i,s,r){const n=e.serverCache,o=fd(e,n.getNode(),n.isFullyInitialized()||Jc(i),n.isFiltered());return Yd(t,o,i,s,Vd,r)}(t,e,i.path,s,n)}const h=n.getChanges();return function(t,e,i){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),n=md(t);(i.length>0||!t.eventCache.isFullyInitialized()||r&&!s.getNode().equals(n)||!s.getNode().getPriority().equals(n.getPriority()))&&i.push(Uu(md(e)))}}(e,o,h),{viewCache:o,changes:h}}function Yd(t,e,i,s,r,n){const o=e.eventCache;if(null!=Ud(s,i))return e;{let a,h;if(Jc(i))if(oh(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const i=_d(e),r=Ld(s,i instanceof Nu?i:Nu.EMPTY_NODE);a=t.filter.updateFullNode(e.eventCache.getNode(),r,n)}else{const i=Fd(s,_d(e));a=t.filter.updateFullNode(e.eventCache.getNode(),i,n)}else{const l=Xc(i);if(".priority"===l){oh(1===$c(i),"Can't have a priority with additional path components");const r=o.getNode();h=e.serverCache.getNode();const n=Bd(s,i,r,h);a=null!=n?t.filter.updatePriority(r,n):o.getNode()}else{const c=Yc(i);let u;if(o.isCompleteForChild(l)){h=e.serverCache.getNode();const t=Bd(s,i,o.getNode(),h);u=null!=t?o.getNode().getImmediateChild(l).updateChild(c,t):o.getNode().getImmediateChild(l)}else u=Hd(s,l,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),l,u,c,r,n):o.getNode()}}return pd(e,a,o.isFullyInitialized()||Jc(i),t.filter.filtersNodes())}}function qd(t,e,i,s,r,n,o,a){const h=e.serverCache;let l;const c=o?t.filter:t.filter.getIndexedFilter();if(Jc(i))l=c.updateFullNode(h.getNode(),s,null);else if(c.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(i,s);l=c.updateFullNode(h.getNode(),t,null)}else{const t=Xc(i);if(!h.isCompleteForPath(i)&&$c(i)>1)return e;const r=Yc(i),n=h.getNode().getImmediateChild(t).updateChild(r,s);l=".priority"===t?c.updatePriority(h.getNode(),n):c.updateChild(h.getNode(),t,n,r,Vd,null)}const u=fd(e,l,h.isFullyInitialized()||Jc(i),c.filtersNodes());return Yd(t,u,i,r,new Xd(r,u,n),a)}function Kd(t,e,i,s,r,n,o){const a=e.eventCache;let h,l;const c=new Xd(r,e,n);if(Jc(i))l=t.filter.updateFullNode(e.eventCache.getNode(),s,o),h=pd(e,l,!0,t.filter.filtersNodes());else{const r=Xc(i);if(".priority"===r)l=t.filter.updatePriority(e.eventCache.getNode(),s),h=pd(e,l,a.isFullyInitialized(),a.isFiltered());else{const n=Yc(i),l=a.getNode().getImmediateChild(r);let u;if(Jc(n))u=s;else{const t=c.getCompleteChild(r);u=null!=t?".priority"===qc(n)&&t.getChild(Qc(n)).isEmpty()?t:t.updateChild(n,s):Nu.EMPTY_NODE}if(l.equals(u))h=e;else{h=pd(e,t.filter.updateChild(a.getNode(),r,u,n,c,o),a.isFullyInitialized(),t.filter.filtersNodes())}}}return h}function Qd(t,e){return t.eventCache.isCompleteForChild(e)}function Zd(t,e,i){return i.foreach(((t,i)=>{e=e.updateChild(t,i)})),e}function Jd(t,e,i,s,r,n,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,l=e;h=Jc(i)?s:new yd(null).setTree(i,s);const c=e.serverCache.getNode();return h.children.inorderTraversal(((i,s)=>{if(c.hasChild(i)){const h=Zd(0,e.serverCache.getNode().getImmediateChild(i),s);l=qd(t,l,new zc(i),h,r,n,o,a)}})),h.children.inorderTraversal(((i,s)=>{const h=!e.serverCache.isCompleteForChild(i)&&null===s.value;if(!c.hasChild(i)&&!h){const h=Zd(0,e.serverCache.getNode().getImmediateChild(i),s);l=qd(t,l,new zc(i),h,r,n,o,a)}})),l}class tp{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Wu(i.getIndex()),r=(n=i).loadsAllData()?new Wu(n.getIndex()):n.hasLimit()?new Vu(n):new zu(n);var n;this.processor_=function(t){return{filter:t}}(r);const o=e.serverCache,a=e.eventCache,h=s.updateFullNode(Nu.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(Nu.EMPTY_NODE,a.getNode(),null),c=new ld(h,o.isFullyInitialized(),s.filtersNodes()),u=new ld(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=dd(u,c),this.eventGenerator_=new cd(this.query_)}get query(){return this.query_}}function ep(t,e){const i=_d(t.viewCache_);return i&&(t.query._queryParams.loadsAllData()||!Jc(e)&&!i.getImmediateChild(Xc(e)).isEmpty())?i.getChild(e):null}function ip(t){return 0===t.eventRegistrations_.length}function sp(t,e,i){const s=[];if(i){oh(null==e,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach((t=>{const e=t.createCancelEvent(i,r);e&&s.push(e)}))}if(e){let i=[];for(let s=0;s<t.eventRegistrations_.length;++s){const r=t.eventRegistrations_[s];if(r.matches(e)){if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(s+1));break}}else i.push(r)}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function rp(t,e,i,s){e.type===sd.MERGE&&null!==e.source.queryId&&(oh(_d(t.viewCache_),"We should always have a full cache before handling merges"),oh(md(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,n=$d(t.processor_,r,e,i,s);var o,a;return o=t.processor_,a=n.viewCache,oh(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),oh(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),oh(n.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=n.viewCache,np(t,n.changes,n.viewCache.eventCache.getNode(),null)}function np(t,e,i,s){const r=s?[s]:t.eventRegistrations_;return function(t,e,i,s){const r=[],n=[];return e.forEach((e=>{var i;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&n.push((i=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:i}))})),ud(t,r,"child_removed",e,s,i),ud(t,r,"child_added",e,s,i),ud(t,r,"child_moved",n,s,i),ud(t,r,"child_changed",e,s,i),ud(t,r,"value",e,s,i),r}(t.eventGenerator_,e,i,r)}let op,ap;class hp{constructor(){this.views=new Map}}function lp(t,e,i,s){const r=e.source.queryId;if(null!==r){const n=t.views.get(r);return oh(null!=n,"SyncTree gave us an op for an invalid query."),rp(n,e,i,s)}{let r=[];for(const n of t.views.values())r=r.concat(rp(n,e,i,s));return r}}function cp(t,e,i,s,r){const n=e._queryIdentifier,o=t.views.get(n);if(!o){let t=Fd(i,r?s:null),n=!1;t?n=!0:s instanceof Nu?(t=Ld(i,s),n=!1):(t=Nu.EMPTY_NODE,n=!1);const o=dd(new ld(t,n,!1),new ld(s,r,!1));return new tp(e,o)}return o}function up(t,e,i,s,r,n){const o=cp(t,e,s,r,n);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),function(t,e){t.eventRegistrations_.push(e)}(o,i),function(t,e){const i=t.viewCache_.eventCache,s=[];i.getNode().isLeafNode()||i.getNode().forEachChild(Cu,((t,e)=>{s.push(Gu(t,e))}));return i.isFullyInitialized()&&s.push(Uu(i.getNode())),np(t,s,i.getNode(),e)}(o,i)}function dp(t,e,i,s){const r=e._queryIdentifier,n=[];let o=[];const a=gp(t);if("default"===r)for(const[e,r]of t.views.entries())o=o.concat(sp(r,i,s)),ip(r)&&(t.views.delete(e),r.query._queryParams.loadsAllData()||n.push(r.query));else{const e=t.views.get(r);e&&(o=o.concat(sp(e,i,s)),ip(e)&&(t.views.delete(r),e.query._queryParams.loadsAllData()||n.push(e.query)))}return a&&!gp(t)&&n.push(new(oh(op,"Reference.ts has not been loaded"),op)(e._repo,e._path)),{removed:n,events:o}}function pp(t){const e=[];for(const i of t.views.values())i.query._queryParams.loadsAllData()||e.push(i);return e}function fp(t,e){let i=null;for(const s of t.views.values())i=i||ep(s,e);return i}function mp(t,e){if(e._queryParams.loadsAllData())return yp(t);{const i=e._queryIdentifier;return t.views.get(i)}}function _p(t,e){return null!=mp(t,e)}function gp(t){return null!=yp(t)}function yp(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let vp=1;class xp{constructor(t){this.listenProvider_=t,this.syncPointTree_=new yd(null),this.pendingWriteTree_={visibleWrites:vd.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function bp(t,e,i,s,r){return function(t,e,i,s,r){oh(s>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),t.allWrites.push({path:e,snap:i,writeId:s,visible:r}),r&&(t.visibleWrites=xd(t.visibleWrites,e,i)),t.lastWriteId=s}(t.pendingWriteTree_,e,i,s,r),r?Ip(t,new ad({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,i)):[]}function Ep(t,e,i=!1){const s=function(t,e){for(let i=0;i<t.allWrites.length;i++){const s=t.allWrites[i];if(s.writeId===e)return s}return null}(t.pendingWriteTree_,e);if(Md(t.pendingWriteTree_,e)){let e=new yd(null);return null!=s.snap?e=e.set(Vc(),!0):pc(s.children,(t=>{e=e.set(new zc(t),!0)})),Ip(t,new nd(s.path,e,i))}return[]}function wp(t,e,i){return Ip(t,new ad({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}function Tp(t,e,i,s,r=!1){const n=e._path,o=t.syncPointTree_.get(n);let a=[];if(o&&("default"===e._queryIdentifier||_p(o,e))){const h=dp(o,e,i,s);0===o.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(n));const l=h.removed;if(a=h.events,!r){const i=-1!==l.findIndex((t=>t._queryParams.loadsAllData())),r=t.syncPointTree_.findOnPath(n,((t,e)=>gp(e)));if(i&&!r){const e=t.syncPointTree_.subtree(n);if(!e.isEmpty()){const i=function(t){return t.fold(((t,e,i)=>{if(e&&gp(e)){return[yp(e)]}{let t=[];return e&&(t=pp(e)),pc(i,((e,i)=>{t=t.concat(i)})),t}}))}(e);for(let e=0;e<i.length;++e){const s=i[e],r=s.query,n=Mp(t,s);t.listenProvider_.startListening(Lp(r),Dp(t,r),n.hashFn,n.onComplete)}}}if(!r&&l.length>0&&!s)if(i){const i=null;t.listenProvider_.stopListening(Lp(e),i)}else l.forEach((e=>{const i=t.queryToTagMap.get(kp(e));t.listenProvider_.stopListening(Lp(e),i)}))}!function(t,e){for(let i=0;i<e.length;++i){const s=e[i];if(!s._queryParams.loadsAllData()){const e=kp(s),i=t.queryToTagMap.get(e);t.queryToTagMap.delete(e),t.tagToQueryMap.delete(i)}}}(t,l)}return a}function Sp(t,e,i,s){const r=Np(t,s);if(null!=r){const s=Op(r),n=s.path,o=s.queryId,a=tu(n,e);return Fp(t,n,new ad(rd(o),a,i))}return[]}function Cp(t,e,i,s=!1){const r=e._path;let n=null,o=!1;t.syncPointTree_.foreachOnPath(r,((t,e)=>{const i=tu(t,r);n=n||fp(e,i),o=o||gp(e)}));let a,h=t.syncPointTree_.get(r);if(h?(o=o||gp(h),n=n||fp(h,Vc())):(h=new hp,t.syncPointTree_=t.syncPointTree_.set(r,h)),null!=n)a=!0;else{a=!1,n=Nu.EMPTY_NODE;t.syncPointTree_.subtree(r).foreachChild(((t,e)=>{const i=fp(e,Vc());i&&(n=n.updateImmediateChild(t,i))}))}const l=_p(h,e);if(!l&&!e._queryParams.loadsAllData()){const i=kp(e);oh(!t.queryToTagMap.has(i),"View does not exist, but we have a tag");const s=vp++;t.queryToTagMap.set(i,s),t.tagToQueryMap.set(s,i)}let c=up(h,e,i,Rd(t.pendingWriteTree_,r),n,a);if(!l&&!o&&!s){const i=mp(h,e);c=c.concat(function(t,e,i){const s=e._path,r=Dp(t,e),n=Mp(t,i),o=t.listenProvider_.startListening(Lp(e),r,n.hashFn,n.onComplete),a=t.syncPointTree_.subtree(s);if(r)oh(!gp(a.value),"If we're adding a query, it shouldn't be shadowed");else{const e=a.fold(((t,e,i)=>{if(!Jc(t)&&e&&gp(e))return[yp(e).query];{let t=[];return e&&(t=t.concat(pp(e).map((t=>t.query)))),pc(i,((e,i)=>{t=t.concat(i)})),t}}));for(let i=0;i<e.length;++i){const s=e[i];t.listenProvider_.stopListening(Lp(s),Dp(t,s))}}return o}(t,e,i))}return c}function Ap(t,e,i){const s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,((t,i)=>{const s=fp(i,tu(t,e));if(s)return s}));return Od(s,e,r,i,!0)}function Ip(t,e){return Pp(e,t.syncPointTree_,null,Rd(t.pendingWriteTree_,Vc()))}function Pp(t,e,i,s){if(Jc(t.path))return Rp(t,e,i,s);{const r=e.get(Vc());null==i&&null!=r&&(i=fp(r,Vc()));let n=[];const o=Xc(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=i?i.getImmediateChild(o):null,e=jd(s,o);n=n.concat(Pp(a,h,t,e))}return r&&(n=n.concat(lp(r,t,s,i))),n}}function Rp(t,e,i,s){const r=e.get(Vc());null==i&&null!=r&&(i=fp(r,Vc()));let n=[];return e.children.inorderTraversal(((e,r)=>{const o=i?i.getImmediateChild(e):null,a=jd(s,e),h=t.operationForChild(e);h&&(n=n.concat(Rp(h,r,o,a)))})),r&&(n=n.concat(lp(r,t,s,i))),n}function Mp(t,e){const i=e.query,s=Dp(t,i);return{hashFn:()=>{const t=function(t){return t.viewCache_.serverCache.getNode()}(e)||Nu.EMPTY_NODE;return t.hash()},onComplete:e=>{if("ok"===e)return s?function(t,e,i){const s=Np(t,i);if(s){const i=Op(s),r=i.path,n=i.queryId,o=tu(r,e);return Fp(t,r,new od(rd(n),o))}return[]}(t,i._path,s):function(t,e){return Ip(t,new od({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(t,i._path);{const s=function(t,e){let i="Unknown Error";"too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+i);return s.code=t.toUpperCase(),s}(e,i);return Tp(t,i,null,s)}}}}function Dp(t,e){const i=kp(e);return t.queryToTagMap.get(i)}function kp(t){return t._path.toString()+"$"+t._queryIdentifier}function Np(t,e){return t.tagToQueryMap.get(e)}function Op(t){const e=t.indexOf("$");return oh(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new zc(t.substr(0,e))}}function Fp(t,e,i){const s=t.syncPointTree_.get(e);oh(s,"Missing sync point for query tag that we're tracking");return lp(s,i,Rd(t.pendingWriteTree_,e),null)}function Lp(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(oh(ap,"Reference.ts has not been loaded"),ap)(t._repo,t._path):t}class Bp{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Bp(e)}node(){return this.node_}}class Up{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Zc(this.path_,t);return new Up(this.syncTree_,e)}node(){return Ap(this.syncTree_,this.path_)}}const Gp=function(t,e,i){return t&&"object"==typeof t?(oh(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?Hp(t[".sv"],e,i):"object"==typeof t[".sv"]?jp(t[".sv"],e):void oh(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Hp=function(t,e,i){if("timestamp"===t)return i.timestamp;oh(!1,"Unexpected server value: "+t)},jp=function(t,e,i){t.hasOwnProperty("increment")||oh(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;"number"!=typeof s&&oh(!1,"Unexpected increment value: "+s);const r=e.node();if(oh(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const n=r.getValue();return"number"!=typeof n?s:n+s},Wp=function(t,e,i,s){return Vp(e,new Up(i,t),s)},zp=function(t,e,i){return Vp(t,new Bp(e),i)};function Vp(t,e,i){const s=t.getPriority().val(),r=Gp(s,e.getImmediateChild(".priority"),i);let n;if(t.isLeafNode()){const s=t,n=Gp(s.getValue(),e,i);return n!==s.getValue()||r!==s.getPriority().val()?new Su(n,Fu(r)):t}{const s=t;return n=s,r!==s.getPriority().val()&&(n=n.updatePriority(new Su(r))),s.forEachChild(Cu,((t,s)=>{const r=Vp(s,e.getImmediateChild(t),i);r!==s&&(n=n.updateImmediateChild(t,r))})),n}}class Xp{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function $p(t,e){let i=e instanceof zc?e:new zc(e),s=t,r=Xc(i);for(;null!==r;){const t=Mh(s.node.children,r)||{children:{},childCount:0};s=new Xp(r,s,t),i=Yc(i),r=Xc(i)}return s}function Yp(t){return t.node.value}function qp(t,e){t.node.value=e,tf(t)}function Kp(t){return t.node.childCount>0}function Qp(t,e){pc(t.node.children,((i,s)=>{e(new Xp(i,t,s))}))}function Zp(t,e,i,s){i&&!s&&e(t),Qp(t,(t=>{Zp(t,e,!0,s)})),i&&s&&e(t)}function Jp(t){return new zc(null===t.parent?t.name:Jp(t.parent)+"/"+t.name)}function tf(t){null!==t.parent&&function(t,e,i){const s=function(t){return void 0===Yp(t)&&!Kp(t)}(i),r=Rh(t.node.children,e);s&&r?(delete t.node.children[e],t.node.childCount--,tf(t)):s||r||(t.node.children[e]=i.node,t.node.childCount++,tf(t))}(t.parent,t.name,t)}const ef=/[\[\].#$\/\u0000-\u001F\u007F]/,sf=/[\[\].#$\u0000-\u001F\u007F]/,rf=10485760,nf=function(t){return"string"==typeof t&&0!==t.length&&!ef.test(t)},of=function(t){return"string"==typeof t&&0!==t.length&&!sf.test(t)},af=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!nc(t)||t&&"object"==typeof t&&Rh(t,".sv")},hf=function(t,e,i,s){s&&void 0===e||lf(Lh(t,"value"),e,i)},lf=function(t,e,i){const s=i instanceof zc?new su(i,t):i;if(void 0===e)throw new Error(t+"contains undefined "+nu(s));if("function"==typeof e)throw new Error(t+"contains a function "+nu(s)+" with contents = "+e.toString());if(nc(e))throw new Error(t+"contains "+e.toString()+" "+nu(s));if("string"==typeof e&&e.length>rf/3&&Bh(e)>rf)throw new Error(t+"contains a string greater than "+rf+" utf8 bytes "+nu(s)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,r=!1;if(pc(e,((e,n)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(r=!0,!nf(e)))throw new Error(t+" contains an invalid key ("+e+") "+nu(s)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Bh(e),ru(t)}(s,e),lf(t,n,s),function(t){const e=t.parts_.pop();t.byteLength_-=Bh(e),t.parts_.length>0&&(t.byteLength_-=1)}(s)})),i&&r)throw new Error(t+' contains ".value" child '+nu(s)+" in addition to actual children.")}},cf=function(t,e,i,s){if(!(s&&void 0===i||of(i)))throw new Error(Lh(t,e)+'was an invalid path = "'+i+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},uf=function(t,e){if(".info"===Xc(e))throw new Error(t+" failed = Can't modify data under /.info/")},df=function(t,e){const i=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!nf(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==i.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),of(t)}(i))throw new Error(Lh(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class pf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ff(t,e){let i=null;for(let s=0;s<e.length;s++){const r=e[s],n=r.getPath();null===i||eu(n,i.path)||(t.eventLists_.push(i),i=null),null===i&&(i={events:[],path:n}),i.events.push(r)}i&&t.eventLists_.push(i)}function mf(t,e,i){ff(t,i),gf(t,(t=>eu(t,e)))}function _f(t,e,i){ff(t,i),gf(t,(t=>iu(t,e)||iu(e,t)))}function gf(t,e){t.recursionDepth_++;let i=!0;for(let s=0;s<t.eventLists_.length;s++){const r=t.eventLists_[s];if(r){e(r.path)?(yf(t.eventLists_[s]),t.eventLists_[s]=null):i=!1}}i&&(t.eventLists_=[]),t.recursionDepth_--}function yf(t){for(let e=0;e<t.events.length;e++){const i=t.events[e];if(null!==i){t.events[e]=null;const s=i.getEventRunner();Ql&&tc("event: "+i.toString()),gc(s)}}}const vf="repo_interrupt";class xf{constructor(t,e,i,s){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Zu(),this.transactionQueueTree_=new Xp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function bf(t,e,i){if(t.stats_=Dc(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Ku(t.repoInfo_,((e,i,s,r)=>{Tf(t,e,i,s,r)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>Sf(t,!0)),0);else{if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ih(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}t.persistentConnection_=new hu(t.repoInfo_,e,((e,i,s,r)=>{Tf(t,e,i,s,r)}),(e=>{Sf(t,e)}),(e=>{!function(t,e){pc(e,((e,i)=>{Cf(t,e,i)}))}(t,e)}),t.authTokenProvider_,t.appCheckProvider_,i),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=function(t,e){const i=t.toString();return Mc[i]||(Mc[i]=e()),Mc[i]}(t.repoInfo_,(()=>new id(t.stats_,t.server_))),t.infoData_=new Qu,t.infoSyncTree_=new xp({startListening:(e,i,s,r)=>{let n=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(n=wp(t.infoSyncTree_,e._path,o),setTimeout((()=>{r("ok")}),0)),n},stopListening:()=>{}}),Cf(t,"connected",!1),t.serverSyncTree_=new xp({startListening:(e,i,s,r)=>(t.server_.listen(e,s,i,((i,s)=>{const n=r(i,s);_f(t.eventQueue_,e._path,n)})),[]),stopListening:(e,i)=>{t.server_.unlisten(e,i)}})}function Ef(t){const e=t.infoData_.getNode(new zc(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function wf(t){return(e=(e={timestamp:Ef(t)})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e}function Tf(t,e,i,s,r){t.dataUpdateCount++;const n=new zc(e);i=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,i):i;let o=[];if(r)if(s){const e=kh(i,(t=>Fu(t)));o=function(t,e,i,s){const r=Np(t,s);if(r){const s=Op(r),n=s.path,o=s.queryId,a=tu(n,e),h=yd.fromObject(i);return Fp(t,n,new hd(rd(o),a,h))}return[]}(t.serverSyncTree_,n,e,r)}else{const e=Fu(i);o=Sp(t.serverSyncTree_,n,e,r)}else if(s){const e=kh(i,(t=>Fu(t)));o=function(t,e,i){const s=yd.fromObject(i);return Ip(t,new hd({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,s))}(t.serverSyncTree_,n,e)}else{const e=Fu(i);o=wp(t.serverSyncTree_,n,e)}let a=n;o.length>0&&(a=Of(t,n)),_f(t.eventQueue_,a,o)}function Sf(t,e){Cf(t,"connected",e),!1===e&&function(t){Mf(t,"onDisconnectEvents");const e=wf(t),i=Zu();td(t.onDisconnect_,Vc(),((s,r)=>{const n=Wp(s,r,t.serverSyncTree_,e);Ju(i,s,n)}));let s=[];td(i,Vc(),((e,i)=>{s=s.concat(wp(t.serverSyncTree_,e,i));const r=Gf(t,e);Of(t,r)})),t.onDisconnect_=Zu(),_f(t.eventQueue_,Vc(),s)}(t)}function Cf(t,e,i){const s=new zc("/.info/"+e),r=Fu(i);t.infoData_.updateSnapshot(s,r);const n=wp(t.infoSyncTree_,s,r);_f(t.eventQueue_,s,n)}function Af(t){return t.nextWriteId_++}function If(t,e,i,s,r){Mf(t,"set",{path:e.toString(),value:i,priority:s});const n=wf(t),o=Fu(i,s),a=Ap(t.serverSyncTree_,e),h=zp(o,a,n),l=Af(t),c=bp(t.serverSyncTree_,e,h,l,!0);ff(t.eventQueue_,c),t.server_.put(e.toString(),o.val(!0),((i,s)=>{const n="ok"===i;n||rc("set at "+e+" failed: "+i);const o=Ep(t.serverSyncTree_,l,!n);_f(t.eventQueue_,e,o),Df(t,r,i,s)}));const u=Gf(t,e);Of(t,u),_f(t.eventQueue_,u,[])}function Pf(t,e,i){let s;s=".info"===Xc(e._path)?Tp(t.infoSyncTree_,e,i):Tp(t.serverSyncTree_,e,i),mf(t.eventQueue_,e._path,s)}function Rf(t){t.persistentConnection_&&t.persistentConnection_.interrupt(vf)}function Mf(t,...e){let i="";t.persistentConnection_&&(i=t.persistentConnection_.id+":"),tc(i,...e)}function Df(t,e,i,s){e&&gc((()=>{if("ok"===i)e(null);else{const t=(i||"error").toUpperCase();let r=t;s&&(r+=": "+s);const n=new Error(r);n.code=t,e(n)}}))}function kf(t,e,i){return Ap(t.serverSyncTree_,e,i)||Nu.EMPTY_NODE}function Nf(t,e=t.transactionQueueTree_){if(e||Uf(t,e),Yp(e)){const i=Lf(t,e);oh(i.length>0,"Sending zero length transaction queue");i.every((t=>0===t.status))&&function(t,e,i){const s=i.map((t=>t.currentWriteId)),r=kf(t,e,s);let n=r;const o=r.hash();for(let t=0;t<i.length;t++){const s=i[t];oh(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=tu(e,s.path);n=n.updateChild(r,s.currentOutputSnapshotRaw)}const a=n.val(!0),h=e;t.server_.put(h.toString(),a,(s=>{Mf(t,"transaction put response",{path:h.toString(),status:s});let r=[];if("ok"===s){const s=[];for(let e=0;e<i.length;e++)i[e].status=2,r=r.concat(Ep(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&s.push((()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved))),i[e].unwatcher();Uf(t,$p(t.transactionQueueTree_,e)),Nf(t,t.transactionQueueTree_),_f(t.eventQueue_,e,r);for(let t=0;t<s.length;t++)gc(s[t])}else{if("datastale"===s)for(let t=0;t<i.length;t++)3===i[t].status?i[t].status=4:i[t].status=0;else{rc("transaction at "+h.toString()+" failed: "+s);for(let t=0;t<i.length;t++)i[t].status=4,i[t].abortReason=s}Of(t,e)}}),o)}(t,Jp(e),i)}else Kp(e)&&Qp(e,(e=>{Nf(t,e)}))}function Of(t,e){const i=Ff(t,e),s=Jp(i);return function(t,e,i){if(0===e.length)return;const s=[];let r=[];const n=e.filter((t=>0===t.status)),o=n.map((t=>t.currentWriteId));for(let n=0;n<e.length;n++){const h=e[n],l=tu(i,h.path);let c,u=!1;if(oh(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)u=!0,c=h.abortReason,r=r.concat(Ep(t.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)u=!0,c="maxretry",r=r.concat(Ep(t.serverSyncTree_,h.currentWriteId,!0));else{const i=kf(t,h.path,o);h.currentInputSnapshot=i;const s=e[n].update(i.val());if(void 0!==s){lf("transaction failed: Data returned ",s,h.path);let e=Fu(s);"object"==typeof s&&null!=s&&Rh(s,".priority")||(e=e.updatePriority(i.getPriority()));const n=h.currentWriteId,a=wf(t),l=zp(e,i,a);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=l,h.currentWriteId=Af(t),o.splice(o.indexOf(n),1),r=r.concat(bp(t.serverSyncTree_,h.path,l,h.currentWriteId,h.applyLocally)),r=r.concat(Ep(t.serverSyncTree_,n,!0))}else u=!0,c="nodata",r=r.concat(Ep(t.serverSyncTree_,h.currentWriteId,!0))}_f(t.eventQueue_,i,r),r=[],u&&(e[n].status=2,a=e[n].unwatcher,setTimeout(a,Math.floor(0)),e[n].onComplete&&("nodata"===c?s.push((()=>e[n].onComplete(null,!1,e[n].currentInputSnapshot))):s.push((()=>e[n].onComplete(new Error(c),!1,null)))))}var a;Uf(t,t.transactionQueueTree_);for(let t=0;t<s.length;t++)gc(s[t]);Nf(t,t.transactionQueueTree_)}(t,Lf(t,i),s),s}function Ff(t,e){let i,s=t.transactionQueueTree_;for(i=Xc(e);null!==i&&void 0===Yp(s);)s=$p(s,i),i=Xc(e=Yc(e));return s}function Lf(t,e){const i=[];return Bf(t,e,i),i.sort(((t,e)=>t.order-e.order)),i}function Bf(t,e,i){const s=Yp(e);if(s)for(let t=0;t<s.length;t++)i.push(s[t]);Qp(e,(e=>{Bf(t,e,i)}))}function Uf(t,e){const i=Yp(e);if(i){let t=0;for(let e=0;e<i.length;e++)2!==i[e].status&&(i[t]=i[e],t++);i.length=t,qp(e,i.length>0?i:void 0)}Qp(e,(e=>{Uf(t,e)}))}function Gf(t,e){const i=Jp(Ff(t,e)),s=$p(t.transactionQueueTree_,e);return function(t,e,i){let s=i?t:t.parent;for(;null!==s;){if(e(s))return!0;s=s.parent}}(s,(e=>{Hf(t,e)})),Hf(t,s),Zp(s,(e=>{Hf(t,e)})),i}function Hf(t,e){const i=Yp(e);if(i){const s=[];let r=[],n=-1;for(let e=0;e<i.length;e++)3===i[e].status||(1===i[e].status?(oh(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(oh(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),r=r.concat(Ep(t.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?qp(e,void 0):i.length=n+1,_f(t.eventQueue_,Jp(e),r);for(let t=0;t<s.length;t++)gc(s[t])}}const jf=function(t,e){const i=Wf(t),s=i.namespace;"firebase.com"===i.domain&&sc(i.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),s&&"undefined"!==s||"localhost"===i.domain||sc("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),i.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&rc("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===i.scheme||"wss"===i.scheme;return{repoInfo:new Ac(i.host,i.secure,s,r,e,"",s!==i.subdomain),path:new zc(i.pathString)}},Wf=function(t){let e="",i="",s="",r="",n="",o=!0,a="https",h=443;if("string"==typeof t){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let c=t.indexOf("/");-1===c&&(c=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(c,u)),c<u&&(r=function(t){let e="";const i=t.split("/");for(let t=0;t<i.length;t++)if(i[t].length>0){let s=i[t];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch(t){}e+="/"+s}return e}(t.substring(c,u)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const i of t.split("&")){if(0===i.length)continue;const s=i.split("=");2===s.length?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):rc(`Invalid query segment '${i}' in query '${t}'`)}return e}(t.substring(Math.min(t.length,u)));l=e.indexOf(":"),l>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(l+1),10)):l=e.length;const p=e.slice(0,l);if("localhost"===p.toLowerCase())i="localhost";else if(p.split(".").length<=2)i=p;else{const t=e.indexOf(".");s=e.substring(0,t).toLowerCase(),i=e.substring(t+1),n=s}"ns"in d&&(n=d.ns)}return{host:e,port:h,domain:i,subdomain:s,secure:o,scheme:a,pathString:r,namespace:n}},zf="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Vf=function(){let t=0;const e=[];return function(i){const s=i===t;let r;t=i;const n=new Array(8);for(r=7;r>=0;r--)n[r]=zf.charAt(i%64),i=Math.floor(i/64);oh(0===i,"Cannot push at time == 0");let o=n.join("");if(s){for(r=11;r>=0&&63===e[r];r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)o+=zf.charAt(e[r]);return oh(20===o.length,"nextPushId: Length should be 20."),o}}();class Xf{constructor(t,e,i,s){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=s}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ih(this.snapshot.exportVal())}}class $f{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Yf{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return oh(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class qf{constructor(t,e,i,s){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=s}get key(){return Jc(this._path)?null:qc(this._path)}get ref(){return new Zf(this._repo,this._path)}get _queryIdentifier(){const t=qu(this._queryParams),e=uc(t);return"{}"===e?"default":e}get _queryObject(){return qu(this._queryParams)}isEqual(t){if(!((t=Uh(t))instanceof qf))return!1;const e=this._repo===t._repo,i=eu(this._path,t._path),s=this._queryIdentifier===t._queryIdentifier;return e&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let i=t.pieceNum_;i<t.pieces_.length;i++)""!==t.pieces_[i]&&(e+="/"+encodeURIComponent(String(t.pieces_[i])));return e||"/"}(this._path)}}function Kf(t,e){if(!0===t._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function Qf(t){let e=null,i=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(i=t.getIndexEndValue()),t.getIndex()===pu){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==oc)throw new Error(s);if("string"!=typeof e)throw new Error(r)}if(t.hasEnd()){if(t.getIndexEndName()!==ac)throw new Error(s);if("string"!=typeof i)throw new Error(r)}}else if(t.getIndex()===Cu){if(null!=e&&!af(e)||null!=i&&!af(i))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(oh(t.getIndex()instanceof Lu||t.getIndex()===Bu,"unknown index type."),null!=e&&"object"==typeof e||null!=i&&"object"==typeof i)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}class Zf extends qf{constructor(t,e){super(t,e,new Xu,!1)}get parent(){const t=Qc(this._path);return null===t?null:new Zf(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Jf{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new zc(t),i=em(this.ref,t);return new Jf(this._node.getChild(e),i,Cu)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((e,i)=>t(new Jf(i,em(this.ref,e),Cu))))}hasChild(t){const e=new zc(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function tm(t,e){return(t=Uh(t))._checkNotDeleted("ref"),void 0!==e?em(t._root,e):t._root}function em(t,e){var i,s,r,n;return null===Xc((t=Uh(t))._path)?(i="child",s="path",n=!1,(r=e)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),cf(i,s,r,n)):cf("child","path",e,!1),new Zf(t._repo,Zc(t._path,e))}function im(t,e){t=Uh(t),uf("set",t._path),hf("set",e,t._path,!1);const i=new xh;return If(t._repo,t._path,e,null,i.wrapCallback((()=>{}))),i.promise}class sm{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const i=e._queryParams.getIndex();return new Xf("value",this,new Jf(t.snapshotNode,new Zf(e._repo,e._path),i))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new $f(this,t,e):null}matches(t){return t instanceof sm&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class rm{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new $f(this,t,e):null}createEvent(t,e){oh(null!=t.childName,"Child events should have a childName.");const i=em(new Zf(e._repo,e._path),t.childName),s=e._queryParams.getIndex();return new Xf(t.type,this,new Jf(t.snapshotNode,i,s),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof rm&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function nm(t,e,i,s,r){let n;if("object"==typeof s&&(n=void 0,r=s),"function"==typeof s&&(n=s),r&&r.onlyOnce){const e=i,s=(i,s)=>{Pf(t._repo,t,a),e(i,s)};s.userCallback=i.userCallback,s.context=i.context,i=s}const o=new Yf(i,n||void 0),a="value"===e?new sm(o):new rm(e,o);return function(t,e,i){let s;s=".info"===Xc(e._path)?Cp(t.infoSyncTree_,e,i):Cp(t.serverSyncTree_,e,i),mf(t.eventQueue_,e._path,s)}(t._repo,t,a),()=>Pf(t._repo,t,a)}function om(t,e,i,s){return nm(t,"value",e,i,s)}class am{}class hm extends am{constructor(t){super(),this._path=t}_apply(t){Kf(t,"orderByChild");const e=new zc(this._path);if(Jc(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Lu(e),s=$u(t._queryParams,i);return Qf(s),new qf(t._repo,t._path,s,!0)}}!function(t){oh(!op,"__referenceConstructor has already been defined"),op=t}(Zf),function(t){oh(!ap,"__referenceConstructor has already been defined"),ap=t}(Zf);const lm={};let cm=!1;function um(t,e,i,s,r){let n=s||t.options.databaseURL;void 0===n&&(t.options.projectId||sc("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tc("Using default host for project ",t.options.projectId),n=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=jf(n,r),l=h.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,n=`http://${a}?ns=${l.namespace}`,h=jf(n,r),l=h.repoInfo):o=!h.repoInfo.secure;const c=r&&o?new bc(bc.OWNER):new xc(t.name,t.options,e);df("Invalid Firebase Database URL",h),Jc(h.path)||sc("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(t,e,i,s){let r=lm[e.name];r||(r={},lm[e.name]=r);let n=r[t.toURLString()];n&&sc("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return n=new xf(t,cm,i,s),r[t.toURLString()]=n,n}(l,t,c,new vc(t.name,i));return new dm(u,t)}class dm{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(bf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zf(this._repo,Vc())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(t,e){const i=lm[e];i&&i[t.key]===t||sc(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Rf(t),delete i[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&sc("Cannot call "+t+" on a deleted database.")}}function pm(t=function(t=gl){const e=vl.get(t);if(!e&&t===gl&&vh())return Cl();if(!e)throw Tl.create("no-app",{appName:t});return e}(),e){const i=wl(t,"database").getImmediate({identifier:e});if(!i._instanceStarted){const t=yh("database");t&&function(t,e,i,s={}){t=Uh(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&sc("Cannot call useEmulator() after instance has already been initialized.");const r=t._repoInternal;let n;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&sc('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),n=new bc(bc.OWNER);else if(s.mockUserToken){const e="string"==typeof s.mockUserToken?s.mockUserToken:function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const n=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[dh(JSON.stringify({alg:"none",type:"JWT"})),dh(JSON.stringify(n)),""].join(".")}(s.mockUserToken,t.app.options.projectId);n=new bc(e)}!function(t,e,i,s){t.repoInfo_=new Ac(`${e}:${i}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}(r,e,i,n)}(i,...t)}return i}hu.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},hu.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};!function(t){Hl("10.4.0"),El(new Gh("database",((t,{instanceIdentifier:e})=>um(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e)),"PUBLIC").setMultipleInstances(!0)),Al(Bl,Ul,t),Al(Bl,Ul,"esm2017")}();const fm=tm(pm(Cl({apiKey:"AIzaSyAck_HNSlAkOKZ25rFMuaXYemZmfeIumKg",authDomain:"spacewars-6a2e1.firebaseapp.com",databaseURL:"https://spacewars-6a2e1-default-rtdb.firebaseio.com",projectId:"spacewars-6a2e1",storageBucket:"spacewars-6a2e1.appspot.com",messagingSenderId:"816823497537",appId:"1:816823497537:web:f3fc6b2118c5ebbafde7c0"})),"puntajes");function mm(t,e){!function(t,e){t=Uh(t),uf("push",t._path),hf("push",e,t._path,!0);const i=Ef(t._repo),s=Vf(i),r=em(t,s),n=em(t,s);let o;o=null!=e?im(n,e).then((()=>n)):Promise.resolve(n),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0)}(fm,{nombre:t,puntaje:e})}var _m=i(242);class gm extends ir{constructor(t){super(),this.editing=!1,this.tick=0,this.activation=!1,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0,this.paddingLeft=0,this.options=t,this.padding=t.padding,this.cursor="text",this.interactive=!0,this.on("pointertap",(()=>{this.activation=!0,U.any&&this.handleActivation()})),U.any?window.addEventListener("touchstart",(()=>this.handleActivation())):U.any||(window.addEventListener("click",(()=>this.handleActivation())),window.addEventListener("keydown",(t=>{const e=t.key;"Backspace"===e?this._delete():"Escape"===e||"Enter"===e?this.stopEditing():1===e.length&&this._add(e)}))),this.onEnter=new _m.MZ,this.onChange=new _m.MZ,Ds.shared.add((t=>this.update(t))),t.bg&&(this.bg=t.bg)}init(){const t=this.options,e={fill:0,align:"center"};this.options.textStyle=t.textStyle??e;const i=new $o(t.textStyle??e);this.inputField=new Zo("",i),this._cursor=new nr(Ai.WHITE),this._cursor.tint=Number(t.textStyle.fill)||0,this._cursor.anchor.set(.5),this._cursor.width=2,this._cursor.height=.8*this.inputField.height,this._cursor.alpha=0,this.placeholder=new Zo(t.placeholder,i??e),this.placeholder.visible=!!t.placeholder,this.addChild(this.inputField,this.placeholder,this._cursor),this.value=t.value??"",this.align()}set bg(t){var e;this._bg="string"==typeof(e=t)?nr.from(e):e,this._bg.cursor="text",this._bg.interactive=!0,this._bg.parent||this.addChild(this._bg),this.inputField||this.init(),this.inputMask=(new Mo).beginFill(16777215).drawRect(this.paddingLeft,this.paddingTop,this._bg.width-this.paddingRight-this.paddingLeft,this._bg.height-this.paddingBottom-this.paddingTop),this.inputField.mask=this.inputMask,this._cursor.mask=this.inputMask,this.inputMask.parent||this.addChild(this.inputMask)}get bg(){return this._bg}_add(t){this.editing&&(this.options.maxLength&&this.value.length>=this.options.maxLength||(this.value=this.value+t,this.onChange.emit(this.value)))}_delete(){if(!this.editing||0===this.value.length)return;const t=this.value.split("");t.pop(),this.value=t.join(""),this.onChange.emit(this.value)}_startEditing(){this.tick=0,this.editing=!0,this.placeholder.visible=!1,this._cursor.alpha=1,U.any&&(this._keyboard=document.createElement("input"),document.body.appendChild(this._keyboard),this._keyboard.style.position="fixed",this._keyboard.style.left="-1000px",this._keyboard.oninput=()=>{let t=this._keyboard.value;const e=this.options.maxLength;e&&t.length>this.options.maxLength&&(t=t.substring(0,e),this._keyboard.value=t),this.value=t,this.onChange.emit(this.value)},this._keyboard.focus(),this._keyboard.click(),this._keyboard.value=this.value),this.align()}handleActivation(){this.stopEditing(),this.activation&&(this._startEditing(),this.activation=!1)}stopEditing(){this.editing&&(this._cursor.alpha=0,this.editing=!1,""===this.inputField.text&&(this.placeholder.visible=!0),0===this.value.length&&(this.placeholder.visible=!0),U.any&&(this._keyboard?.blur(),this._keyboard?.remove(),this._keyboard=null),this.align(),this.onEnter.emit(this.value))}update(t){this.editing&&(this.tick+=.1*t,this._cursor.alpha=Math.round(.5*Math.sin(this.tick)+.5))}align(){if(!this._bg)return;const t=this.getAlign();this.inputField.anchor.set(t,.5),this.inputField.x=this._bg.width*t+(1===t?-this.paddingRight:this.paddingLeft),this.inputField.y=this._bg.height/2+this.paddingTop-this.paddingBottom,this.placeholder.anchor.set(t,.5),this.placeholder.x=this._bg.width*t+(1===t?-this.paddingRight:this.paddingLeft),this.placeholder.y=this._bg.height/2,this._cursor.x=this.getCursorPosX(),this._cursor.y=this.inputField.y}getAlign(){const t=.95*this._bg.width,e=this.paddingLeft+this.paddingRight-10;if(this.inputField.width+e>t)return this.editing?1:0;switch(this.options.align){case"left":default:return 0;case"center":return.5;case"right":return 1}}getCursorPosX(){switch(this.getAlign()){case 0:return this.inputField.x+this.inputField.width;case.5:return this.inputField.x+.5*this.inputField.width;case 1:return this.inputField.x;default:return 0}}set value(t){this.inputField.text=t,0!==t.length?this.placeholder.visible=!1:this.placeholder.visible=!this.editing,this.align()}get value(){return this.inputField.text}set padding(t){"number"==typeof t&&(this.paddingTop=t,this.paddingRight=t,this.paddingBottom=t,this.paddingLeft=t),Array.isArray(t)?(this.paddingTop=t[0]??0,this.paddingRight=t[1]??t[0]??0,this.paddingBottom=t[2]??t[0]??0,this.paddingLeft=t[3]??t[1]??t[0]??0):"object"==typeof t&&(this.paddingTop=t.top??0,this.paddingRight=t.right??0,this.paddingBottom=t.bottom??0,this.paddingLeft=t.left??0)}get padding(){return[this.paddingTop,this.paddingRight,this.paddingBottom,this.paddingLeft]}}class ym extends ir{constructor(){super();const t=new Zo("G4M3\n0V3R",{fontFamily:"PressStart2P",fontSize:70,align:"center",fill:this.randomColor()});t.anchor.set(.5),t.position.set(Qa.width/2,480),this.addChild(t);const e=new Zo("YOUR SCORE IS\n\n"+String(Km.score.score),{fontFamily:"PressStart2P",fontSize:30,align:"center",fill:this.randomColor()});e.anchor.set(.5),e.position.set(Qa.width/2,660),this.addChild(e),this.buttonOk=nr.from("ok.png"),this.buttonOk.scale.set(6),this.buttonOk.anchor.set(.5),this.buttonOk.position.set(Qa.width/2+100,950),this.buttonOk.alpha=.3,this.buttonOk.on("pointerup",(()=>{mm(this.input.value,String(Km.score.score)),Qa.changeScene(new i_(!0))})),this.addChild(this.buttonOk);const i=nr.from("back.png");i.alpha=.8,i.scale.set(6),i.anchor.set(.5),i.position.set(Qa.width/2-100,950),i.eventMode="static",i.cursor="pointer",i.on("pointerup",(()=>{Qa.changeScene(new i_(!1))})),this.addChild(i),this.input=new gm({maxLength:15,placeholder:"ENTER YOUR NAME",align:"center",bg:(new Mo).beginFill(16777215,1e-4).lineStyle(3,16777215).drawRect(0,0,500,70),textStyle:{fill:16777215,fontSize:30,fontFamily:"PressStart2P"}}),this.input.position.set(Qa.width/2-this.input.width/2,770),this.input.onChange.connect((()=>{if(""==this.input.value)this.buttonOk.alpha=.3,this.buttonOk.eventMode="none",this.buttonOk.cursor="none";else{this.buttonOk.alpha=1,this.buttonOk.eventMode="static",this.buttonOk.cursor="pointer";const t=this.input.value.toUpperCase();this.input.value=t}})),this.input.onEnter.connect((()=>{void 0!==document.activeElement&&document.activeElement.blur()})),this.addChild(this.input)}randomColor(){const t=["0x0bffe6","0xffd080","0xff9e7d","0xfe546f","0xfffdff","0x01cbcf"];return t[Math.floor(Math.random()*t.length)]}}class vm extends ir{constructor(){super(),this.score=0,this.text=new Zo("SCORE 0",{fontFamily:"PressStart2P",fontSize:30,align:"center",fill:16777215}),this.text.anchor.set(.5),this.text.position.set(Qa.width/2,50),this.addChild(this.text)}}let xm;function bm(){return xm}let Em=0;const wm=class extends G{constructor(t){super(),this.id=Em++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return null}set filters(t){}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const i=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),r=this._volume*(this._muted?0:1);this._source.volume=r*i*s,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",i))}play(t){const{start:e,end:i,speed:s,loop:r,volume:n,muted:o}=t;this._speed=s,this._volume=n,this._loop=!!r,this._muted=o,this.refresh(),this.loop&&null!==i&&(this.loop=!1),this._start=e,this._end=i||this._duration,this._start=Math.max(0,this._start-wm.PADDING),this._end=Math.min(this._end+wm.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),Ds.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){Ds.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){Ds.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Tm=wm;Tm.PADDING=.1;class Sm extends G{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Tm(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,i=this.parent;if(4===e.readyState){i.isLoaded=!0;const e=i.autoPlayStart();return void(t&&setTimeout((()=>{t(null,i,e)}),0))}if(!i.url)return void t(new Error("sound.url or sound.source must be set"));e.src=i.url;const s=()=>{o(),i.isLoaded=!0;const e=i.autoPlayStart();t&&t(null,i,e)},r=()=>{o(),t&&t(new Error("Sound loading has been aborted"))},n=()=>{o();const i=`Failed to load audio element (code: ${e.error.code})`;t&&t(new Error(i))},o=()=>{e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",r),e.removeEventListener("error",n)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",r,!1),e.addEventListener("error",n,!1),e.load()}}class Cm{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const Am=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],Im=["audio/mpeg","audio/ogg"],Pm={};!function(t){const e={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...t||{}},i=document.createElement("audio"),s={},r=/^no$/;Am.forEach((t=>{const n=i.canPlayType(`audio/${t}`).replace(r,""),o=e[t]?i.canPlayType(e[t]).replace(r,""):"";s[t]=!!n||!!o})),Object.assign(Pm,s)}();class Rm{static setParamValue(t,e){if(t.setValueAtTime){const i=bm().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e}}let Mm=0;class Dm extends G{constructor(t){super(),this.id=Mm++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const i=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),r=this._volume*(this._muted?0:1);Rm.setParamValue(this._gain.gain,r*s*i),Rm.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))}play(t){const{start:e,end:i,speed:s,loop:r,volume:n,muted:o,filters:a}=t;this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=s,this._volume=n,this._loop=!!r,this._muted=o,this._filters=a,this.refresh();const c=this._source.buffer.duration;this._duration=c,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){Ds.shared.remove(this._updateListener,this),t&&Ds.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),i=e-this._lastUpdate;if(i>0||t){const t=this._source.playbackRate.value;this._elapsed+=i*t,this._lastUpdate=e;const s=this._duration;let r;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;r=(this._source.loopStart+this._elapsed%t)/s}else r=this._elapsed%s/s;this._progress=r,this.emit("progress",this._progress,s)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class km{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const Nm=class extends km{constructor(t){const e=t.audioContext,i=e.createBufferSource(),s=e.createGain(),r=e.createAnalyser();i.connect(r),r.connect(s),s.connect(t.destination),super(r,s),this.context=t,this.bufferSource=i,this.gain=s,this.analyser=r}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Nm.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,Rm.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const i=this.context.audioContext.createGain();return e.connect(i),i.connect(this.destination),{source:e,gain:i}}get bufferSize(){return this.script.bufferSize}};let Om=Nm;Om.BUFFER_SIZE=0;class Fm{init(t){this.parent=t,this._nodes=new Om(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){}this._source=null,this.source=null}create(){return new Dm(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))}async _loadUrl(t){const e=this.parent.url,i=await b.ADAPTER.fetch(e);this._decode(await i.arrayBuffer(),t)}_decode(t,e){const i=(t,i)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=i;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};if(t instanceof AudioBuffer)i(null,t);else{this.parent.context.decode(t,i)}}}const Lm=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:Array.isArray(t)?e.url=t:e=t,e={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...e},Object.freeze(e);const i=bm().useLegacy?new Sm:new Fm;return new Lm(i,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const i=e.complete;this._autoPlayOptions=i?{complete:i}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=Array.isArray(e.url)?this.preferUrl(e.url):e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}preferUrl(t){const[{url:e}]=t.map((t=>({url:t,ext:X.extname(t).slice(1)}))).sort(((t,e)=>Am.indexOf(t.ext)-Am.indexOf(e.ext)));return e}get context(){return bm().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const i in t)e[i]=this.addSprites(i,t[i]);return e}const i=new Cm(this,e);return this._sprites[t]=i,i}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const t in this._sprites)this.removeSprites(t);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let i;if("string"==typeof t){i={sprite:t,loop:this.loop,complete:e}}else"function"==typeof t?(i={},i.complete=t):i=t;if(i={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...i||{}},i.sprite){const t=i.sprite,e=this._sprites[t];i.start=e.start+(i.start||0),i.end=e.end,i.speed=e.speed||1,i.loop=e.loop||i.loop,delete i.sprite}if(i.offset&&(i.start=i.offset),!this.isLoaded)return this._preloadQueue?new Promise((t=>{this._preloadQueue.push((()=>{t(this.play(i))}))})):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=i,new Promise(((t,e)=>{this._preload(((s,r,n)=>{this._preloadQueue.forEach((t=>t())),this._preloadQueue=null,s?e(s):(i.loaded&&i.loaded(s,r,n),t(n))}))})));(this.singleInstance||i.singleInstance)&&this._removeInstances();const s=this._createInstance();return this._instances.push(s),this.isPlaying=!0,s.once("end",(()=>{i.complete&&i.complete(this),this._onComplete(s)})),s.once("stop",(()=>{this._onComplete(s)})),s.play(i),s}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(Lm._pool.length>0){const t=Lm._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),Lm._pool.indexOf(t)<0&&Lm._pool.push(t)}};let Bm=Lm;Bm._pool=[];class Um extends G{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return null}set filters(t){}get audioContext(){return null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class Gm extends km{constructor(){const t=window,e=new Gm.AudioContext,i=e.createDynamicsCompressor(),s=e.createAnalyser();s.connect(i),i.connect(e.destination),super(s,i),this.autoPause=!0,this._ctx=e,this._offlineCtx=new Gm.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=i,this.analyser=s,this.events=new G,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked="suspended"===e.state&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){const t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}onBlur(){!this._locked&&this.autoPause&&(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused())}_unlock(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;void 0!==t.close&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const i=t=>{e(new Error(t?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),i);s&&s.catch(i)}}class Hm{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source?.connect(t)}disconnect(){this.source?.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}}const jm=class extends Hm{constructor(t=0,e=0,i=0,s=0,r=0,n=0,o=0,a=0,h=0,l=0){let c=[];const u=[{f:jm.F32,type:"lowshelf",gain:t},{f:jm.F64,type:"peaking",gain:e},{f:jm.F125,type:"peaking",gain:i},{f:jm.F250,type:"peaking",gain:s},{f:jm.F500,type:"peaking",gain:r},{f:jm.F1K,type:"peaking",gain:n},{f:jm.F2K,type:"peaking",gain:o},{f:jm.F4K,type:"peaking",gain:a},{f:jm.F8K,type:"peaking",gain:h},{f:jm.F16K,type:"highshelf",gain:l}];bm().useLegacy||(c=u.map((t=>{const e=bm().context.audioContext.createBiquadFilter();return e.type=t.type,Rm.setParamValue(e.Q,1),e.frequency.value=t.f,Rm.setParamValue(e.gain,t.gain),e}))),super(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let t=0;t<this.bands.length;t++){const e=this.bands[t];t>0&&this.bands[t-1].connect(e),this.bandsMap[e.frequency.value]=e}}setGain(t,e=0){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);Rm.setParamValue(this.bandsMap[t].gain,e)}getGain(t){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);return this.bandsMap[t].gain.value}set f32(t){this.setGain(jm.F32,t)}get f32(){return this.getGain(jm.F32)}set f64(t){this.setGain(jm.F64,t)}get f64(){return this.getGain(jm.F64)}set f125(t){this.setGain(jm.F125,t)}get f125(){return this.getGain(jm.F125)}set f250(t){this.setGain(jm.F250,t)}get f250(){return this.getGain(jm.F250)}set f500(t){this.setGain(jm.F500,t)}get f500(){return this.getGain(jm.F500)}set f1k(t){this.setGain(jm.F1K,t)}get f1k(){return this.getGain(jm.F1K)}set f2k(t){this.setGain(jm.F2K,t)}get f2k(){return this.getGain(jm.F2K)}set f4k(t){this.setGain(jm.F4K,t)}get f4k(){return this.getGain(jm.F4K)}set f8k(t){this.setGain(jm.F8K,t)}get f8k(){return this.getGain(jm.F8K)}set f16k(t){this.setGain(jm.F16K,t)}get f16k(){return this.getGain(jm.F16K)}reset(){this.bands.forEach((t=>{Rm.setParamValue(t.gain,0)}))}destroy(){this.bands.forEach((t=>{t.disconnect()})),this.bands=null,this.bandsMap=null}};let Wm=jm;Wm.F32=32,Wm.F64=64,Wm.F125=125,Wm.F250=250,Wm.F500=500,Wm.F1K=1e3,Wm.F2K=2e3,Wm.F4K=4e3,Wm.F8K=8e3,Wm.F16K=16e3;const zm=t=>{const e=t.src;return t?.alias?.[0]??X.basename(e,X.extname(e))},Vm={extension:$t.Asset,detection:{test:async()=>!0,add:async t=>[...t,...Am.filter((t=>Pm[t]))],remove:async t=>t.filter((e=>t.includes(e)))},loader:{extension:{type:[$t.LoadParser],priority:Lr.High},test(t){const e=X.extname(t).slice(1);return!!Pm[e]||Im.some((e=>t.startsWith(`data:${e}`)))},async load(t,e){const i=await new Promise(((i,s)=>Bm.from({...e.data,url:t,preload:!0,loaded(t,r){t?s(t):i(r),e.data?.loaded?.(t,r)}})));return bm().add(zm(e),i),i},async unload(t,e){bm().remove(zm(e))}}};Kt.add(Vm);const Xm=function(t){return xm=t,t}(new class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new Gm),this._htmlAudioContext=new Um,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==Gm.AudioContext}add(t,e){if("object"==typeof t){const i={};for(const s in t){const r=this._getOptions(t[s],e);i[s]=this.add(s,r)}return i}if(e instanceof Bm)return this._sounds[t]=e,e;const i=this._getOptions(e),s=Bm.from(i);return this._sounds[t]=s,s}_getOptions(t,e){let i;return i="string"==typeof t||Array.isArray(t)?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,i={...i,...e||{}},i}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}get disableAutoPause(){return!this._webAudioContext.autoPause}set disableAutoPause(t){this._webAudioContext.autoPause=!t}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){return!!this._sounds[t]}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const i=this.find(t);return void 0!==e&&(i.volume=e),i.volume}speed(t,e){const i=this.find(t);return void 0!==e&&(i.speed=e),i.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}});class $m extends ir{constructor(t){if(super(),this.id=t,t<=6){const t=nr.from("speed.png");t.anchor.set(.5),this.addChild(t)}else if("normal"==th.SHOOT_STYLE){const t=nr.from("two.png");t.anchor.set(.5),this.addChild(t)}else if("double"==th.SHOOT_STYLE){const t=nr.from("three.png");t.anchor.set(.5),this.addChild(t)}else{const t=nr.from("speed.png");t.anchor.set(.5),this.addChild(t)}this.scale.set(6),this.x=580*Math.random()+80,this.y=-50,this.tween=new Ka(this).to({y:this.y+1400},4e3).start(),this.tween2=new Ka(this).to({x:this.x-50},800).start().yoyo(!0).easing(Xa.Quartic.Out).repeat(1/0)}getHitbox(){return this.getBounds()}}class Ym extends ir{constructor(t){super();const e=Ai.from(t);this.bgContainer=new ir,this.addChild(this.bgContainer);const i=nr.from(e);i.width=Qa.width,i.height=Qa.height,this.bgContainer.addChild(i);const s=nr.from(e);s.width=Qa.width,s.height=Qa.height,s.y=-Qa.height,this.bgContainer.addChild(s)}update(t,e){}}class qm extends ir{constructor(){super();const t=Ai.from("white_pixel.png");for(let e=0;e<20;e++){const e=nr.from(t);e.anchor.set(.5),e.scale.set(6),this.addChild(e),new Ka(e).to({x:this.x+-300*Math.random()+150,y:this.y+-300*Math.random()+100,alpha:0},1600).start().easing(Xa.Quintic.Out).onComplete((()=>this.destroy()))}}}class Km extends ir{constructor(){super(),this.enemyNumber=0,this.enemySpawnTime=0,this.enemyMaxSpawnTime=5e3,this.itemSpawnTime=0,this.shots=[],this.items=[],this.canShoot=!0,this.gameover=!1,this.isDragging=!1,this.midEnemy=!0,Xm.stopAll(),Xm.play("SongLevel",{volume:.3,loop:!0,singleInstance:!0}),Km.world=new ir,this.addChild(Km.world),this.background=new Ym("background.png"),Km.world.addChild(this.background),this.background1=new Ym("background1.png"),Km.world.addChild(this.background1),this.background2=new Ym("background2.png"),Km.world.addChild(this.background2),Km.player=new th,Km.player.position.set(Qa.width/2,Qa.height+200),Km.player.scale.set(6),Km.world.addChild(Km.player),new Ka(Km.player).to({y:1100},600).start().easing(Xa.Quadratic.Out).onComplete((()=>{this.eventMode="static"})),Km.score=new vm,this.addChild(Km.score),this.on("pointerdown",(t=>{this.isDragging=!0;const e=t.getLocalPosition(this.parent),i=Km.player.x,s=Km.player.y,r=e.x-i,n=e.y-s,o=Math.sqrt(r*r+n*n)/.9;let a=!1;const h=new Ka(Km.player).to({x:e.x,y:e.y},o).start().onStart((()=>{a=!0})).onUpdate((()=>{a||h.stop()}))})),this.on("pointermove",(t=>{if(this.isDragging){const e=t.getLocalPosition(this.parent),i=Km.player.x,s=Km.player.y,r=e.x-i,n=e.y-s,o=.9,a=Math.sqrt(r*r+n*n)/o;let h=!1;const l=new Ka(Km.player).to({x:e.x,y:e.y},a).start().onStart((()=>{h=!0})).onUpdate((()=>{h||l.stop()}))}})),this.on("pointerup",(()=>{this.isDragging=!1}))}update(t,e){if(this.itemSpawnTime+=t,this.enemySpawnTime+=t,Km.player.update(t),this.background.y+=.3*t,this.background.y%=Qa.height,this.background1.y+=.35*t,this.background1.y%=Qa.height,this.background2.y+=.4*t,this.background2.y%=Qa.height,this.itemSpawnTime>3e4*Math.random()+15e3){const t=new $m(6*Math.random()+1);Km.world.addChild(t),this.items.push(t),this.itemSpawnTime=0}for(let t=this.items.length-1;t>=0;t--){const e=this.items[t];e.y>=Qa.height?(this.items.splice(t,1),e.tween.stop(),e.tween2.stop(),e.destroy()):eh(e,Km.player)&&!this.gameover&&(Xm.play("Item",{volume:.4,singleInstance:!0}),this.items.splice(t,1),e.tween.stop(),e.tween2.stop(),e.destroy(),e.id<=6?th.SHOOT_DELAY*=.97:"normal"==th.SHOOT_STYLE?(th.SHOOT_STYLE="double",th.SHOOT_DELAY/=.7):"double"==th.SHOOT_STYLE?(th.SHOOT_STYLE="triple",th.SHOOT_DELAY/=.7):th.SHOOT_DELAY*=.97)}if(this.enemySpawnTime>this.enemyMaxSpawnTime/2&&this.midEnemy){const t=new Qm("enemy");Km.world.addChild(t),Km.enemies.push(t),this.midEnemy=!1}if(this.enemySpawnTime>8e3*Math.random()+2e3+this.enemyMaxSpawnTime){for(let t=0;t<10*Math.random()+Math.floor(this.enemyNumber/3);t++){const t=new Qm("enemy");Km.world.addChild(t),Km.enemies.push(t)}this.enemySpawnTime=0,this.enemyMaxSpawnTime*=.97,this.enemyNumber++,this.midEnemy=!0}for(let e=Km.enemies.length-1;e>=0;e--){const i=Km.enemies[e];if(i.update(t),i.y>=Qa.height&&(Km.enemies.splice(e,1),i.tween.stop(),i.destroy()),eh(i,Km.player)&&!this.gameover){for(let t=0;t<15;t++){const e=new qm;e.x=Km.player.x+t*Math.random()*-20+20,e.y=Km.player.y+t*Math.random()*-20+20,Km.world.addChild(e)}this.removeChild(Km.score),Xm.stopAll(),Xm.play("GameOver",{volume:.6,singleInstance:!0}),Km.world.removeChild(Km.player),this.gameover=!0;const t=new ym;this.addChild(t),th.SHOOT_STYLE="normal",th.SHOOT_DELAY=th.NORMAL_SHOOT_DELAY}}if(this.canShoot&&!this.gameover){if(setTimeout((()=>{this.canShoot=!0}),th.SHOOT_DELAY),this.canShoot=!1,"normal"==th.SHOOT_STYLE||"triple"==th.SHOOT_STYLE){const t=new ih(0);t.position.set(Km.player.x,Km.player.y-20),Km.world.addChild(t),this.shots.push(t)}if("double"==th.SHOOT_STYLE){const t=new ih(-100);t.position.set(Km.player.x,Km.player.y-20),Km.world.addChild(t),this.shots.push(t);const e=new ih(100);e.position.set(Km.player.x,Km.player.y-20),Km.world.addChild(e),this.shots.push(e)}if("triple"==th.SHOOT_STYLE){const t=new ih(-200);t.position.set(Km.player.x,Km.player.y-20),Km.world.addChild(t),this.shots.push(t);const e=new ih(200);e.position.set(Km.player.x,Km.player.y-20),Km.world.addChild(e),this.shots.push(e)}}for(let t=this.shots.length-1;t>=0;t--){const e=this.shots[t];e.y<0&&(this.shots.splice(t,1),e.tween.stop(),e.destroy());for(let i=Km.enemies.length-1;i>=0;i--){const s=Km.enemies[i];if(eh(s,e)){Xm.play("EnemyKilled",{volume:.6,singleInstance:!0});const r=new qm;r.x=s.x+24,r.y=s.y+24,this.addChild(r),this.shots.splice(t,1),Km.enemies.splice(i,1),e.tween.stop(),e.destroy(),s.tween.stop(),s.destroy(),Km.score.score+=100,Km.score.text.text="SCORE "+String(Km.score.score);break}}}const i=Km.player.width/2,s=Km.player.height/2;Km.player.x>Qa.width-i?Km.player.x=Qa.width-i:Km.player.x<0+i&&(Km.player.x=0+i),Km.player.y>Qa.height-s?Km.player.y=Qa.height-s:Km.player.y<0+s&&(Km.player.y=0+s)}}Km.enemies=[];class Qm extends Za{constructor(t){super(),this.type="",this.canShoot=!1,this.shootCooldown=0,this.type=t,this.hitbox=new Mo,this.hitbox.beginFill(16711935,.5),"enemy"==t?(this.sprite=nr.from(`enemy0${String(Math.floor(4*Math.random())+1)}.png`),this.hitbox.drawRect(0,0,8,8),this.x=900*Math.random()-100,this.y=-50,Math.random()<.4&&(this.canShoot=!0)):"enemy_shot"==t&&(this.sprite=nr.from("enemy_shot.png"),this.hitbox.drawRect(0,0,3,3)),this.sprite.scale.set(6),this.addChild(this.sprite),this.hitbox.visible=!1,this.hitbox.endFill,this.hitbox.scale.set(6),this.addChild(this.hitbox),"enemy"==t&&(this.tween=new Ka(this).to({x:900*Math.random()-100,y:this.y+1400},3e3*Math.random()+2e3).start())}update(t){if(super.update(t/1e3),this.shootCooldown+=t,"enemy"==this.type&&this.shootCooldown>1500*Math.random()+1e3&&this.canShoot){const t=new Qm("enemy_shot");Km.world.addChild(t),t.x=this.x+24,t.y=this.y+48,Km.enemies.push(t),this.shootCooldown=0,t.tween=new Ka(t).to({x:900*Math.random()-100,y:this.y+1400},1500*Math.random()+1e3).start()}}getHitbox(){return this.hitbox.getBounds()}}class Zm extends ir{constructor(t,e){super();const i=nr.from(t);this.scale.set(4),this.addChild(i),this.alpha=.8,this.eventMode="static",this.cursor="pointer",this.on("pointerover",(()=>this.alpha=1)),this.on("pointerout",(()=>this.alpha=.8)),this.on("pointerup",e)}}var Jm=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class t_ extends ir{constructor(t){super();const e=new Zo("",{fontFamily:"PressStart2P",fontSize:90,align:"center",fill:function(){const e=["0x0bffe6","0xffd080","0xff9e7d","0xfe546f","0xFFFFFF"],i=Math.floor(Math.random()*e.length);return t?e[i]:"0x0bffe6"}()});e.anchor.set(.5),e.position.set(Qa.width/2,Qa.height/2),e.eventMode="static",e.cursor="pointer",this.addChild(e),this.animateText(e)}updateTextWithDelay(t,e,i){return Jm(this,void 0,void 0,(function*(){return new Promise((s=>{new Ka(t).to({},i).start().onComplete((()=>{t.text=e,s()}))}))}))}animateText(t){return Jm(this,void 0,void 0,(function*(){yield this.updateTextWithDelay(t,"S",100),yield this.updateTextWithDelay(t,"SP",100),yield this.updateTextWithDelay(t,"SPC",100),yield this.updateTextWithDelay(t,"SPC\nW",100),yield this.updateTextWithDelay(t,"SPC\nWR",100),yield this.updateTextWithDelay(t,"SPC\nWRS",100),yield this.updateTextWithDelay(t,"SP C\nWRS",100),yield this.updateTextWithDelay(t,"SP C \nWRS",100),yield this.updateTextWithDelay(t,"SP C \nW RS",100),yield this.updateTextWithDelay(t,"SP0C \nW RS",100),yield this.updateTextWithDelay(t,"SP1C \nW RS",100),yield this.updateTextWithDelay(t,"SP2C \nW RS",100),yield this.updateTextWithDelay(t,"SP3C \nW RS",100),yield this.updateTextWithDelay(t,"SP4C0\nW RS",100),yield this.updateTextWithDelay(t,"SP0C1\nW RS",100),yield this.updateTextWithDelay(t,"SP1C2\nW RS",100),yield this.updateTextWithDelay(t,"SP2C3\nW RS",100),yield this.updateTextWithDelay(t,"SP3C3\nW0RS",100),yield this.updateTextWithDelay(t,"SP4C3\nW1RS",100),yield this.updateTextWithDelay(t,"SP4C3\nW2RS",100),yield this.updateTextWithDelay(t,"SP4C3\nW3RS",100),yield this.updateTextWithDelay(t,"SP4C3\nW4RS",100)}))}}class e_ extends ir{constructor(){super();const t=function(t,...e){let i=Uh(t);for(const t of e)i=t._apply(i);return i}(tm(pm(),"puntajes"),function(t){if("$key"===t)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===t)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===t)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return cf("orderByChild","path",t,!1),new hm(t)}("puntaje"));om(t,(t=>{t.exists()&&(this.scoresArray=[],t.forEach((t=>{const e=t.val();this.scoresArray.push(e)}))),this.scoresArray.sort(((t,e)=>Number(e.puntaje)-Number(t.puntaje))),this.scoresArray=this.scoresArray.slice(0,20),this.tablaPuntuaciones&&this.removeChild(this.tablaPuntuaciones),this.tablaPuntuaciones=new ir;this.scoresArray.forEach(((t,e)=>{const i=this.randomColor(),s=new Zo(`${e+1}. ${t.nombre}`,{fontFamily:"PressStart2P",fontSize:22,fill:i});s.position.set(0,50*e+27);const r=new Zo(`${t.puntaje}`,{fontFamily:"PressStart2P",fontSize:22,fill:i});r.anchor.x=1,r.position.set(505,50*e+27);const n=new ir;n.addChild(s),n.addChild(r),this.tablaPuntuaciones.addChild(n),new Ka(n).to({x:-30*Math.random()+15},1e3).start().yoyo(!0).easing(Xa.Quadratic.Out).repeat(1/0)})),this.tablaPuntuaciones.position.set(110,230),this.addChild(this.tablaPuntuaciones);const e=new Zo("HIGH\nSCORES",{fontFamily:"PressStart2P",fontSize:45,align:"center",fill:16777215,lineHeight:55});e.anchor.set(.5),e.position.set(Qa.width/2,140),this.addChild(e),i_.highestScore.text="HIGH SCORE\n"+String(this.scoresArray[0].nombre)+"\n"+String(this.scoresArray[0].puntaje)}))}randomColor(){const t=["0x0bffe6","0xffd080","0xff9e7d","0xfe546f","0xfffdff","0x01cbcf"];return t[Math.floor(Math.random()*t.length)]}}class i_ extends ir{constructor(t){super(),this.enemies=[],this.elapsedTime=0,Xm.stopAll(),Xm.play("SongTitle",{volume:.6,loop:!0,singleInstance:!0}),this.containerBack=new ir,this.addChild(this.containerBack),this.background=new Ym("background.png"),this.containerBack.addChild(this.background),this.background1=new Ym("background1.png"),this.containerBack.addChild(this.background1),this.background2=new Ym("background2.png"),this.containerBack.addChild(this.background2);const e=new ir;this.addChild(e),i_.highestScore=new Zo("HIGH SCORE\n",{fontFamily:"PressStart2P",fontSize:20,align:"center",fill:this.randomColor(),lineHeight:35}),i_.highestScore.anchor.x=.5,i_.highestScore.alpha=.8,i_.highestScore.position.set(Qa.width/2,25),e.addChild(i_.highestScore);const i=new e_;this.addChild(i),i.visible=!1;const s=new Zm("highscore.png",(()=>{r.visible=!0,e.visible=!1,i.visible=!0}));s.scale.set(5),s.position.set(600,30),e.addChild(s);const r=new Zm("back.png",(()=>{r.visible=!1,e.visible=!0,i.visible=!1}));r.scale.set(5),r.position.set(600,30),r.visible=!1,this.addChild(r),t&&(r.visible=!0,e.visible=!1,i.visible=!0);const n=new Zm("fullscreen.png",(()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()}));n.position.set(270,1030),e.addChild(n);const o=new Zm("unmuted.png",(()=>{Xm.muteAll(),Qa.muted=!0,a.visible=!0,o.visible=!1}));o.position.set(385,1030),e.addChild(o);const a=new Zm("muted.png",(()=>{Xm.unmuteAll(),Qa.muted=!1,a.visible=!1,o.visible=!0}));a.visible=!1,a.position.set(385,1030),e.addChild(a),Qa.muted&&(a.visible=!0,o.visible=!1);const h=t=>{const i=new t_(t);i.eventMode="static",i.on("pointerup",(()=>{e.removeChild(i),i.destroy(),h(!0)})),e.addChild(i)};h(!1);const l=new Zo("[ PL4Y ]",{fontFamily:"PressStart2P",fontSize:30,align:"center",fill:16777215});l.anchor.set(.5),l.position.set(Qa.width/2,890),l.eventMode="static",l.cursor="pointer",l.on("pointerup",(()=>Qa.changeScene(new Km))),e.addChild(l);const c=new Ka(l).to({},300).start().onComplete((()=>{l.text="[      ]",new Ka(l).to({},200).start().onComplete((()=>{l.text="[ PL4Y ]",c.start()}))})),u=new Zo("© 2023 Román Ríos",{fontFamily:"PressStart2P",fontSize:18,align:"center",fill:16777215});u.anchor.set(.5),u.position.set(Qa.width/2-2,Qa.height-70),u.eventMode="static",u.cursor="pointer",u.on("pointerup",(()=>{window.open("https://romanrios.github.io","_blank")})),e.addChild(u)}update(t,e){if(this.elapsedTime+=t,this.background.y+=.3*t,this.background.y%=Qa.height,this.background1.y+=.35*t,this.background1.y%=Qa.height,this.background2.y+=.4*t,this.background2.y%=Qa.height,this.elapsedTime>2e3*Math.random()+1e3){const t=new Qm("enemy");t.x=680*Math.random()+20,this.containerBack.addChild(t),this.enemies.push(t),this.elapsedTime=0}for(let t=this.enemies.length-1;t>=0;t--){const e=this.enemies[t];e.y>=Qa.height&&(this.enemies.splice(t,1),e.tween.stop(),e.destroy())}}randomColor(){const t=["0x0bffe6","0xffd080","0xff9e7d","0xfe546f","0xfffdff","0x01cbcf"];return t[Math.floor(Math.random()*t.length)]}}var s_=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};he.defaultOptions.scaleMode=c.NEAREST,Qa.initialize(720,1280,0),ja.initialize();const r_=new class extends ir{constructor(){super();const t=.8*Qa.width;this.loaderBarFill=new Mo,this.loaderBarFill.beginFill(5592405,1),this.loaderBarFill.drawRect(0,0,t,70),this.loaderBarFill.endFill(),this.loaderBarFill.scale.x=0,this.loaderBarBoder=new Mo,this.loaderBarBoder.lineStyle(5,16777215,1),this.loaderBarBoder.drawRect(0,0,t,70),this.loaderBar=new ir,this.loaderBar.addChild(this.loaderBarFill),this.loaderBar.addChild(this.loaderBarBoder),this.loaderBar.position.x=(Qa.width-this.loaderBar.width)/2,this.loaderBar.position.y=(Qa.height-this.loaderBar.height)/2,this.addChild(this.loaderBar),this.texty=new Zo("",{fontSize:30,fill:16777215}),this.texty.anchor.set(.5),this.texty.position.set(Qa.width/2,Qa.height/2),this.addChild(this.texty),this.initializeLoader().then((()=>{this.gameLoaded()}))}initializeLoader(){return s_(this,void 0,void 0,(function*(){yield an.init({manifest:Wa});const t=Wa.bundles.map((t=>t.name));yield an.loadBundle(t,this.downloadProgress.bind(this))}))}downloadProgress(t){this.loaderBarFill.scale.x=t}gameLoaded(){Qa.changeScene(new i_(!1))}update(t){}};Qa.changeScene(r_)})()})();